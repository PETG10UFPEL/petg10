try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="54bd882a-02c4-41bf-86ee-ff4c83e93486",e._sentryDebugIdIdentifier="sentry-dbid-54bd882a-02c4-41bf-86ee-ff4c83e93486")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41450],{0x78e658af:(e,t,a)=>{a.d(t,{CodeRenderer:()=>P,k:()=>A,MarkdownRenderer:()=>T});var n=a(0x22102fd88),s=a(0x209ff4fac),l=a(0x11307af4f),r=a(0xbca8e388),o=a(0xda044f84),i=a(0x236236dc),c=a(0x1f725a926),d=a(0x112f760bb),u=a(0x24fcf6beb),f=a(0xc5b8d95e),h=a(0x1a1f6dda6),m=a(0xfc89b4a4),x=a(0x239a63c1c),g=a(0xf32c56dd),p=a(0x1cf5ab98a),v=a(0x137ebf880),b=a(0xb6009ed9),y=a(0xb844abc8),j=a(0x160045b25),C=a(0x18c2bb2d),w=a(0x1ab0d1ca1),_=a(0x38e6572);let k=e=>{let{isStreaming:t,children:a,...s}=e;return t?a:(0,n.jsx)(M,{...s,children:a})},M=e=>{let{children:t,sendMessage:a,contentType:s="text",isOpen:l}=e,r=(0,w.A)(),o=(0,g.st)(),i=void 0!==a,[c,d]=(0,m.useState)([]),[u,f]=(0,m.useState)({top:0,left:0,width:0}),[x,k]=(0,m.useState)(!1),[M,S]=(0,m.useState)(!1),[N,E]=(0,m.useState)(""),[A,P]=(0,m.useState)(""),[T,L]=(0,m.useState)(!1),R=(0,m.useRef)(null),z=(0,m.useRef)(null),H=(0,m.useCallback)((e,t)=>{var a;let n=function(e,t){let a=[];for(let n=0;n<e.rangeCount;n++){let s=e.getRangeAt(n);if(s.startContainer===s.endContainer&&s.startContainer.nodeType===Node.TEXT_NODE){let e=s.startContainer,t=document.createRange();for(let n=s.startOffset;n<s.endOffset;n++){t.setStart(e,n),t.setEnd(e,n+1);let s=Array.from(t.getClientRects());a.push(...s)}t.detach()}else{let e=function(e){let t,a=[],n=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=n.nextNode();)a.push(t);return a}(s);e.forEach((n,l)=>{let r=document.createRange(),o="length"in n?n.length:0,i=0===l,c=l===e.length-1,d=i?s.startOffset:0,u=c&&!t?s.endOffset:o;r.setStart(n,d),r.setEnd(n,u);let f=Array.from(r.getClientRects());a.push(...f),r.detach()})}}return a}(e,t),s=null==(a=R.current)?void 0:a.getBoundingClientRect();return Array.from(n).map(e=>({top:e.top-((null==s?void 0:s.top)||0)-2.5,left:e.left-((null==s?void 0:s.left)||0),width:e.width,height:e.height+5.5}))},[]),I=(0,m.useCallback)(e=>{var t;let a=e.getRangeAt(0);return null==(t=R.current)?void 0:t.contains(a.commonAncestorContainer)},[]);(0,m.useEffect)(()=>{function e(e){var t,a,n,s;let l,r,{selection:o,isSelectAll:i}=e,c=H(o,i);if(c.every((e,t,a)=>0===t||5>Math.abs(e.top-a[0].top))){let e=Math.max(...c.map(e=>e.left+e.width));l=c[0].top-9,r=e+10}else{let e=Math.max(...c.map(e=>e.top+e.height));r=Math.min(...c.map(e=>e.left)),l=Math.min((null!=(n=null==(a=R.current)?void 0:a.scrollHeight)?n:0)-50,e)}let u=((null!=(s=null==(t=R.current)?void 0:t.scrollWidth)?s:1e3)-r)/3*2;d(c),k(!0),S(!1),f({top:l,left:r,width:u}),P(o.toString())}let t=()=>{L(!0)},a=t=>{"Escape"===t.key&&(S(!1),k(!1),E(""),d([]));let a=((0,y.cX)()?t.metaKey:t.ctrlKey)&&"a"===t.key,n=R.current;if(n&&l&&a){let a=document.activeElement&&(document.activeElement===n||(null==n?void 0:n.contains(document.activeElement))),s=window.getSelection();if(a&&s){t.preventDefault();let a=document.createRange();a.selectNodeContents(n),s.removeAllRanges(),s.addRange(a),e({selection:s,isSelectAll:!0})}}},n=t=>{if(z.current&&z.current.contains(t.target))return;let a=window.getSelection();a&&!a.isCollapsed&&I(a)?e({selection:a}):(d([]),k(!1),S(!1),P(""),E("")),L(!1)};return i&&(document.addEventListener("mousedown",t),document.addEventListener("mouseup",n),document.addEventListener("keydown",a)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mouseup",n),document.removeEventListener("keydown",a)}},[H,I,i,l]);let O=e=>{i&&(a(e),E(""),S(!1),k(!1),d([]))},U=()=>"text"===s?A.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===s?"```\n".concat(A,"\n```"):void 0,D=()=>{O({prompt:"".concat(U(),"\n\n").concat(N),attachments:[],files:[],syncSources:[]})};return(0,n.jsxs)("div",{className:"w-full h-full relative",children:[(0,n.jsx)("div",{ref:R,tabIndex:0,className:(0,h.$)("w-full h-full relative",i?T?"[&_:not(input)::selection]:bg-secondary-000/10":"[&_*::selection]:bg-secondary-000/10":""),children:t}),c.map((e,t)=>(0,n.jsx)("div",{className:"absolute pointer-events-none bg-accent-secondary-000/10",style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,n.jsx)(j.N,{children:x&&!M&&(0,n.jsx)(C.P.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:u.top+5,left:u.left},children:(0,n.jsx)("div",{className:"border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition bg-bg-000 text-text-400 border-border-300",children:(0,n.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,n.jsx)(p.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"improve"}),S(!0)},prepend:(0,n.jsx)(b.X,{}),children:(0,n.jsx)(_.A,{defaultMessage:"Improve",id:"BATKcMm/a2"})}),(0,n.jsx)(p.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"explain"}),O({prompt:"".concat(r.formatMessage({defaultMessage:"Can you explain this section to me in more detail?",id:"LMDbiRxyDQ"}),"\n\n").concat(U()),attachments:[],files:[],syncSources:[]})},prepend:(0,n.jsx)(v.g,{}),children:(0,n.jsx)(_.A,{defaultMessage:"Explain",id:"HGdgPPM2Ry"})})]})})})}),(0,n.jsx)(j.N,{children:M&&(0,n.jsxs)(C.P.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:"z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl",style:{top:u.top+5,left:u.left,width:u.width},ref:z,onSubmit:e=>{e.preventDefault(),D()},children:[(0,n.jsx)("input",{type:"text",value:N,onChange:e=>E(e.target.value),placeholder:r.formatMessage({defaultMessage:"Describe what you would like to update...",id:"smio7jldoW"}),className:"py-0.5 px-0 border-0 bg-transparent text-sm grow !shadow-none text-text-200 placeholder-text-500 hide-focus-ring",autoFocus:!0}),(0,n.jsx)(j.N,{children:N.trim().length>0?(0,n.jsx)(C.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,n.jsx)(p.$,{onClick:()=>D(),"aria-label":r.formatMessage({defaultMessage:"Send Message",id:"yJAKR0Ngpn"}),type:"submit",children:(0,n.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,n.jsx)(_.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})}):null})]})})]})};var S=a(0x253ff6d66),N=a(0x1ce8093a4);let E="opacity-30 blur-[2px]",A=e=>{let{isOpen:t,content:a,language:s,citations:l,type:r,showRaw:o,richSandboxRef:i,isCurrentStreaming:c,isChatStreaming:f,onSandboxConfirmation:x,onDOMContentLoaded:g,sendMessage:p,richSandboxCapabilities:v,isLatestVersion:b,artifactId:y,artifactContext:j,artifactVersion:C,onArtifactRuntimeError:w,artifact:_,hasMenuOpen:k,zoom:M,onTrackInteraction:A,showLoginModal:R,ArtifactMcpModal:z}=e,H=void 0!==r&&void 0!==a&&r!==u.vU.Code&&r!==u.vU.Markdown,I=(0,m.useRef)(null),O=H&&!o,[U,D]=(0,m.useState)(null),F=(0,m.useCallback)(e=>{void 0!==y&&void 0!==C&&(void 0!==w&&w(e),D({error:e,artifactId:y,artifactVersion:C}))},[y,C,w]);(0,m.useEffect)(()=>{var e;if(!_||!c)return;let t=_.versions[_.versions.length-1],a=_.versions[_.versions.length-2];if(!a||!t||"update"!==t.command)return;let n=L(a.resultState,t.resultState);-1!==n&&(null==(e=I.current)||e.scrollToPercentage(n/100))},[a,_,c]),(0,m.useEffect)(()=>{!c&&I.current&&I.current.enableScrolling()},[c]);let K=(0,m.useCallback)(()=>{D(e=>e&&(e.artifactId!==y||e.artifactVersion!==C)?null:e)},[y,C]),$=(0,m.useCallback)(()=>{D(null)},[]);return(0,n.jsxs)(n.Fragment,{children:[H&&(0,n.jsxs)("div",{className:(0,h.A)("ease-out duration-200",O?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",k&&E),children:[(0,n.jsx)(N.A,{ref:i,className:O?"h-full w-full border-none bg-bg-100":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:O?a:void 0,type:O?r:void 0,onSandboxConfirmation:x,onDOMContentLoaded:g,capabilities:v,onReportError:F,onSetContent:K,onRefresh:$,externalLinkBehavior:"ask",zoom:M,onTrackInteraction:A,showLoginModal:R,artifactContext:j,ArtifactMcpModal:z,isChatStreaming:f}),O&&U&&(0,n.jsx)(S.i,{error:U,handleClose:()=>D(null),sendMessage:b?p:void 0,isStreaming:f})]}),void 0===a||void 0===r?null:r===u.vU.Code||o?(0,n.jsx)(d.Z,{noDefaultScroll:!c,ref:I,className:(0,h.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",k&&E),children:(0,n.jsx)(P,{content:a,isStreaming:f,language:s,sendMessage:p,isOpen:t},"code-".concat(y,"-").concat(C,"-").concat(c))}):r===u.vU.Markdown?(0,n.jsx)(d.Z,{noDefaultScroll:!c,ref:I,className:(0,h.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",k&&E),children:(0,n.jsx)(T,{content:a,citations:l,isStreaming:f,sendMessage:p,isOpen:t},"markdown-".concat(y,"-").concat(C,"-").concat(c))}):null]})},P=e=>{let{content:t,isStreaming:a,language:r,sendMessage:o,isOpen:d}=e,{codeStyle:u}=(0,i.V)(),{exceedsSizeLimit:f}=(0,c.y)(t),h="code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed ";return(0,n.jsx)(k,{isStreaming:a,sendMessage:o,contentType:"code",isOpen:d,children:f?(0,n.jsx)(s.R,{code:t,codeClassName:"".concat(h," p-3.5")}):(0,n.jsx)(x.A,{className:h,language:r,PreTag:"div",style:u,renderer:l.G,children:t})})},T=e=>{let{content:t,citations:a,isStreaming:s,sendMessage:l,isOpen:i}=e,c=(0,f.n)(),d=(0,m.useMemo)(()=>c&&a&&a.length>0?(0,o.k0)(a,t):t,[t,a,c]);return(0,n.jsx)(k,{isStreaming:s,sendMessage:l,isOpen:i,children:(0,n.jsxs)("div",{tabIndex:0,id:"markdown-artifact",className:"font-claude-response mx-auto w-full max-w-3xl leading-[1.65rem] px-6 pt-4 md:pt-6 md:px-11",children:[(0,n.jsx)(r.fP,{text:d,blockCitations:a,className:"!gap-3.5",isStreaming:s,normalizationMode:"markdown-document"}),(0,n.jsx)("div",{className:"h-8"})]})})},L=(e,t)=>{if(!e||!t)return -1;let a=e.replace(/\\n/g,"\n"),n=t.replace(/\\n/g,"\n"),s=[...a].findIndex((e,t)=>e!==n[t]);if(-1===s&&a.length===n.length)return -1;let l=(a.slice(0,-1===s?a.length:s).match(/\n/g)||[]).length,r=(a.match(/\n/g)||[]).length;return r?Math.round(l/r*100):-1}},0xb6009ed9:(e,t,a)=>{a.d(t,{X:()=>l});var n=a(0x22102fd88),s=a(0x7e43ab2b);let l=e=>(0,n.jsx)(s.z,{...e,children:(0,n.jsx)("path",{d:"M8 14C8 14.5523 8.44772 15 9 15H9.5C9.77614 15 10 15.2239 10 15.5C10 15.7761 9.77614 16 9.5 16H9C8.40169 16 7.86651 15.7357 7.5 15.3193C7.13349 15.7357 6.59831 16 6 16H5.5C5.22386 16 5 15.7761 5 15.5C5 15.2239 5.22386 15 5.5 15H6C6.55228 15 7 14.5523 7 14V13.5L7.00098 6.5H7V6C7 5.44772 6.55228 5 6 5H5.5C5.22386 5 5 4.77614 5 4.5C5 4.22386 5.22386 4 5.5 4H6C6.59805 4 7.1335 4.26363 7.5 4.67969C7.8665 4.26363 8.40195 4 9 4H9.5C9.77614 4 10 4.22386 10 4.5C10 4.77614 9.77614 5 9.5 5H9C8.44772 5 8 5.44772 8 6V6.5H8.00098L8 13.5V14ZM5.5 7C5.77614 7 6 7.22386 6 7.5C6 7.77614 5.77614 8 5.5 8H3.5C3.22386 8 3 8.22386 3 8.5V11.5C3 11.7761 3.22386 12 3.5 12H5.5C5.77614 12 6 12.2239 6 12.5C6 12.7761 5.77614 13 5.5 13H3.5C2.67157 13 2 12.3284 2 11.5V8.5C2 7.67157 2.67157 7 3.5 7H5.5ZM16.5 7C17.3284 7 18 7.67157 18 8.5V11.5C18 12.3284 17.3284 13 16.5 13H9.5C9.22386 13 9 12.7761 9 12.5C9 12.2239 9.22386 12 9.5 12H16.5C16.7761 12 17 11.7761 17 11.5V8.5C17 8.22386 16.7761 8 16.5 8H9.5C9.22386 8 9 7.77614 9 7.5C9 7.22386 9.22386 7 9.5 7H16.5Z"})})},0xf071fd84:(e,t,a)=>{a.d(t,{Ns:()=>u,XJ:()=>d,mt:()=>c,r$:()=>i,rz:()=>f});var n=a(0x12c9046cd),s=a(0x20b939f38),l=a(0xac309a83),r=a(0x17e725145);let o="artifact_tool_configuration",i="artifact_storage_info",c=e=>{let{entityId:t,artifactEntityType:a,conversationUuid:r,filePath:i}=e,{activeOrganization:c}=(0,s.YL)(),d=null==c?void 0:c.uuid,u=(0,l.fS)("claude_create_marble"),f="/api/organizations/".concat(d,"/artifacts/").concat(a,"/").concat(t,"/tools"),h=new URLSearchParams;r&&h.set("chat_conversation_uuid",r),i&&h.set("file_path",i);let m=h.toString(),x=m?"".concat(f,"?").concat(m):f,g="wiggle_artifact"!==a||!!r&&!!i;return(0,n.Sk)(x,{queryKey:[o,{orgUuid:d,entityId:t,artifactEntityType:a,conversationUuid:r,filePath:i}],enabled:!!d&&!!t&&u&&g,meta:{noToast:!0}})},d=e=>{let{entityId:t,artifactEntityType:a,conversationUuid:i,filePath:c}=e,{activeOrganization:d}=(0,s.YL)(),u=null==d?void 0:d.uuid,f=(0,r.useQueryClient)(),h=(0,l.fS)("claude_create_marble"),m="/api/organizations/".concat(u,"/artifacts/").concat(a,"/").concat(t,"/tools"),x=new URLSearchParams;i&&x.set("chat_conversation_uuid",i),c&&x.set("file_path",c);let g=x.toString(),p=g?"".concat(m,"?").concat(g):m;return(0,n.L2)(p,"POST",{enabled:!!u&&!!t&&h,onSuccess:()=>{f.invalidateQueries({queryKey:[o,{orgUuid:u,entityId:t,artifactEntityType:a,conversationUuid:i,filePath:c}]})},meta:{noToast:!0}})},u=(e,t)=>{var a;let{entityId:r,artifactEntityType:o,conversationUuid:c,filePath:d}=e,{activeOrganization:u}=(0,s.YL)(),f=null==u?void 0:u.uuid,h=(0,l.fS)("claude_create_pebble_stone"),m="/api/organizations/".concat(f,"/artifacts/").concat(o,"/").concat(r,"/manage/storage/info"),x=new URLSearchParams;c&&x.set("chat_conversation_uuid",c),d&&x.set("file_path",d);let g=x.toString(),p=g?"".concat(m,"?").concat(g):m;return(0,n.Sk)(p,{queryKey:[i,{orgUuid:f,entityId:r,artifactEntityType:o,conversationUuid:c,filePath:d}],enabled:!!f&&!!r&&h&&(null==(a=null==t?void 0:t.enabled)||a),staleTime:0,meta:{noToast:!0}})},f=e=>{let{entityId:t,artifactEntityType:a,conversationUuid:o,filePath:c}=e,{activeOrganization:d}=(0,s.YL)(),u=null==d?void 0:d.uuid,f=(0,r.useQueryClient)(),h=(0,l.fS)("claude_create_pebble_stone"),m="/api/organizations/".concat(u,"/artifacts/").concat(a,"/").concat(t,"/manage/storage/reset"),x=new URLSearchParams;o&&x.set("chat_conversation_uuid",o),c&&x.set("file_path",c);let g=x.toString(),p=g?"".concat(m,"?").concat(g):m;return(0,n.L2)(p,"DELETE",{enabled:!!u&&!!t&&h,onSuccess:()=>{f.invalidateQueries({queryKey:[i,{orgUuid:u,entityId:t,artifactEntityType:a,conversationUuid:o,filePath:c}]})},meta:{noToast:!0}})}},0x1575c7741:(e,t,a)=>{a.d(t,{f:()=>i});var n=a(0x20b939f38),s=a(0x10728a05e),l=a(0xac309a83),r=a(0xfc89b4a4),o=a(0x1ab0d1ca1);let i=function(){let{artifactContext:e,onRateLimitError:t,onMissingOrganization:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,l.fS)("apps_use_turmeric"),{activeOrganization:c}=(0,n.YL)(),{addError:d}=(0,s.Yf)(),u=(0,o.A)();return(0,r.useCallback)(async n=>{if(!i)return Promise.resolve(null);if(!(null==c?void 0:c.uuid))return null==a||a(),Promise.resolve(null);try{var s;let a=await fetch("/api/organizations/".concat(null==c?void 0:c.uuid,"/proxy/v1/messages"),{method:"POST",headers:{"Content-Type":"application/json",...e?{"anthropic-artifact-id":e.uuid,"anthropic-artifact-entity-type":e.type,..."wiggle_artifact"===e.type?{...e.conversation_uuid&&{"anthropic-chat-conversation-uuid":e.conversation_uuid},...e.file_path&&{"anthropic-file-path":e.file_path}}:{}}:{}},body:JSON.stringify({messages:[{role:"user",content:n}]})});if(!a.ok)throw 429===a.status&&(t?t():d(u.formatMessage({defaultMessage:"Limit reached. This artifact uses Claude for responses. Try again when the message limit resets.",id:"5Ocu9uCFLz"}),{messageForLogging:"Limit reached. This artifact uses Claude for responses. Try again when the message limit resets."})),Error("HTTP error! status: ".concat(a.status));let l=await a.json();return Promise.resolve((null==(s=l.content[0])?void 0:s.text)||null)}catch(e){return Promise.reject(e)}},[null==c?void 0:c.uuid,e,i,t,a,d,u])}},0x1bb0f43cc:(e,t,a)=>{a.d(t,{j:()=>r});var n=a(0x20b939f38),s=a(0xac309a83),l=a(0xfc89b4a4);let r=function(){let{artifactContext:e,onMissingOrganization:t,chatConversationUuid:a,onStorageChange:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:o}=(0,n.YL)(),i=(0,s.fS)("claude_create_pebble_stone"),c=(0,l.useCallback)(async function(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(n)),window.location.origin);t.searchParams.set("shared",s.toString()),a&&t.searchParams.set("chat_conversation_uuid",a),e.file_path&&t.searchParams.set("file_path",e.file_path);let l=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let r=await l.json();return Promise.resolve(r)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,a]),d=(0,l.useCallback)(async function(n,s){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=await fetch("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(n)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:s,shared:l,...a&&{chat_conversation_uuid:a},...e.file_path&&{file_path:e.file_path}})});if(!t.ok)throw Error("Database error: ".concat(t.status));let i=await t.json();return null==r||r(),Promise.resolve(i)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,a,r]),u=(0,l.useCallback)(async function(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(n)),window.location.origin);t.searchParams.set("shared",s.toString()),a&&t.searchParams.set("chat_conversation_uuid",a),e.file_path&&t.searchParams.set("file_path",e.file_path);let l=await fetch(t.toString(),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let i=await l.json();return null==r||r(),Promise.resolve(i)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,a,r]),f=(0,l.useCallback)(async function(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage"),window.location.origin);n&&t.searchParams.set("prefix",n),t.searchParams.set("shared",s.toString()),a&&t.searchParams.set("chat_conversation_uuid",a),e.file_path&&t.searchParams.set("file_path",e.file_path);let l=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let r=await l.json();return Promise.resolve(r)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,a]);return{get:c,set:d,delete:u,list:f}}},0x1bca896dd:(e,t,a)=>{a.d(t,{I:()=>I});var n=a(0x22102fd88),s=a(0x303b360c),l=a(0x10728a05e),r=a(0x17185943),o=a(0x1a3a3154),i=a(0x2471dc42f),c=a(0x1b6318607),d=a(0x147f02987),u=a(0x608678a7),f=a(0x225bae024),h=a(0x1cd2ec21c),m=a(0x183548b63),x=a(0x22fc8d729),g=a(0x1b370f49d),p=a(0x10b8a0309),v=a(0x761f2ec),b=a(0x1a1f6dda6),y=a(0x4d348f95),j=a(0xfc89b4a4),C=a(0x1ab0d1ca1),w=a(0x38e6572),_=a(0xf071fd84),k=a(0x22be9474c),M=a(0x4d9fc74e),S=a(0x31c535e9),N=a(0x1d1a079e9),E=a(0xf8bd7957),A=a(0x8cde4874),P=a(0x219f38dbd),T=a(0xe824fb1c),L=a(0x6f6d4bd7);function R(e){let{className:t,...a}=e;return(0,n.jsx)("div",{...a,className:(0,b.A)("bg-bg-000 border-0.5 border-border-300 rounded-lg shadow-sm p-5 flex flex-col gap-4 items-stretch self-stretch",t)})}let z=e=>{let{isOpen:t,onClose:a,variant:s,unknownServerCount:l}=e,r=(0,C.A)(),o=(0,P.o)();return(0,n.jsxs)(m.aF,{title:r.formatMessage({defaultMessage:"Connectors unavailable",id:"nKB/o0ajrR"}),isOpen:t,onClose:a,children:[(0,n.jsx)("div",{className:"flex flex-col gap-3 py-3",children:(0,n.jsx)(R,{children:(0,n.jsx)("p",{className:"text-sm text-text-500",children:"disabled"===s?(0,n.jsx)(w.A,{defaultMessage:"Your organization admin has disabled connectors in artifacts. To use this feature, ask your admin to enable connectors in artifacts.",id:"+0AXIvgEHO"}):(0,n.jsx)(w.A,{defaultMessage:"{count, plural, one {# requested connector is not in your directory and has been} other {# requested connectors are not in your directory and have been}} hidden. Some functionality may be limited. {link}",id:"BwbZlzhj12",values:{count:l||0,link:(0,n.jsx)(x.Y,{href:o,children:(0,n.jsx)(w.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})})}),(0,n.jsx)(m.vW,{children:(0,n.jsx)(f.$,{variant:"primary",onClick:a,children:(0,n.jsx)(w.A,{defaultMessage:"Close",id:"rbrahOGMC3"})})})]})},H=e=>{var t,a,s;let{server:l,variant:o,onClick:c,enabledToolsCount:u,artifactId:h,versionUuid:m,isInDirectory:v=!1,onToggleAll:y,pendingAfterOAuth:C=!1}=e,_=(0,P.o)(),k=(0,M.QD)({queryString:h?"artifactId=".concat(encodeURIComponent(h),"&versionUuid=").concat(encodeURIComponent(m||"")):""}),[S,N]=(0,j.useState)(!1),A=S||l.isConnecting||C||!1;return(0,j.useEffect)(()=>{l.isConnected&&N(!1)},[l.isConnected]),(0,n.jsxs)("div",{className:(0,b.A)("w-full flex items-center justify-between rounded-lg bg-bg-000",c&&"connect"!==o&&"unavailable"!==o&&"loading"!==o&&"cursor-pointer hover:bg-bg-100 transition-colors"),onClick:"connect"===o||"unavailable"===o||"loading"===o?void 0:c,children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,n.jsx)(E.z,{size:28,imageSize:16,type:"favicon",src:l.url,name:l.name||l.url}),(0,n.jsxs)("div",{className:"flex gap-2 items-center min-w-0 flex-1",children:[(0,n.jsx)(g.m,{tooltipContent:l.url||l.name||"",children:(0,n.jsx)("div",{className:"font-medium text-sm truncate",children:l.name||l.url||""})}),!v&&(0,n.jsx)(r.E,{className:"flex-shrink-0",children:(0,n.jsx)(w.A,{defaultMessage:"CUSTOM",id:"Jg/zGahNtM"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:"connect"===o?(0,n.jsx)(f.$,{variant:"secondary",size:"sm",onClick:e=>{e.stopPropagation(),N(!0),k({uuid:l.uuid||"",url:l.url})},loading:A,className:"ml-2",children:(0,n.jsx)(w.A,{defaultMessage:"Connect",id:"+vVZ/G11Zg"})}):"loading"===o?(0,n.jsx)(f.$,{variant:"secondary",size:"sm",loading:!0,disabled:!0,className:"ml-2",children:(0,n.jsx)(w.A,{defaultMessage:"Connecting",id:"6q3tCnkd2h"})}):"unavailable"===o?(0,n.jsxs)("div",{className:"flex items-center gap-1 ml-2",children:[(0,n.jsx)(f.$,{variant:"secondary",size:"sm",disabled:!0,children:(0,n.jsx)(w.A,{defaultMessage:"Unavailable",id:"UpwcFdTuii"})}),(0,n.jsx)(g.m,{tooltipContent:(0,n.jsx)(w.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"}),children:(0,n.jsx)(x.Y,{href:_,className:"text-fg-400 hover:text-fg-300 transition-colors p-1",children:(0,n.jsx)(d.$,{className:"w-4 h-4"})})})]}):"toggle"===o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("label",{onClick:e=>e.stopPropagation(),children:(0,n.jsx)(i.j,{checked:u===((null==(t=l.tools)?void 0:t.length)||0)&&((null==(a=l.tools)?void 0:a.length)||0)>0,onChange:()=>{var e;let t=(null==(e=l.tools)?void 0:e.length)||0,a=u===t&&t>0;null==y||y(!a)}})}),(0,n.jsx)(p.J,{className:"w-4 h-4 text-fg-400"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.E,{children:(0,n.jsx)("span",{className:"text-accent-secondary-200",children:(0,n.jsx)(w.A,{defaultMessage:"{enabled} of {total}",id:"ln8LiF3/8T",values:{enabled:u,total:(null==(s=l.tools)?void 0:s.length)||0}})})}),(0,n.jsx)(p.J,{className:"w-4 h-4 text-fg-400"})]})})]})},I=e=>{let{isOpen:t,requestedServers:a,onClose:r,artifactContext:i}=e,d=(0,C.A)(),g=(0,P.o)(),p=(0,T.Uz)(),{servers:b}=(0,A.pL)(),M=(0,y.useSearchParams)(),E=M.get("server"),I="success"===M.get("step")&&!!E,{addError:O}=(0,l.Yf)(),U=d.formatMessage({defaultMessage:"Failed to save tool configuration. Please try again.",id:"ZohwwHXd08"}),{data:D}=(0,k.rX)(),F=!(null==D?void 0:D.disabled_features.includes("mcp_artifacts")),[K,$]=(0,j.useState)(null),[Y,X]=(0,j.useState)(""),[Z,q]=(0,j.useState)({}),{data:V}=(0,_.mt)({entityId:i.uuid,artifactEntityType:i.type,conversationUuid:i.conversation_uuid,filePath:i.file_path}),{connectorServers:B,directoryServers:J,unknownServers:G}=(0,j.useMemo)(()=>{if(!p)return{connectorServers:[],directoryServers:[],unknownServers:[]};let e=[...a||[]],t=new Set((null==a?void 0:a.map(e=>e.url).filter(Boolean))||[]);(null==V?void 0:V.mcp_servers)&&V.mcp_servers.forEach(a=>{t.has(a.url)||e.push({name:a.name,url:a.url})});let n=[],s=[],l=[];return e.forEach(e=>{let t=p.find(t=>{var a,n;let s="remote"===t.type,l=null==(a=t.url)?void 0:a.replace(/\/$/,""),r=null==(n=e.url)?void 0:n.replace(/\/$/,"");return s&&l===r});t?n.push({...t,isInDirectory:!!t.directoryMetadata}):b.some(t=>(0,L._c)(t,e.url))?s.push(e):l.push(e)}),{connectorServers:n,directoryServers:s,unknownServers:l}},[a,p,V,b]),Q=(0,S.vP)("enabled_mcp_tools"),W=(0,j.useMemo)(()=>Q||{},[Q]),{mutateAsync:ee}=(0,_.XJ)({entityId:i.uuid,artifactEntityType:i.type,conversationUuid:i.conversation_uuid,filePath:i.file_path}),et=(0,j.useCallback)(e=>e.tools?Y?e.tools.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase())):e.tools:[],[Y]);if((0,j.useEffect)(()=>{if((null==V?void 0:V.mcp_servers)&&(null==B?void 0:B.length)){let e={};V.mcp_servers.forEach(t=>{let a=B.find(e=>{var a,n;return(null==(a=e.url)?void 0:a.replace(/\/$/,""))===(null==(n=t.url)?void 0:n.replace(/\/$/,""))});(null==a?void 0:a.tools)&&a.tools.forEach(a=>{let n=t.allowed_tools.includes(a.name);e[a.enabledKey]=n})}),q(e)}else Object.keys(W).length>0&&q(W)},[V,B,W]),!B.length&&!J.length&&!G.length)return r(),null;if(!B.length&&!J.length)return(0,n.jsx)(z,{isOpen:t,onClose:r,variant:"empty",unknownServerCount:G.length});let ea=B.filter(e=>e.isConnected),en=e=>e.tools&&0!==e.tools.length?e.tools.filter(e=>!1!==Z[e.enabledKey]).length:null,es=ea.filter(e=>{let t=en(e);return null!==t&&t>0}).length,el=async e=>{try{await er(e),r()}catch(e){O(U,{error:e,errorContext:{tags:{source:"artifact_mcp_tool_config_save"}}})}},er=async e=>{let t=B.map(t=>{let a=t.tools||[],n=[],s=[],l=t.isConnected;return e&&a.length>0&&l?a.forEach(e=>{!1!==Z[e.enabledKey]?n.push(e.name):s.push(e.name)}):!e&&a.length>0&&a.forEach(e=>{s.push(e.name)}),{name:t.name||"",url:t.url||"",allowed_tools:n,disallowed_tools:s,pending_tool_section:!!e&&!l}}),a=[...J,...G].map(e=>({name:e.name||"",url:e.url||"",allowed_tools:[],disallowed_tools:[],pending_tool_section:!1}));await ee({mcp_servers:[...t,...a]})},eo=e=>!!e.tools&&0!==e.tools.length&&e.tools.filter(e=>!1!==Z[e.enabledKey]).length>0;return K?(0,n.jsx)(m.aF,{title:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>$(null),className:"hover:bg-bg-200 rounded transition-colors",children:(0,n.jsx)(v.A,{className:"w-5 h-5"})}),(0,n.jsx)("span",{children:(0,n.jsx)(w.A,{defaultMessage:"Customize {serverName}",id:"xtLJnxdHqO",values:{serverName:K.name||K.url||""}})})]}),isOpen:t,onClose:r,children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,n.jsx)("p",{className:"text-sm description-text-300",children:(0,n.jsx)(c.YX,{id:"crystal_muffin_bicycle"})}),(0,n.jsx)(h.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,n.jsxs)(R,{className:"!gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2.5 px-1.5",children:[(0,n.jsx)(u.v,{className:"w-4 h-4 text-text-500/50"}),(0,n.jsx)(o.ks,{placeholder:d.formatMessage({defaultMessage:"Search tools",id:"QVlai1/dYD"}),value:Y,onChange:e=>X(e.target.value),className:"flex-1 !border-none !outline-none !p-0 !text-sm text-text-300 placeholder:text-text-500/70"})]}),K.tools&&K.tools.length>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(N.$,{item:{key:"select-all",type:"switch",label:eo(K)?d.formatMessage({defaultMessage:"Disable all tools",id:"8A9N39nihk"}):d.formatMessage({defaultMessage:"Enable all tools",id:"x4/g36jIjW"}),icon:(0,n.jsx)(s.p,{letter:K.tools[0].name,size:16}),isChecked:eo(K),onClick:()=>{let e=!eo(K);if(K.tools){let t={...Z};K.tools.forEach(a=>{t[a.enabledKey]=e}),q(t)}}}}),(0,n.jsx)("div",{className:"border-t border-border-300"})]}),et(K).map(e=>{let t=e.enabledKey,a=!1!==Z[t];return(0,n.jsx)(N.$,{item:{key:t,type:"switch",label:e.name,icon:(0,n.jsx)(s.B,{letter:e.name,size:16}),isChecked:a,onClick:()=>{q(e=>({...e,[t]:!a}))}}},t)})]})})]})}):F?(0,n.jsxs)(m.aF,{title:d.formatMessage({defaultMessage:"Allow access to connectors",id:"5yCBRk9i5t"}),isOpen:t,onClose:r,children:[(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,n.jsx)("p",{className:"text-sm description-text-300",children:(0,n.jsx)(c.YX,{id:"penguin_tomato_umbrella"})}),(0,n.jsx)(h.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)(R,{children:[B.map(e=>{var t;let a,s=ea.includes(e),l=I&&e.uuid===E&&!s,r=e.isConnecting||l||!1,o=en(e),c=(null==(t=e.tools)?void 0:t.length)||0;return a=r?"loading":s?0===o||o===c?"toggle":"tools":"connect",(0,n.jsx)(H,{server:e,variant:a,onClick:()=>$(e),enabledToolsCount:o,artifactId:i.id,versionUuid:i.uuid,isInDirectory:!!e.isInDirectory,onToggleAll:t=>((e,t)=>{if(e.tools){let a={...Z};e.tools.forEach(e=>{a[e.enabledKey]=t}),q(a)}})(e,t),pendingAfterOAuth:l},e.uuid||e.url)}),J.length>0&&(0,n.jsxs)(n.Fragment,{children:[B.length>0&&(0,n.jsx)("div",{className:"border-t-0.5 border-border-300 -mx-5"}),J.map(e=>(0,n.jsx)(H,{server:e,variant:"unavailable",isInDirectory:!0},e.url))]}),G.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"border-t-0.5 border-border-300 -mx-5"}),(0,n.jsx)("p",{className:"text-xs text-text-500",children:(0,n.jsx)(w.A,{defaultMessage:"{count, plural, one {# requested connector is not in your directory and has been} other {# requested connectors are not in your directory and have been}} hidden. Some functionality may be limited. {link}",id:"BwbZlzhj12",values:{count:G.length,link:(0,n.jsx)(x.Y,{href:g,children:(0,n.jsx)(w.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})]})]}),(0,n.jsx)(R,{className:"bg-bg-100",children:(0,n.jsx)("p",{className:"text-sm text-text-500",children:(0,n.jsx)(w.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})})]})})]}),(0,n.jsx)(m.vW,{children:es>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.$,{variant:"secondary",onClick:r,children:(0,n.jsx)(w.A,{defaultMessage:"Not now",id:"dUCA4Khx0S"})}),(0,n.jsx)(f.$,{onClick:()=>el(!0),variant:"primary",children:(0,n.jsx)(w.A,{defaultMessage:"Continue with {count, plural, one {# connector} other {# connectors}}",id:"YL3kaz513s",values:{count:es}})})]}):(0,n.jsx)(f.$,{onClick:()=>el(!0),variant:"primary",children:(0,n.jsx)(w.A,{defaultMessage:"Continue without connectors",id:"0AAuZbbfFT"})})})]}):(0,n.jsx)(z,{isOpen:t,onClose:r,variant:"disabled"})}}}]);