try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5a961907-9021-4c78-9631-2eca3069e1ae",e._sentryDebugIdIdentifier="sentry-dbid-5a961907-9021-4c78-9631-2eca3069e1ae")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36016],{0xe0c26d90:(e,t,n)=>{n.d(t,{rs:()=>x,z6:()=>E,Tm:()=>T,$H:()=>k,q$:()=>O,b2:()=>A,oZ:()=>J,OV:()=>W,tn:()=>B,st:()=>R,CB:()=>L,nB:()=>Y,rW:()=>P,bo:()=>j,Cq:()=>N,b4:()=>K,yL:()=>M,vb:()=>V,FT:()=>U,VX:()=>H,QE:()=>$,FJ:()=>ee,ak:()=>G});var a=n(0x12c9046cd),r=n(0x20b939f38),u=n(0x1aa5f8b46),o=n(0x49fac030),s=n(0xac309a83),i=n(0x1b813d90),l=n(0x1bd175d8c),c=n(0x17e725145),d=n(0x20892a038),h=n(0x4d348f95),b=n(0xfc89b4a4),f=n(0x22be9474c),g=n(0x219f38dbd),p=n(0xe3b47ceb),y=n(0x1b910c896),v=n(0x21fe74567),_=n(0x18175ce17),m=n(0xc6857cab);let S="github_success";function w(e){return{"Content-Type":"application/json","anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29","anthropic-client-feature":"ccr",...e?{"x-organization-uuid":e}:{}}}let L=()=>(0,s.fS)("ghe_support_enabled");function T(e){if(e.ghe)try{return new URL(e.ghe.host).hostname}catch(t){return e.ghe.host}}function O(e){var t,n;return null!=(n=null==(t=e.ghe)?void 0:t.host)?n:"https://github.com"}function x(e){var t;return null!=(t=null==e?void 0:e.repos.some(e=>{var t;return(null==(t=e.status)?void 0:t.app_installed)===!0}))&&t}function k(e){let{isGithubAuthenticated:t,isListGithubReposLoading:n,githubReposData:a}=e;return!1!==t&&(void 0===t||n?void 0:x(a))}let D="branch-status-cache";function Q(e,t){return"".concat(e,":").concat(t)}function q(){try{let e=localStorage.getItem(D);if(!e)return{};return JSON.parse(e)}catch(e){return{}}}function C(e){try{localStorage.setItem(D,JSON.stringify(e))}catch(e){}}function E(e,t){let n=q(),a=Q(e,t),r=n[a];if(r){if(Date.now()-r.timestamp>864e5){delete n[a],C(n);return}return r.data}}function I(e){let t=q();t[Q(e.repo,e.branch)]={data:e,timestamp:Date.now()};let n=Object.entries(t);if(n.length>50)for(let[e]of(n.sort((e,t)=>e[1].timestamp-t[1].timestamp),n.slice(0,n.length-50)))delete t[e];C(t)}let Y=function(){var e,t;let{callerIdentifier:n,toggleGithubModalOpen:u,fetchImmediately:s=!1,pathname:i,queryString:c,shouldRedirectToDesktopApp:d}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:f}=(0,r.YL)(),p=null==f?void 0:f.uuid,m=N(),[w,L]=(0,b.useState)(s),T=(e=>{let{shouldFetch:t=!1}=e,{activeOrganization:n}=(0,r.YL)(),u=null==n?void 0:n.uuid,s=N();return(0,a.Sk)("/api/organizations/".concat(u,"/sync/github/auth"),{queryKey:[o.Hvb,{orgUuid:u}],enabled:!!(t&&n&&s),meta:{noToast:!0}})})({shouldFetch:w}),O=(0,b.useCallback)(async function(){var e,t;let{forceRefetch:n=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!w||n?(L(!0),null==(e=(await T.refetch()).data)?void 0:e.is_authenticated):null==(t=T.data)?void 0:t.is_authenticated},[T,w]),{mutate:x}=(0,a.L2)("/api/organizations/".concat(p,"/sync/github/auth/start"),"POST",{enabled:!!(f&&m),onSuccess:e=>{var t;let n=null!=(t=e.allowed_redirect_hosts)?t:["github.com"];if(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===t.length)return!1;try{if(!e.startsWith("http://")&&!e.startsWith("https://"))return!1;let n=new URL(e);return"https:"===n.protocol&&t.some(e=>n.hostname===e||n.hostname.endsWith(".".concat(e)))}catch(e){return!1}}(e.redirect_url,n))window.location.href=e.redirect_url;else throw Error("Invalid redirect URL received from auth endpoint")}}),k="".concat(S,"=").concat(n).concat(c?"&".concat(c):"");(0,_.FZ)({callerIdentifier:n,successParam:S,handleOpen:()=>{null==u||u(!0)}});let D=(0,h.useSearchParams)(),Q=(0,l.V)(),q=(0,b.useRef)(!1),C=(0,h.usePathname)(),E=(0,v.d)({pathname:i||C,searchParams:D,queryString:k,shouldOpenInClaudeApp:Q||!!d,isNestBuild:(null==(e=(0,y.B7)())?void 0:e.build)==="ClaudeNest"}),I=(0,g.o)({open_in_browser:"1",auth_start:"github",origin:E});return{checkIsGithubAuthenticated:O,initGithubAuth:()=>{if(m){if(Q)return void window.open(I);q.current||(q.current=!0,x({pre_auth_state:{origin:E}}))}},isGithubAuthenticated:null==(t=T.data)?void 0:t.is_authenticated,isLoading:T.isLoading}},P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,u=N(),s=(0,c.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(n,"/sync/github/auth"),"DELETE",{enabled:!!(t&&u),...e,onSuccess:function(){for(var t,a=arguments.length,r=Array(a),u=0;u<a;u++)r[u]=arguments[u];s.invalidateQueries({queryKey:[o.Hvb,{orgUuid:n}]}),null==(t=e.onSuccess)||t.call(e,...r)}})},N=()=>{let{data:e}=(0,_.LN)(),t=(0,r.mV)(),n=!!(Array.isArray(e)&&e.find(e=>e.type===i.v8.GITHUB&&e.enabled));return!!(!m.env.NEXT_PUBLIC_DISABLE_GITHUB_INTEGRATION&&(!t||n))},F=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,{data:n}=(0,d.useQuery)({queryKey:[o.Hvb,{orgUuid:t}],enabled:!1});return null==n?void 0:n.is_authenticated},K=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=N();return(0,a.Sk)("/api/organizations/".concat(t,"/sync/github/repos"),{queryKey:[o.jL,{orgUuid:t}],enabled:!!(e&&n),meta:{noToast:!0}})},M=function(){let{skipStatus:e,enabled:t=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,r.YL)(),u=null==n?void 0:n.uuid,o=N(),i=(0,s.fS)("bad_moon_rising_skip_status"),l=null!=e?e:i,c=new URLSearchParams({skip_status:l.toString()}).toString();return(0,a.Sk)("/api/organizations/".concat(u,"/code/repos?").concat(c),{queryKey:["SYNC_GH_REPOS_WITH_STATUS_QUERY_KEY",{orgUuid:u,skipStatus:l}],enabled:!!(n&&u&&o&&t),meta:{noToast:!0}})},z=e=>{let{owner:t,repo:n,branch:u,directoriesOnly:s=!1,recursive:i=!0,retry:l}=e,{activeOrganization:c}=(0,r.YL)(),d=null==c?void 0:c.uuid,h=N(),b=new URLSearchParams;s&&b.append("directories_only","true"),i||b.append("recursive","false");let f=b.toString(),g="/api/organizations/".concat(d,"/sync/github/repo/").concat(t,"/").concat(n,"/tree/").concat(u).concat(f?"?".concat(f):"");return(0,a.Sk)(g,{queryKey:[o.o6b,{orgUuid:d,owner:t,repo:n,branch:u,directoriesOnly:s,recursive:i}],staleTime:3e5,enabled:!!(t&&n&&u&&c&&h),meta:{noToast:!0},...void 0!==l&&{retry:l}})},R=e=>{let{owner:t,repo:n,sha:a}=e;return z({owner:t,repo:n,branch:a,directoriesOnly:!0,recursive:!1,retry:2})},B=e=>{var t;let{owner:n,repo:u,branch:s,directoriesOnly:i,recursive:l}=e,c=(e=>{let{owner:t,repo:n,branch:u}=e,{activeOrganization:s}=(0,r.YL)(),i=null==s?void 0:s.uuid,l=N(),c=new URLSearchParams({owner:null!=t?t:"",repo:null!=n?n:""}).toString();return(0,a.Sk)("/api/organizations/".concat(i,"/sync/github/repo?").concat(c),{queryKey:[o.yBg,{orgUuid:i,owner:t,repo:n}],enabled:!!(t&&n&&!u&&s&&l),meta:{noToast:!0}})})({owner:n,repo:u,branch:s}),d=z({owner:n,repo:u,branch:s||(null==(t=c.data)?void 0:t.default_branch),directoriesOnly:i,recursive:l});return{data:{repo:c.data,tree:d.data},isFetching:c.isFetching||d.isFetching,error:c.error||d.error}},U=e=>{let{owner:t,repo:n,query:u,directoriesOnly:o,filePathsOnly:s,page:i,perPage:l=30}=e,{activeOrganization:c}=(0,r.YL)(),d=null==c?void 0:c.uuid,h=N(),b=new URLSearchParams;return u&&b.set("q",u),o&&b.set("directories_only","true"),s&&b.set("file_paths_only","true"),i&&b.set("page",i.toString()),b.set("per_page",l.toString()),(0,a.Sk)("/api/organizations/".concat(d,"/sync/github/repo/").concat(t,"/").concat(n,"/search?").concat(b.toString()),{queryKey:["GITHUB_REPO_SEARCH",{orgUuid:d,owner:t,repo:n,query:u,directoriesOnly:o,filePathsOnly:s,page:i,perPage:l}],staleTime:3e5,enabled:!!(t&&n&&u&&c&&h),meta:{noToast:!0}})},j=e=>{let{repoBranches:t,enabled:n=!0}=e,{activeOrganization:s}=(0,r.YL)(),i=null==s?void 0:s.uuid,l=N(),c=(0,a.mn)(),h=F(),f=[...t].sort((e,t)=>"".concat(e.repo,":").concat(e.branch).localeCompare("".concat(t.repo,":").concat(t.branch))),g=(0,b.useMemo)(()=>{if(0===f.length)return;let e=function(e){let t=q(),n=Date.now(),a=[];for(let{repo:r,branch:u}of e){let e=t[Q(r,u)];if(!e||n-e.timestamp>864e5)return;a.push(e.data)}return a}(f);return e?{branch_statuses:e}:void 0},[]);return(0,d.useQuery)({queryKey:[o.uhr,{orgUuid:i,repoBranches:f}],queryFn:async()=>{let e=await c("/v1/code/github/batch-branch-status",{method:"POST",headers:w(i),body:JSON.stringify({repo_branches:f})});(0,u.cG)(e,"Failed to fetch branch statuses.");let t=await e.json();for(let e of(p.D8.getState().setStatuses(t.branch_statuses),t.branch_statuses))I(e);return t},enabled:!!(s&&l&&!1!==h&&f.length>0&&n),staleTime:12e4,refetchOnWindowFocus:!0,placeholderData:e=>null!=g?g:e,...u.Qr,meta:{noToast:!0}})},A=()=>{var e;let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,{data:u,isLoading:s}=(0,a.Sk)("/api/organizations/".concat(n,"/sync/github/auth"),{queryKey:[o.Hvb,{orgUuid:n}],enabled:!!t,meta:{noToast:!0}}),i=null==u?void 0:u.is_authenticated,{data:l,isLoading:c}=(0,a.Sk)("/api/organizations/".concat(n,"/sync/github/repos?limit=0"),{queryKey:[o.jL,{orgUuid:n}],enabled:!!(t&&i),meta:{noToast:!0}}),{data:d,isLoading:h}=(0,f.Nj)(null==t?void 0:t.uuid),g=(0,b.useMemo)(()=>{var e,t;return new Set((null!=(t=null==d||null==(e=d.settings)?void 0:e.vcs_connections)?t:[]).filter(e=>"github"===e.type).map(e=>e.org_name))},[null==d||null==(e=d.settings)?void 0:e.vcs_connections]);return{data:{orgs:(0,b.useMemo)(()=>{let e=[],t=new Set;if(l)for(let n of l){let a=n.owner;if("Organization"!==a.type)continue;let r=a.login;t.has(r)||(t.add(r),e.push({id:r,login:r,selectedForAnalytics:g.has(r)}))}return e},[l,g])},isLoading:s||h||c,isGithubAuthenticated:i}},G=()=>{var e,t;let{activeOrganization:n}=(0,r.YL)(),a=(0,c.useQueryClient)(),{data:u}=(0,f.Nj)(null==n?void 0:n.uuid),{mutate:s,isPending:i}=(0,f.NE)({onSuccess:e=>{a.setQueryData([o.i50,null==n?void 0:n.uuid],e)}}),l=(0,b.useCallback)(e=>{s({vcs_connections:e})},[s]),d=(0,b.useCallback)((e,t)=>{var n,a;let r=null!=(a=null==u||null==(n=u.settings)?void 0:n.vcs_connections)?a:[];r.some(t=>"github"===t.type&&t.org_name===e)||l([...r,{type:"github",org_name:e,org_id:t}])},[null==u||null==(e=u.settings)?void 0:e.vcs_connections,l]),h=(0,b.useCallback)(e=>{var t,n;l((null!=(n=null==u||null==(t=u.settings)?void 0:t.vcs_connections)?n:[]).filter(t=>"github"!==t.type||t.org_name!==e))},[null==u||null==(t=u.settings)?void 0:t.vcs_connections,l]);return{updateVcsConnections:l,addGithubOrg:d,removeGithubOrg:h,isPending:i}},H=e=>{let{repo:t,branch:n,enabled:s=!0,polling:i=!0}=e;(e=>{let{repo:t,branch:n,enabled:s=!0,polling:i=!0}=e,{activeOrganization:l}=(0,r.YL)(),c=null==l?void 0:l.uuid,h=N(),f=(0,a.mn)(),g=F(),y=(0,b.useMemo)(()=>t&&n?E(t,n):void 0,[t,n]);return(0,d.useQuery)({queryKey:[o.i8w,{orgUuid:c,repo:t,branch:n}],queryFn:async()=>{let e=await f("/v1/code/github/batch-branch-status",{method:"POST",headers:w(c),body:JSON.stringify({repo_branches:[{repo:t,branch:n}]})});(0,u.cG)(e,"Failed to fetch single branch status.");let a=(await e.json()).branch_statuses[0];return a&&(p.D8.getState().setStatus(a),I(a)),null!=a?a:null},enabled:!!(l&&h&&!1!==g&&t&&n&&s),staleTime:3e4,refetchOnWindowFocus:!0,...i?{refetchInterval:(0,u.n5)(6e4),refetchIntervalInBackground:!1}:{},placeholderData:y,...u.Qr,meta:{noToast:!0}})})({repo:t,branch:n,enabled:s,polling:i});let l=(0,p.uv)(t,n);if(s)return l},W=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)("/api/github/organizations/".concat(t,"/generate_pr_content"),"POST",{enabled:!!e})},J=function(){let{onSuccess:e,onError:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,r.YL)(),u=null==n?void 0:n.uuid,s=(0,c.useQueryClient)();return(0,a.L2)("/api/github/organizations/".concat(u,"/github_create_pr"),"POST",{enabled:!!n,onSuccess:(t,n)=>{let a={number:t.number,additions:0,deletions:0,commits:0,state:t.state,url:t.html_url};s.setQueryData([o.i8w,{orgUuid:u,repo:n.repo,branch:n.head}],e=>e?{...e,pull_request:a}:e);let r=n.head.includes(":")?n.head.split(":")[1]:n.head,i=p.D8.getState();for(let e of Object.values(i.statuses))e.branch===r&&i.setStatus({...e,pull_request:a});s.setQueriesData({queryKey:[o.uhr]},e=>e?{...e,branch_statuses:e.branch_statuses.map(e=>e.branch===r?{...e,pull_request:a}:e)}:e),null==e||e(t)},onError:t})},V=e=>{let{sessionId:t,repo:n,branch:s,prNumber:i,enabled:l=!0}=e,{activeOrganization:c}=(0,r.YL)(),h=null==c?void 0:c.uuid,b=N(),f=(0,a.mn)(),g=F();return(0,d.useQuery)({queryKey:[o.daO,{orgUuid:h,sessionId:t,repo:n,branch:s,prNumber:i}],queryFn:async()=>{var e,a;let r=await f("/v1/code/github/batch-branch-status",{method:"POST",headers:w(h),body:JSON.stringify({repo_branches:[{repo:n,branch:s}],session_id:t})});return(0,u.cG)(r,"Failed to fetch PR subscription status."),null!=(a=null==(e=(await r.json()).branch_statuses[0])?void 0:e.has_session_binding)&&a},enabled:!!(c&&b&&!1!==g&&t&&n&&s&&l),staleTime:1/0,refetchOnWindowFocus:!1,...u.Qr,meta:{noToast:!0}})};function X(e,t){let{session_id:n,status_repo:a,branch:r,pr_number:u}=t;return[o.daO,{orgUuid:e,sessionId:n,repo:a,branch:r,prNumber:u}]}function Z(e){let{branch:t,status_repo:n,...a}=e;return a}let $=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=(0,c.useQueryClient)();return(0,a.L2)("/v1/code/github/subscribe-pr","POST",{enabled:!!e,headers:w(t),transformVariables:Z,onMutate:e=>{let a=X(t,e),r=n.getQueryData(a);return n.setQueryData(a,!0),{previous:r}},onError:(e,a,r)=>{n.setQueryData(X(t,a),null==r?void 0:r.previous)}})},ee=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=(0,c.useQueryClient)();return(0,a.L2)("/v1/code/github/unsubscribe-pr","POST",{enabled:!!e,headers:w(t),transformVariables:Z,onMutate:e=>{let a=X(t,e),r=n.getQueryData(a);return n.setQueryData(a,!1),{previous:r}},onError:(e,a,r)=>{n.setQueryData(X(t,a),null==r?void 0:r.previous)}})}},0xe3b47ceb:(e,t,n)=>{n.d(t,{D8:()=>l,GK:()=>i,oQ:()=>d,uv:()=>c});var a=n(0x16ab3413b),r=n.n(a),u=n(0x394ef833),o=n(0x107838ca5);function s(e,t){return"".concat(e,":").concat(t)}function i(e,t){return s(e,t)}let l=(0,u.v)(e=>({statuses:function(){try{let e=localStorage.getItem("branch-status-cache");if(!e)return{};let t=JSON.parse(e),n={},a=Date.now();for(let[e,r]of Object.entries(t))a-r.timestamp<=864e5&&(n[e]=r.data);return n}catch(e){return{}}}(),setStatus:t=>e(e=>{let n=s(t.repo,t.branch);return r()(e.statuses[n],t)?e:{statuses:{...e.statuses,[n]:t}}}),setStatuses:t=>e(e=>{let n=[];for(let a of t){let t=s(a.repo,a.branch);r()(e.statuses[t],a)||n.push({key:t,status:a})}if(0===n.length)return e;let a={...e.statuses};for(let{key:e,status:t}of n)a[e]=t;return{statuses:a}})}));function c(e,t){return l(n=>e&&t?n.statuses[s(e,t)]:void 0)}function d(e){return l((0,o.k)(t=>{let n={};for(let a of e){let e=t.statuses[a];e&&(n[a]=e)}return n}))}},0x1aa5f8b46:(e,t,n)=>{n.d(t,{Qr:()=>o,cG:()=>r,n5:()=>s});class a extends Error{constructor(e,t){super(t),this.name="HttpError",this.statusCode=e}}function r(e,t){if(!e.ok)throw new a(e.status,null!=t?t:"Request failed: ".concat(e.status," ").concat(e.statusText))}function u(e){let t=e.statusCode;return!!t&&t>=400&&t<500}let o={retry:(e,t)=>!u(t)&&e<2,retryDelay:e=>Math.min(1e3*2**e,3e4)};function s(e){return t=>!(t.state.error&&u(t.state.error))&&(t.state.fetchFailureCount>0?Math.min(e*2**(t.state.fetchFailureCount-1),3e5):e)}}}]);