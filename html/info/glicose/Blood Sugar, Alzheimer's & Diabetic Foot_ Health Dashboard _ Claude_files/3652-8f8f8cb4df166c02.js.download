try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0199f091-5723-4750-be5d-792483bd9a2c",e._sentryDebugIdIdentifier="sentry-dbid-0199f091-5723-4750-be5d-792483bd9a2c")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3652],{0x18bfd014:(e,t,n)=>{n.d(t,{S:()=>p,r:()=>m});var s=n(0x22102fd88),o=n(0xf32c56dd),a=n(0x20e00cddd),r=n(0x286b4261),i=n.n(r),l=n(0x4d348f95),u=n(0xfc89b4a4),d=n(0xb6b8b1fb);let c=u.createContext({incognitoModeEnabled:!1,setIncognitoModeEnabled:i(),temporaryConversationUuid:null,setTemporaryConversationUuid:i()}),p=()=>u.useContext(c),m=e=>{let{children:t}=e,n=(0,o.st)(),r=(0,l.useRouter)(),i=(0,l.useSearchParams)(),p=(0,d.I_)(),m=i.has(a.cn),[f,g]=(0,u.useState)(m),v=(0,u.useRef)(f),[y,h]=(0,u.useState)(null);(0,u.useEffect)(()=>{v.current=f},[f]),(0,u.useEffect)(()=>{m&&!f&&g(!0)},[m,f]);let _=(0,u.useCallback)(e=>{if(g(e),e)r.push("?".concat(a.cn));else{h(null);let e=new URLSearchParams(window.location.search);e.delete(a.cn);let t=e.toString();r.push("".concat(window.location.pathname).concat(t?"?".concat(t):""),void 0)}n.track({event_key:"claudeai.incognito_mode.toggled",enabled:e})},[r,n]);(0,u.useEffect)(()=>{v.current&&!m&&_(!1)},[_,m]),(0,u.useEffect)(()=>{var e,t;null==(t=window.electronWindowControl)||null==(e=t.setIncognitoMode)||e.call(t,f)},[f]);let x=(0,u.useMemo)(()=>({incognitoModeEnabled:!!p&&f,setIncognitoModeEnabled:_,temporaryConversationUuid:p?y:null,setTemporaryConversationUuid:h}),[f,_,y,h,p]);return(0,s.jsx)(c.Provider,{value:x,children:t})}},0x332e2b3b:(e,t,n)=>{n.d(t,{G:()=>r,P:()=>a});var s=n(0x394ef833),o=n(0x16784b660);let a=(0,s.v)()((0,o.Zr)(e=>({prs:{},setPr:(t,n)=>e(e=>{let s=e.prs[t];return s&&s.prNumber===n.prNumber&&s.prUrl===n.prUrl&&s.prState===n.prState?e:{prs:{...e.prs,[t]:{...n,updatedAt:Date.now()}}}}),setPrState:(t,n)=>e(e=>{let s=e.prs[t];return s&&s.prState!==n?{prs:{...e.prs,[t]:{...s,prState:n,updatedAt:Date.now()}}}:e}),removePr:t=>e(e=>{let{[t]:n,...s}=e.prs;return{prs:s}}),removePrsForSession:t=>e(e=>({prs:Object.fromEntries(Object.entries(e.prs).filter(e=>{let[n]=e;return n!==t&&!n.startsWith("".concat(t,":"))}))}))}),{name:"session-pr-store",storage:(0,o.KU)(()=>localStorage),onRehydrateStorage:()=>e=>{if(!e)return;let t=Date.now(),n=Object.entries(e.prs).filter(e=>{let[,n]=e;return t-n.updatedAt<6048e5});n.length>100&&(n.sort((e,t)=>{let[,n]=e,[,s]=t;return s.updatedAt-n.updatedAt}),n.length=100),e.prs=Object.fromEntries(n)}}));function r(e){return a(t=>e?t.prs[e]:void 0)}},0x87544a63:(e,t,n)=>{n.d(t,{A:()=>i,Ac:()=>r,Le:()=>l,X4:()=>a});var s=n(0x1a3383306),o=n(0xfc89b4a4);let a=(0,n(0x394ef833).v)((e,t)=>({pending:null,setPending:t=>e({pending:t}),consumeIfMatches:n=>{let s=t().pending;return s&&s.conversationUuid===n?(e({pending:null}),s.attachment):null}}));function r(e,t){let n=a(e=>e.pending),s=a(e=>e.consumeIfMatches);(0,o.useEffect)(()=>{if(n&&e){let n=s(e);n&&t(e=>[...e,n])}},[n,e,s,t])}function i(e){return{progressItems:e.filter(e=>e.kind===s.XA.ProgressItem),toSend:e.filter(e=>e.kind!==s.XA.ProgressItem)}}function l(e,t,n){if(0===t.length)return e;let s=t.map(e=>n.formatMessage({defaultMessage:'[Regarding Todo item: "{content}"]',id:"lAuWsTmwsz",description:"Prefix added to the prompt when user comments on a todo item from the progress panel"},{content:e.extracted_content})).join("\n");return"".concat(s,"\n\n").concat(e)}},0x8cde4874:(e,t,n)=>{n.d(t,{dR:()=>Y,dU:()=>O,CC:()=>E,pL:()=>j});var s=n(0xf32c56dd),o=n(0x10728a05e),a=n(0x9845e38c),r=n(0xac309a83),i=n(0x1b813d90),l=n(0xd126dc1a),u=n(0x253a5c787),d=n(0x78b33fbd),c=n(0x20892a038),p=n(0xfc89b4a4),m=n(0x156c4e43b),f=n(0x18175ce17),g=n(0x2230d6f61);let v={includeScore:!0,isCaseSensitive:!1,ignoreLocation:!0,threshold:.2,keys:[{name:"name",weight:.4},{name:"toolNames",weight:.3},{name:"oneLiner",weight:.2},{name:"description",weight:.1}]};var y=n(0x18d05d4ac),h=n(0x1f6a370bc),_=n(0xe824fb1c),x=n(0xc6857cab);class b extends Error{constructor(e,t){let n=e instanceof Error?e.name:"Unknown",s=e instanceof Error?e.message:String(e),o=e instanceof Error&&e.cause?String(e.cause):void 0;super("Registry fetch failed: ".concat(n,": ").concat(s)),this.name="RegistryFetchError",this.cause=e,this.diagnostics={url:t,onLine:"undefined"==typeof navigator||navigator.onLine,readyState:"undefined"!=typeof document?document.readyState:"complete",visibilityState:"undefined"!=typeof document?document.visibilityState:"visible",timeSincePageLoad:"undefined"!=typeof performance?Math.round(performance.now()):-1,errorName:n,errorMessage:s,errorCause:o}}}let S=m.Ik({uuid:m.Yj(),type:m.k5(["remote","local"]),oneLiner:m.Yj(),iconUrl:m.Yj(),documentation:m.Yj(),support:m.Yj(),privacyPolicy:m.Yj(),author:m.Ik({name:m.Yj(),url:m.Yj()}),worksWith:m.YO(m.k5(["claude","claude-api","claude-code","claude-desktop"])),toolNames:m.YO(m.Yj()).optional(),promptNames:m.YO(m.Yj()).optional(),isAuthless:m.zM().optional(),urlRegex:m.Yj().optional(),requiredFields:m.YO(m.Ik({field:m.k5(["custom_oauth_client_id","custom_oauth_client_secret","url"]),sourceUrl:m.Yj()})).optional(),useCases:m.YO(m.Yj()).optional(),permissions:m.Yj().optional(),claudeCodeCopyText:m.Yj().optional(),claudeCodeExternalLink:m.Yj().optional(),imageUrls:m.YO(m.Ik({prompt:m.Yj().optional(),imageUrl:m.Yj()})).optional(),hasMcpApp:m.zM().optional(),slug:m.Yj().optional(),logo:m.Yj().optional(),backgroundPattern:m.Yj().optional(),heroVideoId:m.Yj().optional(),heroVideoPreviewLink:m.Yj().optional(),htmlContent:m.Yj().optional(),itemId:m.Yj().optional(),collectionId:m.Yj().optional(),localeId:m.Yj().optional()}),w=m.Ik({server:m.Ik({name:m.Yj(),version:m.Yj(),title:m.Yj(),description:m.Yj().optional(),remotes:m.YO(m.Ik({type:m.Yj(),url:m.Yj()})).optional(),repository:m.Ik({url:m.Yj().optional(),source:m.Yj().optional()}).optional()}),_meta:m.Ik({"com.anthropic.api/mcp-registry":S})}),k=m.Ik({servers:m.YO(w),metadata:m.Ik({count:m.ai(),nextCursor:m.Yj().optional()})});function C(e){var t,n,s;let o=e._meta["com.anthropic.api/mcp-registry"],a=null==(n=e.server.remotes)||null==(t=n.find(e=>"streamable-http"===e.type||"sse"===e.type))?void 0:t.url;if(!a&&!o.urlRegex)return null;let r={uuid:o.uuid,name:e.server.title,oneLiner:o.oneLiner,description:e.server.description||"",iconUrl:o.iconUrl,toolNames:o.toolNames||[],promptNames:o.promptNames||[],version:e.server.version,author:o.author,documentation:o.documentation,support:o.support,privacyPolicy:o.privacyPolicy,requiredFields:o.requiredFields,imageUrls:o.imageUrls,hasMcpApp:o.hasMcpApp,useCases:o.useCases,type:"remote",isAuthless:null==(s=o.isAuthless)||s};return o.urlRegex?{...r,url:void 0,urlRegex:o.urlRegex}:{...r,url:a,urlRegex:void 0}}async function M(e,t){let n,s=[];do{let o,a=new URL("".concat(function(){let e="1"===x.env.NEXT_PUBLIC_ENABLE_PUBSEC_BANNER,t=!0===window.desktopPubsecBannerEnabled;return(e||t)&&1?window.location.origin:"https://api.anthropic.com"}(),"/mcp-registry/v0/servers"));a.searchParams.set("version","latest"),a.searchParams.set("limit","100"),n&&a.searchParams.set("cursor",n),e&&e.length>0&&a.searchParams.set("visibility",e.join(","));try{o=await fetch(a.toString())}catch(e){throw new b(e,a.toString())}if(!o.ok)throw new b(Error("HTTP ".concat(o.status,": ").concat(o.statusText)),a.toString());let r=await o.json(),i=k.safeParse(r);if(!i.success)throw new b(Error("Invalid response format: ".concat(i.error.message)),a.toString());let l=i.data.servers.filter(e=>!t||!t.has(e.server.name)).map(C).filter(e=>null!==e);s.push(...l),n=i.data.metadata.nextCursor}while(n);if(0===s.length){let t=Error("Unified registry fetch succeeded but returned 0 servers");a.v.error(a.u.MCP,t.message,{visibility:e}),(0,u.Cp)(t,{tags:{source:"unified_mcp_directory_empty"},extra:{visibility:e}})}return s}let I=m.YO(m.Yj()),P=null;function T(e){var t;let n=(0,_.OT)(e.uuid);return{uuid:e.uuid,name:e.name,oneLiner:e.oneLiner,description:e.description,iconUrl:e.iconUrl,url:e.url,toolNames:e.toolNames,isConnected:null!=(t=null==n?void 0:n.isConnected)&&t}}async function E(){let e=(0,r.Js)("conditional_mcp_directory_servers","visibility",[]),t=I.safeParse(e),n=t.success?t.data:[],s=(0,r._f)("mcp_gdrive");return await M(n,s?void 0:A)}let A=new Set(["com.anthropic.api.mcp.gdrive/google-drive"]),j=()=>{let{addError:e}=(0,o.Yf)(),{track:t}=(0,s.st)(),n=(0,p.useRef)(!1),r=(0,f.kO)(),i=(0,d.useDynamicConfig)("conditional_mcp_directory_servers"),m=(0,l.f)(i.get("visibility",[])),{data:g,error:v,isPending:y}=(0,c.useQuery)({queryKey:["unified-mcp-directory",m,r],queryFn:e=>{let{queryKey:[,t,n]}=e;return M(t,n?void 0:A)},staleTime:18e5,gcTime:18e5,refetchOnWindowFocus:!1});return(0,p.useEffect)(()=>{if(v&&v!==P){P=v;let t={tags:{source:"unified_mcp_directory_fetch"},extra:v instanceof b?v.diagnostics:void 0};v instanceof b?a.v.error(a.u.MCP,"Registry fetch failed with diagnostics:",v.diagnostics):a.v.error(a.u.MCP,"Registry fetch failed:",v),(0,u.Cp)(v,t),e("Could not load connectors directory.",{error:v,errorContext:t})}},[v,e]),(0,p.useEffect)(()=>{g&&0===g.length&&!n.current&&(n.current=!0,t({event_key:"claudeai.mcp_registry_empty",visibility_tags:m}))},[g,t,m]),{servers:(0,l.f)(null!=g?g:[]),isLoading:y}},L=new Set([i.v8.GMAIL,i.v8.GCAL,i.v8.GDRIVE]),U=new Set([i.v8.GMAIL,i.v8.GCAL]);function F(){let e=(0,r.Js)("yukon_silver_config","showGsuiteConnectors",!1),t=(0,r._f)("enabled_brioche"),n=(0,r._f)("mcp_gdrive");return h.C.filter(s=>!(t&&U.has(s.syncSourceType))&&(!n||s.syncSourceType!==i.v8.GDRIVE)&&(!L.has(s.syncSourceType)||e))}function R(){let e=_.eZ.getState(),t=[];for(let[o,a]of Object.entries(e.remoteServers)){var n,s;if(!a||e.remoteDirectories[o])continue;let r=e.remoteConnectionStates[o],i=null!=(n=e.remoteTools[o])?n:[];t.push({uuid:a.uuid,name:a.name,oneLiner:"",description:"",iconUrl:void 0,url:a.url,toolNames:i.map(e=>e.name),isConnected:null!=(s=null==r?void 0:r.isConnected)&&s})}return t}async function O(e,t){let n=await E(),s=F(),o=n.filter(e=>"remote"===e.type),a=t?(0,y.c)(o,t).approvedServers:o,r=R();return function(e,t){let n=t.map(e=>e.trim()).filter(e=>e.length>0);if(0===n.length)return e;let s=new g.A(e,v),o=new Map;for(let e of n)for(let t of s.search(e)){var a;let e=t.item.uuid,n=1-(null!=(a=t.score)?a:1),s=o.get(e);s?s.totalQuality+=n:o.set(e,{item:t.item,totalQuality:n})}let r=n.map(e=>e.toLowerCase());for(let e of o.values()){let t=e.item.name.toLowerCase();r.some(e=>t.includes(e))&&(e.totalQuality+=.6*n.length)}return[...o.values()].sort((e,t)=>t.totalQuality-e.totalQuality).map(e=>e.item)}([...a.map(T),...s.map(T),...r],e)}async function Y(e,t){let n=new Set(e),s=await E(),o=F(),a=R(),r=s.filter(e=>"remote"===e.type&&n.has(e.uuid)),i=[...(t?(0,y.c)(r,t).approvedServers:r).map(T),...o.filter(e=>n.has(e.uuid)).map(T),...a.filter(e=>n.has(e.uuid))],l=new Set(i.map(e=>e.uuid)),u=[...n].filter(e=>!l.has(e));if(u.length>0){let e=function(e){let t=_.eZ.getState(),n=new Set(e),s=[];for(let[e,r]of Object.entries(t.remoteServers)){var o,a;if(!r||!n.has(e))continue;let i=t.remoteConnectionStates[e],l=null!=(o=t.remoteTools[e])?o:[];s.push({uuid:r.uuid,name:r.name,oneLiner:"",description:"",iconUrl:void 0,url:r.url,toolNames:l.map(e=>e.name),isConnected:null!=(a=null==i?void 0:i.isConnected)&&a})}return s}(u);i.push(...e)}return i}},0x8fd88b73:(e,t,n)=>{n.d(t,{v:()=>a});var s=n(0x20b939f38),o=n(0xc1dd9efc);let a=()=>{let{account:e,activeOrganization:t}=(0,s.YL)(),n=(0,s.mV)(),a=(0,o.pG)(e,t,"claude-ai"),r=(0,o.yI)(e,t,o.Nt.IntegrationsManage);return!n||a||r}},0x9855f705:(e,t,n)=>{n.d(t,{Jd:()=>a,Rl:()=>u,UC:()=>c,aC:()=>o,al:()=>d,ax:()=>r,oL:()=>p,q1:()=>i,xR:()=>l});var s=n(0xfc89b4a4);let o=(0,n(0x394ef833).v)(e=>({expandedBySession:{},activeSessionId:null,setIsExpandedForSession:(t,n)=>e(e=>({expandedBySession:{...e.expandedBySession,[t]:n}})),setActiveSession:t=>e({activeSessionId:t}),toggleForSession:t=>e(e=>{var n;return{expandedBySession:{...e.expandedBySession,[t]:!(null==(n=e.expandedBySession[t])||n)}}})})),a=e=>o(t=>{var n;return!!e&&(null==(n=t.expandedBySession[e])||n)}),r=()=>o(e=>{var t;return!!e.activeSessionId&&(null==(t=e.expandedBySession[e.activeSessionId])||t)}),i=()=>o(e=>e.toggleForSession),l=()=>{let e=o(e=>e.toggleForSession),t=o(e=>e.activeSessionId);return(0,s.useCallback)(()=>{t&&e(t)},[e,t])},u=()=>o(e=>e.setIsExpandedForSession),d=()=>{let e=o(e=>e.setIsExpandedForSession),t=o(e=>e.activeSessionId);return(0,s.useCallback)(n=>{t&&e(t,n)},[e,t])},c=()=>o(e=>e.setActiveSession),p=e=>{let t=a(e),n=u();return(0,s.useEffect)(()=>{if(!e)return;let t=window.matchMedia("(min-width: 1024px)"),s=t=>{t.matches||n(e,!1)};return t.addEventListener("change",s),s(t),()=>t.removeEventListener("change",s)},[e,n]),t}},0xb2217001:(e,t,n)=>{n.d(t,{QT:()=>d,nB:()=>u});var s=n(0x394ef833),o=n(0x107838ca5);async function a(e,t){let n=Math.floor(e.length/4.5),s=await new Promise(n=>{let s=new Image;s.onload=()=>{s.naturalWidth>0&&s.naturalHeight>0?n({width:s.naturalWidth,height:s.naturalHeight}):n(null)},s.onerror=()=>n(null),s.src="data:".concat(t,";base64,").concat(e)});return s?Math.ceil(s.width/28)*Math.ceil(s.height/28)+2:n+2}async function r(e){let t=new TextEncoder,n=0;for(let s of e)"text"===s.type?n+=Math.floor(t.encode(s.text).length/4.5):"image"===s.type&&(n+=await a(s.data,s.mimeType));return n}class i extends Error{constructor(e,t,n){super("Model context for '".concat(e,"' exceeds maximum size. Current: ~").concat(t," tokens, limit: ").concat(n," tokens.")),this.toolName=e,this.tokens=t,this.maxTokens=n,this.name="ModelContextTooLargeError"}}let l=(0,s.v)((e,t)=>({statesByConversation:{},updateModelContext:async(t,n,s)=>{let o=await r(s);if(o>Math.floor(4400))throw new i(n,o,4e3);let a=s.flatMap(e=>"text"===e.type?[{type:"text",text:e.text}]:"image"===e.type?[{type:"image",data:e.data,media_type:e.mimeType}]:[]);e(e=>{var s;let o=null!=(s=e.statesByConversation[t])?s:{};return{statesByConversation:{...e.statesByConversation,[t]:{...o,[n]:{tool_name:n,content:a}}}}})},getModelContextStates:e=>{let n=t().statesByConversation[e];return n?Object.values(n):[]},clearConversationStates:t=>{e(e=>{let{[t]:n,...s}=e.statesByConversation;return{statesByConversation:s}})}}));function u(e,t){let n=l(e=>e.updateModelContext);return e&&t?async s=>{await n(e,t,s)}:async e=>{}}function d(e){return l((0,o.k)(t=>{if(!e)return[];let n=t.statesByConversation[e];return n?Object.values(n):[]}))}},0xb6b8b1fb:(e,t,n)=>{n.d(t,{Ah:()=>L,BV:()=>D,DO:()=>P,I_:()=>R,L1:()=>M,MT:()=>U,Mf:()=>I,P2:()=>N,PB:()=>E,Rb:()=>Y,SK:()=>A,Sb:()=>b,UG:()=>T,Uq:()=>v,bb:()=>y,ey:()=>S,kY:()=>h,lH:()=>j,mM:()=>w,t5:()=>O,tW:()=>x,xt:()=>F});var s=n(0x17aa9d8d7),o=n(0xf32c56dd),a=n(0x12c9046cd),r=n(0x20b939f38),i=n(0x10728a05e),l=n(0x49fac030),u=n(0xac309a83),d=n(0x17e725145),c=n(0xfc89b4a4),p=n(0x1ab0d1ca1),m=n(0x156c4e43b),f=n(0x87b1176c),g=n(0x22be9474c);let v="https://support.anthropic.com/articles/11817273-how-does-claude-s-memory-work",y="https://privacy.anthropic.com/en/articles/10023580-is-my-data-used-for-model-training",h="https://support.anthropic.com/en/articles/11817273-using-claude-s-chat-search-and-memory-to-build-on-previous-context#h_4e397dd299",_=m.Ik({memory:m.Yj(),controls:m.YO(m.Yj()).nullable(),updated_at:m.Yj().datetime({offset:!0}).nullable()}),x=(e,t)=>{var n;let{account:s,activeOrganization:o}=(0,r.YL)(),i=null==s?void 0:s.uuid,u=null==o?void 0:o.uuid,d=I(),c=e?"/api/organizations/".concat(u,"/memory?project_uuid=").concat(e):"/api/organizations/".concat(u,"/memory");return(0,a.Sk)(c,{queryKey:[l.IX,{accountUuid:i,orgUuid:u,projectUuid:e}],enabled:!!o&&(null==(n=null==t?void 0:t.enabled)||n)&&d},e=>_.parse(e))},b=()=>{let{account:e,activeOrganization:t}=(0,r.YL)(),n=null==e?void 0:e.uuid,s=null==t?void 0:t.uuid,o=I(),{addError:u}=(0,i.Yf)(),c=(0,p.A)(),m=(0,d.useQueryClient)(),{mutate:f,isPending:g}=(0,a.L2)("/api/organizations/".concat(s,"/memory/synthesize"),"POST",{enabled:!!t&&o,onSuccess:function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];let[a,r]=t;m.invalidateQueries({queryKey:[l.IX,{accountUuid:n,orgUuid:s,projectUuid:r.project_uuid}]})},onError:()=>{u(c.formatMessage({defaultMessage:"Something went wrong while updating memory",id:"P1AER5mU4P"}),{messageForLogging:"Something went wrong while updating memory"})}});return{resynthesizeMemory:f,isResynthesizingMemory:g}},S=()=>{let e=(0,o.st)(),{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,s=I(),{addError:u}=(0,i.Yf)(),c=(0,p.A)(),m=(0,d.useQueryClient)(),{mutate:f,isPending:g}=(0,a.L2)("/api/organizations/".concat(n,"/memory/reset"),"POST",{enabled:!!t&&s,onSuccess:()=>{m.invalidateQueries({queryKey:[l.IX]}),e.track({event_key:"claudeai.memory.memory_reset"})},onError:()=>{u(c.formatMessage({defaultMessage:"Something went wrong while resetting memory",id:"1U/+Klpk5D"}),{messageForLogging:"Something went wrong while resetting memory"})}});return{resetMemory:f,isResettingMemory:g}},w=function(){let{projectUuid:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,o.st)(),{account:n,activeOrganization:s}=(0,r.YL)(),u=null==n?void 0:n.uuid,c=null==s?void 0:s.uuid,m=I(),{addError:f,addSuccess:g}=(0,i.Yf)(),v=(0,p.A)(),y=(0,d.useQueryClient)(),{mutate:h,isPending:_}=(0,a.Qv)("/api/organizations/".concat(c,"/memory/controls"),"PUT",(e,t)=>{var n;return{memory:null!=(n=null==t?void 0:t.memory)?n:"",controls:e.controls,updated_at:null==t?void 0:t.updated_at}},{queryKey:[l.IX,{accountUuid:u,orgUuid:c,projectUuid:e}],enabled:!!s&&m,onSuccess:()=>{g(v.formatMessage({defaultMessage:"Memory updated",id:"YqVBaoALVh"})),y.invalidateQueries({queryKey:[l.IX,{accountUuid:u,orgUuid:c,projectUuid:e}]}),t.track({event_key:"claudeai.memory.edit_memory",projectUuid:e})},onError:e=>{f(v.formatMessage({defaultMessage:"Something went wrong while updating memory",id:"P1AER5mU4P"}),{error:e,messageForLogging:"Something went wrong while updating memory"})}});return{updateMemoryControls:h,updateMemoryControlsIsPending:_}},k=()=>(0,u.fS)("claudeai_saffron_free_user_enabled"),C=()=>(0,u.fS)("claudeai_saffron_themes_enabled"),M=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=C(),s=t?"/api/organizations/".concat(t,"/memory/themes"):null;return(0,a.Sk)(s,{staleTime:3e5,enabled:!!t&&!!s&&n})},I=()=>{let e=(0,u.fS)("claudeai_saffron_enabled"),t=k();return e||t},P=()=>{let e=(0,u.fS)("claudeai_saffron_admin_toggle_enabled"),t=I();return e&&!t},T=()=>{let e=C(),t=A();return e&&!!t},E=()=>{var e;let t=(0,r.mV)(),{data:n}=(0,g.rX)(),s=!!n&&!(null==(e=n.disabled_features)?void 0:e.includes("saffron"));return!t||s},A=()=>{var e;let t=E(),{account:n}=(0,r.YL)(),s=(0,u.fS)("claudeai_saffron_default_enabled");return!!t&&(null!=(e=null==n?void 0:n.settings.enabled_saffron)?e:s||void 0)},j=()=>{let e=(0,o.st)(),{mutateAsync:t}=(0,s.yJ)(),{resetMemory:n}=S(),a=(0,d.useQueryClient)(),{account:i,activeOrganization:u}=(0,r.YL)();return(s,o)=>{t({enabled_saffron:s}).then(()=>{s&&a.invalidateQueries({queryKey:[l.IX,{accountUuid:null==i?void 0:i.uuid,orgUuid:null==u?void 0:u.uuid,projectUuid:void 0}]})}),(null==o?void 0:o.shouldResetMemory)&&n(),e.track({event_key:"claudeai.memory.account_setting_toggled",enabled:s,reset_memory:!!(null==o?void 0:o.shouldResetMemory)})}},L=()=>{let e=(0,u.fS)("claudeai_saffron_search_enabled"),t=k();return e||t},U=()=>{var e;let{account:t}=(0,r.YL)(),n=(0,u.fS)("claudeai_saffron_search_default_enabled");return null!=(e=null==t?void 0:t.settings.enabled_saffron_search)?e:n},F=()=>{let e=(0,o.st)(),{account:t}=(0,r.YL)(),n=U(),a=L(),{mutate:i}=(0,s.yJ)(),{mutate:l}=(0,f.nI)(),u=(0,c.useRef)(null==t?void 0:t.settings);return(0,c.useEffect)(()=>{u.current=null==t?void 0:t.settings},[null==t?void 0:t.settings]),{toggleSaffronSearch:(0,c.useCallback)(t=>{i({enabled_saffron_search:t}),a&&t&&l({}),e.track({event_key:"claudeai.conversation_search.account_setting_toggled",enabled:t})},[i,l,a,e]),saffronSearchEnabled:n}},R=()=>{let e=(0,u.fS)("claudeai_saffron_ghost_enabled"),t=k();return e||t},O=()=>(0,u.T9)("claudeai_saffron_frontend","resynthesize_enabled",!1,u.Km),Y=()=>(0,u.T9)("claudeai_saffron_frontend","max_num_controls",10,u.T2),D=()=>(0,u.T9)("claudeai_saffron_frontend","max_control_chars",100,u.T2),N=()=>{let e=(0,p.A)(),t=(0,u.fS)("claude_grove_enabled"),n=A();return t&&n?e.formatMessage({defaultMessage:"Incognito chats aren’t saved, added to memory, or used to train models.",id:"7vPniYndmQ"}):t?e.formatMessage({defaultMessage:"Incognito chats aren’t saved to history or used to train models.",id:"ePzoyDXPHe"}):n?e.formatMessage({defaultMessage:"Incognito chats aren’t saved or added to memory.",id:"SOrtx8O6Rq"}):e.formatMessage({defaultMessage:"Incognito chats aren’t saved to history.",id:"8EiWE4PL22"})}},0xc851826f:(e,t,n)=>{n.d(t,{E4:()=>a,Eq:()=>i,zK:()=>r});var s=n(0x394ef833),o=n(0x16784b660);function a(e,t,n,s){let o=[e];for(let e of[t,n,s]){if(!e)break;o.push(e)}return o.join(":")}let r=(0,s.v)()((0,o.Zr)(e=>({stats:{},setStats:(t,n)=>e(e=>{let s=e.stats[t];return s&&s.additions===n.additions&&s.deletions===n.deletions&&s.fileCount===n.fileCount&&s.hasChanges===n.hasChanges?e:{stats:{...e.stats,[t]:{...n,updatedAt:Date.now()}}}}),clearSession:t=>e(e=>{let n={};for(let[s,o]of Object.entries(e.stats))s.startsWith("".concat(t,":"))||s===t||(n[s]=o);return{stats:n}})}),{name:"session-diff-stats-store",storage:(0,o.KU)(()=>localStorage),onRehydrateStorage:()=>e=>{if(!e)return;let t=Date.now(),n=Object.entries(e.stats).filter(e=>{let[,n]=e;return t-n.updatedAt<864e5});n.length>100&&(n.sort((e,t)=>{let[,n]=e,[,s]=t;return s.updatedAt-n.updatedAt}),n.length=100),e.stats=Object.fromEntries(n)}}));function i(e,t,n,s){return r(o=>{if(!e)return;let r=a(e,t,n,s);return o.stats[r]})}},0xc9dabb82:(e,t,n)=>{n.d(t,{M$:()=>d,O5:()=>i,f$:()=>l,lo:()=>u,n7:()=>c});var s=n(0x12c9046cd),o=n(0x20b939f38),a=n(0x49fac030),r=n(0x17e725145);let i=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid;return(0,s.Sk)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[a.ssK,{orgUuid:t}],enabled:!!t})},l=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid,n=(0,r.useQueryClient)();return(0,s.L2)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[a.ssK,{orgUuid:t}]})}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,o.YL)(),i=null==n?void 0:n.uuid,l=(0,r.useQueryClient)();return(0,s.L2)("/api/organizations/".concat(i,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{l.invalidateQueries({queryKey:[a.ssK,{orgUuid:i}]})},enabled:!t})},d=e=>{let{activeOrganization:t}=(0,o.YL)(),n=null==t?void 0:t.uuid,i=(0,r.useQueryClient)();return(0,s.L2)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{i.invalidateQueries({queryKey:[a.ssK,{orgUuid:n}]})}})},c=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid;return(0,s.L2)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},0xd96dfc62:(e,t,n)=>{n.d(t,{S:()=>f,v:()=>m});var s=n(0x22102fd88),o=n(0x225bae024),a=n(0x22fc8d729),r=n(0x1ab362a20),i=n(0x141440998),l=n(0x4d348f95),u=n(0x1dc42fcee),d=n(0x38e6572),c=n(0xd5e0c33c),p=n(0x21fb79560);function m(e){let{isOpen:t,onClose:n,limitType:m="projects",customTitle:f,customDescription:g}=e,v=(0,l.useRouter)(),y=(0,c.p)()||1,h=["opus"===m?{defaultMessage:"More Opus usage*",id:"JxRTAGj5OB"}:"message_limit"===m?{defaultMessage:"Access to tools like research and web search",id:"message_limit_benefit_tools"}:{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"opus"===m&&{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"projects"===m&&{defaultMessage:"More usage*",id:"Rve6Z5dM8k"},"message_limit"===m&&{defaultMessage:"Claude Code directly in your terminal",id:"message_limit_benefit_code"},"message_limit"===m&&{defaultMessage:"Integration to Google Workspace: email, calendar, and docs",id:"message_limit_benefit_workspace"},"message_limit"===m&&{defaultMessage:"Full access to the newest Claude models including Opus",id:"message_limit_benefit_models"},"message_limit"===m&&{defaultMessage:"Extended thinking for complex work",id:"message_limit_benefit_thinking"},"message_limit"!==m&&{defaultMessage:"Ability to search the web",id:"dl29r7OlXE"},"message_limit"!==m&&{defaultMessage:"Extended thinking for complex work",id:"mENE7vJhVQ"},"message_limit"!==m&&{defaultMessage:"Connect Google Workspace: email, calendar, and docs",id:"WwXweMd3IE"},"message_limit"!==m&&{defaultMessage:"Ability to use more Claude models",id:"Qpr1Da1f7N"}].filter(Boolean);return(0,s.jsx)(u.bL,{open:t,onOpenChange:n,children:(0,s.jsx)(u.ZL,{children:(0,s.jsx)(u.hJ,{className:"fixed inset-0 bg-always-black/50 backdrop-brightness-75 z-modal flex items-center justify-center data-[state=open]:animate-[fade_250ms_ease-in_forwards] data-[state=closed]:animate-[fade_125ms_ease-out_reverse_forwards]",children:(0,s.jsxs)(u.UC,{className:"z-modal w-full max-w-sm bg-bg-000 rounded-2xl shadow-xl overflow-hidden focus:outline-none data-[state=open]:animate-[zoom_250ms_ease-in_forwards] data-[state=closed]:animate-[zoom_125ms_ease-out_reverse_forwards]",onEscapeKeyDown:e=>{e.preventDefault(),n()},onInteractOutside:e=>{e.preventDefault(),n()},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-5 pt-4",children:[(0,s.jsx)(p.M,{}),(0,s.jsx)(u.bm,{asChild:!0,children:(0,s.jsx)(o.$,{variant:"ghost",size:"icon_sm",className:"text-text-400 hover:text-text-200",children:(0,s.jsx)(r.X,{size:20,weight:"regular"})})})]}),(0,s.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,s.jsx)("h2",{className:"text-[24px] leading-tight font-medium mb-2 text-text-000",children:f||("opus"===m?(0,s.jsx)(d.A,{defaultMessage:"More Opus with Pro and Max plans",id:"//ixi/rP/O"}):"message_limit"===m?(0,s.jsx)(d.A,{defaultMessage:"Keep chatting with Claude",id:"u3sKHTmxou"}):(0,s.jsx)(d.A,{defaultMessage:"Unlimited projects with Pro and Max plans",id:"RKBJDiWP1p"}))}),(0,s.jsx)("p",{className:"".concat("message_limit"===m?"text-sm":"text-base"," text-text-300 mb-3"),children:g||("opus"===m?(0,s.jsx)(d.A,{defaultMessage:"Free plans only get 3 Opus messages per week. Try again after {date}, or upgrade now to get:",id:"IIJcLbtXZK",values:{date:new Date(Date.now()+6048e5).toLocaleDateString("en-US",{month:"long",day:"numeric"})}}):"message_limit"===m?(0,s.jsx)(d.A,{defaultMessage:"You just hit your free message limit. Upgrade to Pro (or Max) to send more messages. You also get:",id:"vXAAoQRvRg"}):(0,s.jsx)(d.A,{defaultMessage:"Free plans only get access to {count, plural, one {one project} other {# projects}}. Upgrade now to get:",id:"C83WGxw1GN",values:{count:y}}))}),(0,s.jsx)("div",{className:"space-y-1.5 mb-6",children:h.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,s.jsx)(i.J,{className:"text-text-400 mt-0.5 flex-shrink-0",size:18,weight:"regular"}),(0,s.jsx)("span",{className:"text-sm text-text-200",children:(0,s.jsx)(d.A,{...e})})]},"benefit-".concat(t)))}),("opus"===m||"projects"===m)&&(0,s.jsx)("p",{className:"text-xs text-text-400 mb-4",children:(0,s.jsx)(a.Y,{href:"https://support.anthropic.com/en/articles/11049762-choosing-a-claude-ai-plan",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(d.A,{defaultMessage:"*Usage limits apply",id:"HFRZOFWXCf"})})}),(0,s.jsx)(o.$,{variant:"primary",size:"lg",className:"w-full text-base font-medium",onClick:()=>{n(),v.push("/upgrade")},children:(0,s.jsx)(d.A,{defaultMessage:"See plans",id:"vbFKkTYpN+"})})]})]})})})})}let f=m},0xdd4f13c7:(e,t,n)=>{n.d(t,{F:()=>u});var s=n(0xfcc9d76b),o=n(0xac309a83),a=n(0x20892a038),r=n(0xfc89b4a4),i=n(0x226530adf),l=n(0x14a6d5f1);let u=e=>{var t,n,u;let d=(0,s.e)(),c=(0,o.fS)("sticky_model_selector"),p=(0,o.fS)("model_selector_enabled"),{activeModelOptions:m}=(0,l.A9)(),f=null!=(t=null==e?void 0:e.storageKey)?t:i.eQ,g=null!=(n=null==e?void 0:e.modelOptions)?n:m,v=(0,a.useQuery)({queryKey:[f,c],queryFn:()=>{if(!c||!p)return null;let e=localStorage.getItem(f);return e&&g.find(t=>t.model===e)?e:null},enabled:!d}),y=(0,r.useCallback)(e=>{e&&localStorage.setItem(f,e),v.refetch()},[v,f]);return{stickyModelPreference:null!=(u=v.data)?u:null,setStickyModelPreference:y,isSettled:!d&&v.isSuccess}}},0xe41b440d:(e,t,n)=>{n.d(t,{i:()=>r,r:()=>i});var s=n(0x9f369389),o=n(0x394ef833);n(0x1c8c32419);let a=e=>{var t;null===s.Fd||void 0===s.Fd||null==(t=s.Fd.setDraftSessionFolders)||t.call(s.Fd,e)},r=(0,o.v)((e,t)=>({selectedFolders:[],setSelectedFolders:t=>{a(t),e({selectedFolders:t})},toggleSelectedFolder:t=>e(e=>{let n=e.selectedFolders.includes(t)?e.selectedFolders.filter(e=>e!==t):[...e.selectedFolders,t];return a(n),{selectedFolders:n}}),clearSelectedFolders:()=>{e({selectedFolders:[]}),a([])},selectedFiles:[],setSelectedFiles:t=>{e({selectedFiles:t})},addSelectedFiles:t=>{e(e=>({selectedFiles:[...e.selectedFiles,...t]}))},clearSelectedFiles:()=>{e({selectedFiles:[]})},pendingUntrustedFolder:null,setPendingUntrustedFolder:t=>e({pendingUntrustedFolder:t}),clearPendingUntrustedFolder:()=>e({pendingUntrustedFolder:null}),selectFolderWithTrustCheck:async n=>{var o;await (null===s.Fd||void 0===s.Fd||null==(o=s.Fd.isFolderTrusted)?void 0:o.call(s.Fd,n))?t().setSelectedFolders([n]):e({pendingUntrustedFolder:n})},selectedProjectUuids:new Set,toggleProject:t=>e(e=>{let n=new Set(e.selectedProjectUuids);return n.has(t)?n.delete(t):n.add(t),{selectedProjectUuids:n}}),clearProjects:()=>e({selectedProjectUuids:new Set}),pendingProjectWarning:null,pendingProjectWarningResolver:null,showProjectWarning:(t,n)=>e({pendingProjectWarning:t,pendingProjectWarningResolver:null!=n?n:null}),resolveProjectWarning:n=>{var s,o;null==(s=(o=t()).pendingProjectWarningResolver)||s.call(o,n),e({pendingProjectWarning:null,pendingProjectWarningResolver:null})}}));function i(e){let t=[...e].sort((e,t)=>{var n,s;return(null!=(n=t.createdAt)?n:0)-(null!=(s=e.createdAt)?s:0)}),n=[],s=new Set;for(let e of t)if(!e.isArchived)for(let t of e.userSelectedFolders||[]){var o;if(!s.has(t)&&(s.add(t),n.push({path:t,displayName:null!=(o=t.split("/").pop())?o:t,type:"folder"}),n.length>=5))break}return n}},0xe885efe2:(e,t,n)=>{n.d(t,{OpusRateLimitModalProvider:()=>l,T:()=>i});var s=n(0x22102fd88),o=n(0xfc89b4a4),a=n(0xd96dfc62);let r=null;function i(){r&&r(!0)}function l(){let[e,t]=(0,o.useState)(!1);return(0,o.useEffect)(()=>(r=t,()=>{r=null}),[]),(0,s.jsx)(a.v,{isOpen:e,onClose:()=>t(!1),limitType:"opus"})}},0x10228ff11:(e,t,n)=>{n.d(t,{c:()=>x,k:()=>b});var s=n(0x226530adf),o=n(0x14a6d5f1),a=n(0xdd4f13c7),r=n(0x4d348f95),i=n(0xfc89b4a4),l=n(0xf32c56dd),u=n(0x20b939f38),d=n(0x22062498b),c=n(0xac309a83),p=n(0x156c4e43b);let m="baku-sticky-model-selector",f=["claude-sonnet-4-5-20250929","claude-haiku-4-5-20251001"];var g=n(0x22f589dfd),v=n(0x181235abd),y=n(0x127947fbb),h=n(0x10f02bd0d),_=n(0x22f6fe185);let x="cowork-sticky-model-selector";function b(){var e,t,n,b;let{conversationUuid:S=null,sessionId:w}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},k=(0,r.usePathname)(),C=(0,y.Ae)(),M=(0,y.pl)(),I=(0,y.i$)(),P="string"==typeof k&&k.startsWith("/code"),T="string"==typeof k&&(k.startsWith("/claude-ship")||!1),[E,A]=(0,v.S)(),[j,L]=(()=>{let{allModelOptions:e,mainModels:t,overflowModels:n}=(0,o.A9)(),{track:s}=(0,l.st)(),{account:a}=(0,u.YL)(),r=(0,c.T9)("baku_model","allowed_models",f,p.YO(p.Yj())),m=(0,c.T9)("baku_model","model","claude-sonnet-4-5-20250929",p.Yj()),g=e=>e.filter(e=>r.includes(e.model)),v=g(e),y=g(t),h=g(n),_=v.some(e=>e.model===m);if(!_&&(0,d.B)(a)){var x;let t=null!=(x=e.find(e=>e.model===m))?x:{model:m,name:"[ant-only] (".concat(m,")"),inactive:!1,overflow:!0};v=[t,...v],t.overflow?h=[t,...h]:y=[t,...y]}return(0,i.useEffect)(()=>{_||s({event_key:"claudeai.claude_ship.default_model_missing_from_config",default_model:m})},[_,m,s]),[m,{allModelOptions:v,mainModels:y,overflowModels:h}]})(),U=(0,o.A9)(),F=(0,s.Z3)(null),R=(0,s.Z3)(S),O=!!C||M||P||T,Y=T?L:O?A:U,D=T?j:O?E:F,N=T?w?"".concat(m,"-").concat(w):m:I?w?"".concat(x,"-").concat(w):x:O?w?"".concat(v.H,"-").concat(w):v.H:s.eQ,{stickyModelPreference:z,setStickyModelPreference:B,isSettled:K}=(0,a.F)({storageKey:N,modelOptions:Y.allModelOptions}),q=(0,_.sk)(e=>e.sessionContext),W=null!=(n=null==q||null==(t=q.sessionData)||null==(e=t.session_context)?void 0:e.model)?n:null,G=(0,i.useContext)(g.NS),Q=null!=(b=(0,h.xU)(e=>{var t,n,s;if(!G)return null;let o=(0,h.JF)(e,G);return null!=(s=null==(n=o.sessionData)||null==(t=n.session_context)?void 0:t.model)?s:o.sessionModel}))?b:null,H=null!==z&&Y.allModelOptions.some(e=>e.model===z),J=null!==W&&Y.allModelOptions.some(e=>e.model===W),X=null!==Q&&Y.allModelOptions.some(e=>e.model===Q),Z=S&&(null==C?void 0:C.type)!=="local_session",V=(null==C?void 0:C.type)==="local_session";return{model:Z?R:H?z:V&&J?W:X?Q:D,defaultModel:D,modelsConfig:Y,hideThinkingMenu:O,stickyModelPreference:z,setStickyModelPreference:B,isSettled:K}}},0x10f02bd0d:(e,t,n)=>{n.d(t,{JF:()=>c,Nz:()=>v,ct:()=>g,s1:()=>y,xU:()=>m});var s=n(0x9845e38c),o=n(0xfc89b4a4),a=n(0x394ef833),r=n(0x16784b660),i=n(0x22f589dfd),l=n(0xe6c3f31e);let u={sessionType:"local",messages:[],pendingMessages:[],lastMessageTime:null,streamedMessages:void 0,initialMessages:void 0,isLoadingInitialMessages:!1,connectionState:"disconnected",isLoading:!0,hasError:!1,initializationStatus:null,sessionTitle:"",sessionModel:void 0,processIsRunning:!1,permissionMode:"default",cwd:void 0,cliSessionId:void 0,homePath:void 0,folderExists:!0,sshConfig:void 0,gitInfo:null,sessionLoadingErrorDetails:void 0,nextReconnectTime:null,showRetryButton:!1,slashCommands:void 0,sharedSessionInfo:void 0,isProactiveActive:!1,sessionData:void 0,pendingPlanApproval:void 0,promptSuggestion:null,isSessionRunning:!1};function d(e,t,n,s){return e&&(0,l.ms)(t,n,s)}function c(e,t){var n;return null!=(n=e.sessions[t])?n:u}let p={hasError:!1,connectionState:"disconnected",isLoading:!0,sessionLoadingErrorDetails:void 0,showRetryButton:!1,nextReconnectTime:null,initializationStatus:null},m=(0,a.v)()((0,r.eh)((e,t)=>({sessions:{},activeSessionId:null,updateSessionFields:(n,s)=>{var o,a,r;let i=t(),l=i.sessions[n];if(!l)return;let u="messages"in s||"processIsRunning"in s?{...s,isSessionRunning:d(null!=(o=s.processIsRunning)?o:l.processIsRunning,null!=(a=s.messages)?a:l.messages,null!=(r=s.pendingMessages)?r:l.pendingMessages,l.sessionType)}:s;Object.keys(u).some(e=>!Object.is(l[e],u[e]))&&e({sessions:{...i.sessions,[n]:{...l,...u}}})},appendMessageToSession:(n,s)=>{let o=t(),a=o.sessions[n];if(!a)return;let r=[...a.messages,s],i=d(a.processIsRunning,r,a.pendingMessages,a.sessionType);e({sessions:{...o.sessions,[n]:{...a,messages:r,lastMessageTime:Date.now(),isSessionRunning:i}}})},setMessagesForSession:(n,s)=>{let o=t(),a=o.sessions[n];if(!a)return;let r=d(a.processIsRunning,s,a.pendingMessages,a.sessionType);e({sessions:{...o.sessions,[n]:{...a,messages:s,isSessionRunning:r}}})},removePendingMessageFromSession:(n,s)=>{let o=t(),a=o.sessions[n];if(!a)return;let r=a.pendingMessages.filter(e=>e.uuid!==s);r.length!==a.pendingMessages.length&&e({sessions:{...o.sessions,[n]:{...a,pendingMessages:r}}})},addPendingMessageToSession:(n,s)=>{let o=t(),a=o.sessions[n];a&&(s.uuid&&a.pendingMessages.some(e=>e.uuid===s.uuid)||e({sessions:{...o.sessions,[n]:{...a,pendingMessages:[...a.pendingMessages,s]}}}))},batchSyncFieldsForSession:(n,s)=>{let o=t(),a=o.sessions[n];if(!a)return;let r="messages"in s||"processIsRunning"in s,i={...s};if(r){var l,u,c;i.isSessionRunning=d(null!=(l=i.processIsRunning)?l:a.processIsRunning,null!=(u=i.messages)?u:a.messages,null!=(c=i.pendingMessages)?c:a.pendingMessages,a.sessionType)}Object.keys(i).some(e=>!Object.is(a[e],i[e]))&&e({sessions:{...o.sessions,[n]:{...a,...i}}})},initSession:(n,o)=>{let a=t();a.activeSessionId&&a.activeSessionId!==n&&s.v.warn(s.u.LOCAL_SESSION,"[SessionDataStore] initSession called while another session is active: current=".concat(a.activeSessionId,", new=").concat(n)),s.v.info(s.u.LOCAL_SESSION,"[SessionDataStore] initSession: ".concat(n," (").concat(o,")"));let r=a.sessions[n];e({sessions:{...a.sessions,[n]:r?{...r,...p}:{...u,sessionType:o}},activeSessionId:n})},clearSession:()=>{let n=t(),o=n.activeSessionId;if(s.v.info(s.u.LOCAL_SESSION,"[SessionDataStore] clearSession: ".concat(o)),o){let{[o]:t,...s}=n.sessions;e({sessions:s,activeSessionId:null})}else e({activeSessionId:null})},deactivateSession:n=>{let o=t();if(o.activeSessionId===n){s.v.info(s.u.LOCAL_SESSION,"[SessionDataStore] deactivateSession: ".concat(n));let t=Object.keys(o.sessions),u=o.sessions;if(t.length>10){var a,r,i,l;let e=t.filter(e=>e!==n),d=e[0],c=null!=(r=null==(a=o.sessions[d])?void 0:a.lastMessageTime)?r:-1/0;for(let t=1;t<e.length;t++){let n=e[t],s=null!=(l=null==(i=o.sessions[n])?void 0:i.lastMessageTime)?l:-1/0;s<c&&(c=s,d=n)}s.v.info(s.u.LOCAL_SESSION,"[SessionDataStore] evicting LRU session: ".concat(d));let{[d]:p,...m}=u;u=m}e({sessions:u,activeSessionId:null})}},evictSession:n=>{let o=t();s.v.info(s.u.LOCAL_SESSION,"[SessionDataStore] evictSession: ".concat(n));let{[n]:a,...r}=o.sessions;e({sessions:r,...o.activeSessionId===n?{activeSessionId:null}:{}})}}))),f=[];function g(e){let t=(0,o.useContext)(i.NS),n=null!=e?e:t;return m(e=>{var t;return n&&null!=(t=c(e,n).messages)?t:f})}function v(e){let t=(0,o.useContext)(i.NS),n=null!=e?e:t;return m(e=>!!n&&c(e,n).isSessionRunning)}function y(){let e=(0,o.useContext)(i.NS),t=m(t=>e?c(t,e).gitInfo:void 0),n=m(t=>e?c(t,e).sessionModel:void 0);return(0,o.useMemo)(()=>{if(t||n)return{sources:(null==t?void 0:t.defaultBranch)?[{type:"git_repository",url:"https://github.com/".concat(t.repo),revision:"refs/heads/".concat(t.defaultBranch)}]:[],...t&&{outcomes:[{type:"git_repository",git_info:{type:"github",repo:t.repo,branches:[t.branch]}}]},model:n}},[t,n])}},0x127947fbb:(e,t,n)=>{n.d(t,{Ae:()=>l,Pq:()=>m,i$:()=>u,pl:()=>c,wU:()=>p});var s=n(0x107838ca5),o=n(0x1449f94a5),a=n(0x1b09c791a),r=n(0xf853038d),i=n(0x9855f705);let l=()=>{let e=(0,i.aC)(e=>e.activeSessionId);return(0,r.No)((0,s.k)(t=>(function(e,t){if(e===o.Hg)return{type:"new"};let n=function(e){if("string"!=typeof e||!e.startsWith(o.fM))return null;let t=e.slice(o.fM.length+1).split("/")[0];return t||null}(e);return n?{type:"local_session",sessionId:null!=t?t:n}:null})(t.pathname,e)))},u=()=>{let e=(0,a.qU)().considerEnabledForNonUI;return(0,r.X9)(t=>!!t.startsWith(o.fM)||t===o.Hg&&!!e)};function d(e){if(!e.startsWith(o.UL))return null;let t=e.slice(o.UL.length+1).split("/")[0];return t||null}let c=()=>(0,r.X9)(e=>e.startsWith(o.UL)),p=()=>(0,r.xq)(d),m=()=>(0,r.X9)(e=>{if(!e.startsWith(o.UL))return!1;let t=d(e);return!!(null==t?void 0:t.startsWith("local_"))})},0x14c0dfde7:(e,t,n)=>{n.d(t,{u3:()=>v,oQ:()=>h,p9:()=>y});var s=n(0x20b939f38),o=n(0x18e5c6e75),a=n(0xac309a83),r=n(0x192ec08a2),i=n(0x253a5c787),l=n(0x1ea21c42d),u=n.n(l),d=n(0xfc89b4a4);function c(e){var t,n,s,o,a,r,i,l,u,d,c;return{name:e.name,description:null!=(s=e.description)?s:void 0,annotations:e.annotations?{title:null!=(o=e.annotations.title)?o:void 0,readOnlyHint:null!=(a=e.annotations.readOnlyHint)?a:void 0,destructiveHint:null!=(r=e.annotations.destructiveHint)?r:void 0,idempotentHint:null!=(i=e.annotations.idempotentHint)?i:void 0,openWorldHint:null!=(l=e.annotations.openWorldHint)?l:void 0}:void 0,inputSchema:{type:"object",...e.inputSchema,properties:null!=(u=null==(t=e.inputSchema)?void 0:t.properties)?u:void 0,required:null!=(d=null==(n=e.inputSchema)?void 0:n.required)?d:void 0},displayName:e.displayName,enabledKey:e.enabled_key,alwaysApprovedKey:e.always_approved_key,_meta:null!=(c=e._meta)?c:void 0}}function p(e){var t,n,s,o;return{name:e.name,description:null!=(n=e.description)?n:void 0,title:null!=(s=e.title)?s:void 0,arguments:null==(t=e.arguments)?void 0:t.map(e=>{var t,n;return{name:e.name,description:null!=(t=e.description)?t:void 0,required:null!=(n=e.required)?n:void 0}}),_meta:null!=(o=e._meta)?o:void 0,displayName:e.displayName}}function m(e){var t,n,s,o,a,r;let i=e.annotations?{...e.annotations,audience:null!=(t=e.annotations.audience)?t:void 0,priority:null!=(n=e.annotations.priority)?n:void 0}:void 0;return{uri:e.uri,name:e.name,description:null!=(s=e.description)?s:void 0,title:null!=(o=e.title)?o:void 0,mimeType:null!=(a=e.mimeType)?a:void 0,annotations:i,_meta:null!=(r=e._meta)?r:void 0,displayName:e.displayName}}var f=n(0xe824fb1c),g=n(0x6f6d4bd7);function v(e,t,n){(0,f.GF)(!1);let s=[],a=()=>{if(0!==s.length){for(let e of s){if(n&&e.uuid!==n)continue;let s=f.eZ.getState();if("server_base"===e.type){let t={uuid:e.uuid,name:e.name,url:e.url,custom_oauth_client_id:e.custom_oauth_client_id,custom_oauth_client_secret:void 0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_authenticated:e.usedAuthentication};e.connected&&(0,f.nd)(e.uuid)&&(0,f.s$)(e.uuid)&&(0,f.rD)(t),e.connected?(0,f.n3)(e.uuid,e.usedAuthentication):f.eZ.getState().disconnectRemoteServer(e.uuid)}else if("tools"===e.type){let n=e.tools||[],a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(c)}(t?(0,o.M)(n):n),{modelVisible:i,appOnly:l}=(0,g.Li)(a);s.setRemoteTools(e.uuid,i,l),a.some(e=>{try{return!!(0,r.Bv)({_meta:e._meta})}catch(e){return!1}})&&(0,f.QO)(e.uuid,!0)}else if("resources"===e.type){let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(m)}(e.resources);s.setRemoteResources(e.uuid,t)}else if("prompts"===e.type){let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(p)}(e.prompts);s.setRemotePrompts(e.uuid,t)}}s.length=0}},l=u()(a,300,{leading:!0,trailing:!0}),d=new EventSource("/api/organizations/".concat(e,"/mcp/v2/bootstrap"),{withCredentials:!0});return d.onerror=()=>{l.cancel(),a(),d.close(),f.eZ.getState().setRemoteIsLoading(!1),(0,f.IT)(!0),(0,f.GF)(!0),(0,i.Cp)(Error("MCP bootstrap stream error"),{tags:{action:"mcp_bootstrap_stream_error"},extra:{orgUuid:e}})},d.addEventListener("server_list",t=>{try{let{servers:e}=JSON.parse(t.data);for(let t of(f.eZ.getState().setRemoteIsLoading(!1),(0,f.IT)(!0),e))if((!n||t.uuid===n)&&(0,f.nd)(t.uuid)){let e={uuid:t.uuid,name:t.name,url:t.url,custom_oauth_client_id:null,custom_oauth_client_secret:void 0,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_authenticated:!1};(0,f.rD)(e)}}catch(n){(0,i.Cp)(n,{tags:{action:"mcp_bootstrap_stream_server_list_parse"},extra:{orgUuid:e,eventData:t.data}})}}),d.addEventListener("server_base",t=>{try{let e=JSON.parse(t.data);s.push({type:"server_base",...e}),l()}catch(n){(0,i.Cp)(n,{tags:{action:"mcp_bootstrap_stream_server_base_parse"},extra:{orgUuid:e,eventData:t.data}})}}),d.addEventListener("tools",t=>{try{let{server_uuid:e,tools:n}=JSON.parse(t.data);s.push({type:"tools",uuid:e,tools:n}),l()}catch(n){(0,i.Cp)(n,{tags:{action:"mcp_bootstrap_stream_tools_parse"},extra:{orgUuid:e,eventData:t.data}})}}),d.addEventListener("resources",t=>{try{let{server_uuid:e,resources:n}=JSON.parse(t.data);s.push({type:"resources",uuid:e,resources:n}),l()}catch(n){(0,i.Cp)(n,{tags:{action:"mcp_bootstrap_stream_resources_parse"},extra:{orgUuid:e,eventData:t.data}})}}),d.addEventListener("prompts",t=>{try{let{server_uuid:e,prompts:n}=JSON.parse(t.data);s.push({type:"prompts",uuid:e,prompts:n}),l()}catch(n){(0,i.Cp)(n,{tags:{action:"mcp_bootstrap_stream_prompts_parse"},extra:{orgUuid:e,eventData:t.data}})}}),d.addEventListener("completed",()=>{l.cancel(),a(),d.close(),f.eZ.getState().setRemoteIsLoading(!1),(0,f.IT)(!0),(0,f.GF)(!0)}),()=>{l.cancel(),d.close()}}let y=()=>(0,a.fS)("mcp_tb_sessions");function h(){let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid,n=(0,a.fS)("claude_ai_unicode_sanitize_mcp_data"),o=y();(0,d.useEffect)(()=>{if(t&&o)return v(t,n)},[o,t,n])}},0x15d264a53:(e,t,n)=>{n.d(t,{PU:()=>d,QO:()=>v,Sw:()=>h,jG:()=>y,yC:()=>g});var s=n(0x9f369389),o=n(0x16ab3413b),a=n.n(o),r=n(0xfc89b4a4),i=n(0x394ef833),l=n(0xc851826f),u=n(0x332e2b3b);let d=(0,i.v)()(()=>({sessions:[],isInitialized:!1})),c=new Set;async function p(e){if(null===s.Fd||void 0===s.Fd?void 0:s.Fd.getSession)try{let t=await s.Fd.getSession(e,{skipReplay:!0});t&&(c.has(t.sessionId)||d.setState(e=>{let n=e.sessions.findIndex(e=>e.sessionId===t.sessionId);if(n>=0){if(a()(e.sessions[n],t))return e;let s=[...e.sessions];return s[n]=t,{sessions:s}}return{sessions:[...e.sessions,t]}}))}catch(e){}}async function m(){if(!(null===s.Fd||void 0===s.Fd?void 0:s.Fd.getAll))return void d.setState({isInitialized:!0});try{let e=await s.Fd.getAll();d.setState({sessions:e,isInitialized:!0})}catch(e){d.setState({isInitialized:!0})}}let f=!1;function g(){!f&&(f=!0,m(),(null===s.Fd||void 0===s.Fd?void 0:s.Fd.onOnEvent)&&s.Fd.onOnEvent(e=>{let{type:t,sessionId:n}=e;switch(t){case"session_updated":case"close":case"error":case"tool_permission_request":case"tool_permission_resolved":case"start":n&&p(n);break;case"archived":n&&(c.add(n),d.setState(e=>{let t=e.sessions.findIndex(e=>e.sessionId===n);if(t<0)return e;let s=[...e.sessions];return s[t]={...s[t],isArchived:!0},{sessions:s}}),l.zK.getState().clearSession(n),u.P.getState().removePrsForSession(n));break;case"initialized":m()}}))}function v(){let e=d(e=>e.sessions),t=d(e=>e.isInitialized);return(0,r.useMemo)(()=>t?e.filter(e=>!e.isArchived).sort((e,t)=>{var n,s,o,a;let r=null!=(s=null!=(n=e.lastActivityAt)?n:e.createdAt)?s:0;return(null!=(a=null!=(o=t.lastActivityAt)?o:t.createdAt)?a:0)-r}):[],[e,t])}function y(){let e=d(e=>e.sessions);return(0,r.useMemo)(()=>e.filter(e=>"agent"!==e.sessionType),[e])}function h(){return d(e=>e.isInitialized)}},0x16b1d0c0f:(e,t,n)=>{n.d(t,{f:()=>s});let s=(0,n(0x394ef833).v)(e=>({isLoadingMentionData:!1,loadingCount:0,incrementLoading:()=>e(e=>({loadingCount:e.loadingCount+1,isLoadingMentionData:!0})),decrementLoading:()=>e(e=>{let t=Math.max(0,e.loadingCount-1);return{loadingCount:t,isLoadingMentionData:t>0}})}))},0x17509cc64:(e,t,n)=>{n.d(t,{Gt:()=>p,Ho:()=>c,So:()=>d,TC:()=>m});var s=n(0xac309a83),o=n(0x192ec08a2),a=n(0xfc89b4a4),r=n(0x107838ca5),i=n(0xe824fb1c),l=n(0x25062734b);let u="claudeai_mcp_a6k_enabled";function d(){return(0,s._f)(u)}function c(){return(0,s.fS)(u)}function p(e){var t;let n;if(!(0,l.tg)(e))return;let s=(0,i.pK)(e);try{n=(null==s?void 0:s.tool)?(0,o.Bv)({_meta:s.tool._meta}):void 0}catch(e){return}if("string"==typeof n&&(null==s||null==(t=s.server)?void 0:t.uuid))return{toolName:e,serverUuid:s.server.uuid}}function m(e){let{remoteTools:t,localTools:n}=(0,i.eZ)((0,r.k)(e=>({remoteTools:e.remoteTools,localTools:e.localTools})));return(0,a.useMemo)(()=>{let t=new Set;for(let n of e)p(n)&&t.add(n);return t},[e,t,n])}},0x181235abd:(e,t,n)=>{n.d(t,{H:()=>d,S:()=>p});var s=n(0x14a6d5f1),o=n(0xf32c56dd),a=n(0x20b939f38),r=n(0x22062498b),i=n(0xac309a83),l=n(0xfc89b4a4),u=n(0x156c4e43b);let d="ccr-sticky-model-selector",c=["claude-sonnet-4-5-20250929","claude-haiku-4-5-20251001"],p=()=>{let{allModelOptions:e,mainModels:t,overflowModels:n}=(0,s.A9)(),{track:d}=(0,o.st)(),{account:p}=(0,a.YL)(),m=(0,i.T9)("ccr_model","allowed_models",c,u.YO(u.Yj())),f=(0,i.T9)("ccr_model","model","claude-sonnet-4-5-20250929",u.Yj()),g=e=>e.filter(e=>m.includes(e.model)),v=g(e),y=g(t),h=g(n),_=v.some(e=>e.model===f);if(!_&&(0,r.B)(p)){var x;let t=null!=(x=e.find(e=>e.model===f))?x:{model:f,name:"[ant-only] (".concat(f,")"),inactive:!1,overflow:!0};v=[t,...v],t.overflow?h=[t,...h]:y=[t,...y]}return(0,l.useEffect)(()=>{_||d({event_key:"claudeai.code.composer.default_model_missing_from_config",default_model:f})},[_,f,d]),[f,{allModelOptions:v,mainModels:y,overflowModels:h}]}},0x187ab14f6:(e,t,n)=>{n.d(t,{Ac:()=>a,D8:()=>i,bI:()=>r});let s="recentDriveDocs";function o(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function a(e){localStorage.setItem(s,JSON.stringify(e))}function r(){if("undefined"==typeof localStorage)return[];let e=localStorage.getItem(s);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t)&&t.every(o))return t}return[]}function i(e){let t=r();a(t=t.filter(t=>t.uri!==e))}},0x18d05d4ac:(e,t,n)=>{n.d(t,{c:()=>o});var s=n(0xe824fb1c);function o(e,t){if(!(t.isRavenOrg&&!t.canManageIntegrations))return{approvedServers:e,unapprovedServers:[]};let n=[],o=[];for(let t of e)"remote"===t.type?(0,s.OT)(t.uuid)?n.push(t):o.push(t):n.push(t);return{approvedServers:n,unapprovedServers:o}}},0x1c8c32419:(e,t,n)=>{n.d(t,{HD:()=>o,R8:()=>r});var s=n(0x394ef833);let o="cowork-default-folder";function a(e){try{e?localStorage.setItem(o,e):localStorage.removeItem(o)}catch(e){}}let r=(0,s.v)((e,t)=>({defaultFolder:function(){try{return localStorage.getItem(o)}catch(e){return null}}(),setDefaultFolder:t=>{a(t),e({defaultFolder:t})},clearDefaultFolder:()=>{a(null),e({defaultFolder:null})},toggleDefaultFolder:n=>{t().defaultFolder===n?(a(null),e({defaultFolder:null})):(a(n),e({defaultFolder:n}))}}))},0x1d302b010:(e,t,n)=>{n.d(t,{vW:()=>D,R4:()=>Y,he:()=>R,qb:()=>j,ll:()=>L,XT:()=>A,eB:()=>E,W3:()=>U,NW:()=>I,lu:()=>M,s:()=>F,p4:()=>O});var s=n(0xf32c56dd),o=n(0x12c9046cd),a=n(0x20b939f38),r=n(0x10728a05e),i=n(0x49fac030),l=n(0xac309a83),u=n(0x1b813d90),d=n(0x17e725145),c=n(0xfc89b4a4),p=n(0x156c4e43b),m=n(0x14c0dfde7),f=n(0x1f08d8b5d),g=n(0x1c12b3087),v=n(0x8cde4874),y=n(0x524626b5),h=n(0xe824fb1c),_=n(0x6f6d4bd7);function x(e){let t=window.atob(e),n=new ArrayBuffer(t.length),s=new Uint8Array(n);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return n}var b=n(0x1e48e639d),S=n(0x242b93f35);let w=S.Ay.object({uuid:S.Ay.string().uuid(),name:S.Ay.string(),url:S.Ay.string(),created_at:S.Ay.string().datetime(),updated_at:S.Ay.string().datetime(),custom_oauth_client_id:S.Ay.string().nullable().optional(),custom_oauth_client_secret:S.Ay.string().nullable().optional(),is_authenticated:S.Ay.boolean().default(!1)});var k=n(0x1e841cc7d),C=n(0x18175ce17);let M=()=>(0,l.fS)("papi_mcp"),I=()=>(0,l.fS)("claude_ai_mcp_directory_web_only"),P=p.k5(["safe_for_phi"]),T=p.Ik({type:P,content_hash:p.Yj()});function E(e,t){let n=M(),s=(0,m.p9)();return(0,o.Sk)("/api/organizations/".concat(e,"/mcp/remote_servers"),{queryKey:[i.lAt,e],enabled:!s&&n&&!!e,...t,select:e=>p.YO(w).parse(e)})}function A(e,t,n){return(0,o.Sk)("/api/organizations/".concat(e,"/mcp/remote_servers/").concat(t),{queryKey:[i.Sm9,e,t],enabled:!!e&&!!t,...n,select:e=>w.parse(e)})}function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,{track:a}=(0,s.st)(),r=(0,d.useQueryClient)(),u=(0,m.p9)(),c=(0,l.fS)("claude_ai_unicode_sanitize_mcp_data"),{servers:p}=(0,v.pL)();return(0,o.L2)("/api/organizations/".concat(e,"/mcp/remote_servers"),"POST",{...t,onSuccess:(s,o,l)=>{var d;u&&((0,h.rD)(s),"directory"===n.source&&(0,h.I3)(s.uuid,s.url,p),(0,m.u3)(e,c,s.uuid)),r.invalidateQueries({queryKey:[i.lAt,e]}),null==(d=t.onSuccess)||d.call(t,s,o,l),a({event_key:"claudeai.mcp.create_server",source:n.source,url:s.url,type:"remote"})}})}function L(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=(0,d.useQueryClient)(),a=(0,m.p9)();return(0,o.L2)("/api/organizations/".concat(e,"/mcp/remote_servers/").concat(t),"DELETE",{...n,onSuccess:(o,r,l)=>{var u;(0,h.eg)(t),a||(s.setQueryData([i.lAt,e],e=>{var n;return null!=(n=null==e?void 0:e.filter(e=>e.uuid!==t))?n:[]}),s.invalidateQueries({queryKey:[i.lAt,e]})),null==(u=n.onSuccess)||u.call(n,o,r,l)}})}function U(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=(0,d.useQueryClient)(),a=(0,m.p9)();return(0,o.L2)("/api/organizations/".concat(e,"/mcp/logout/").concat(t),"POST",{...n,onSettled:()=>{(0,h.Ug)(t)},onSuccess:(t,o,r)=>{var l;a||s.invalidateQueries({queryKey:[i.lAt,e]}),null==(l=n.onSuccess)||l.call(n,t,o,r)}})}function F(){return(0,l.fS)("mcp_shttp")}function R(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,o.L2)("/api/organizations/".concat(e,"/mcp/remote_servers/").concat(t,"/clear_cache"),"POST",n)}function O(e){let t=(0,m.p9)(),{activeOrganization:n}=(0,a.YL)(),s=null==n?void 0:n.uuid;return(0,o.L2)("/api/organizations/".concat(s,"/chat_conversations/").concat(e,"/tool_approval"),"POST",{enabled:!!e&&!!s&&t})}function Y(){let{mutateAsync:e}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,m.p9)(),{activeOrganization:n}=(0,a.YL)(),s=null==n?void 0:n.uuid;return(0,o.L2)("/api/organizations/".concat(s,"/mcp/attach_resource"),"POST",{enabled:t&&!!s,...e})}(),t=N(),n=function(){let{setIsUploadingDriveSync:e}=(0,f.o)(),{setSyncSourceUuids:t}=(0,g.Tc)(e=>({setSyncSourceUuids:e.setSyncSourceUuids})),n=(0,C.kO)(),s=(0,C.qi)(u.v8.GDRIVE),{addError:o}=(0,r.Yf)(),{mutate:a}=(0,k.EF)({onMutate:()=>{e(!0)},onSuccess:n=>{t(e=>[...e,n.uuid]),e(!1)},onError:t=>{e(!1),o((0,b.J)(t),{error:t})},meta:{noToast:!0}});return(0,c.useCallback)(e=>{n&&s&&a({sync_source_type:u.v8.MCP_RESOURCES,sync_source_config:{server_uuid:s.uuid,resource:{...e}}})},[a,n,s])}(),{addError:i}=(0,r.Yf)(),l=(0,m.p9)(),d=function(){let{addError:e}=(0,r.Yf)(),{track:t}=(0,s.st)(),{handleUpload:n}=(0,f.o)();return(0,c.useCallback)(async(s,o)=>{try{let e=(await (0,h.KU)(s).readResource({uri:o.uri},{timeout:15e3})).contents.map(e=>{let n;return"text"in e?(n=String(e.text),t({event_key:"mcp.resources.read",type:"text",mime_type:e.mimeType})):(n=x(e.blob),t({event_key:"mcp.resources.read",type:"binary",mime_type:e.mimeType})),new File([n],(0,_.K2)(o),{type:e.mimeType})});e.length>0&&await n(e)}catch(t){e("Failed to upload resource. You can try again.",{error:t})}},[t,e,n])}(),{setIsUploadingDriveSync:p}=(0,f.o)();return(0,c.useCallback)(async s=>{let{serverUuid:o,resource:a,onClose:r}=s;if(!l)return d(o,a);{let s;try{let e=(0,h.KU)(o);s=await e.readResource({uri:a.uri},{timeout:15e3})}catch(e){}try{var u;p(!0);let i=await e({resource:a,server_uuid:o,result:s});(null==(u=a.mimeType)?void 0:u.startsWith("application/vnd.google-apps"))?n(a):t(i),p(!1),null==r||r()}catch(e){p(!1),i("Failed to attach resource. You can try again.",{error:e,errorContext:{tags:{action:"attach_resource"},extra:{serverUuid:o}}})}}},[l,d,p,e,n,t,i])}function D(e){let{mutateAsync:t}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,m.p9)(),{activeOrganization:n}=(0,a.YL)(),s=null==n?void 0:n.uuid;return(0,o.L2)("/api/organizations/".concat(s,"/mcp/attach_prompt"),"POST",{enabled:t&&!!s,...e})}(),n=N(),{addError:i}=(0,r.Yf)(),l=(0,m.p9)(),u=function(e){let{track:t}=(0,s.st)(),{addError:n}=(0,r.Yf)(),{handleUpload:o}=(0,f.o)();return(0,c.useCallback)(async(s,a,r)=>{try{let n=await (0,h.KU)(s).getPrompt({name:a.name,arguments:r},{timeout:15e3});t({event_key:"mcp.prompts.used",argument_count:Object.keys(r).length,assistant_messages:n.messages.filter(e=>"assistant"===e.role).length,user_messages:n.messages.filter(e=>"user"===e.role).length,text_messages:n.messages.filter(e=>"text"===e.content.type).length,image_messages:n.messages.filter(e=>"image"===e.content.type).length});let i=(e,t)=>{let n=e=>{let t=y._F[e];if(!t)throw Error("Unsupported MIME type: ".concat(e));return t},s=e=>"".concat(a.name).concat(t?"_".concat(t):"",".").concat(e);switch(e.content.type){case"text":return new File([e.content.text],s("txt"),{type:"text/plain"});case"image":{let t=n(e.content.mimeType);return new File([x(e.content.data)],s(t),{type:e.content.mimeType})}case"resource":if("text"in e.content.resource){var o;let t=e.content.resource;return new File([t.text],"".concat(t.uri,".txt"),{type:null!=(o=t.mimeType)?o:"text/plain"})}if("blob"in e.content.resource){let t=e.content.resource;if(!t.mimeType)throw Error("Missing MIME type for embedded resource");let s=n(t.mimeType);return new File([x(t.blob)],"".concat(t.uri,".").concat(s),{type:t.mimeType})}throw Error("Invalid resource content");case"audio":throw Error("Audio content not supported");case"resource_link":throw Error("Resource links are not supported")}};if(1===n.messages.length)await o([i(n.messages[0],0)]);else if(n.messages.length>1){let e=n.messages.flatMap((e,t)=>"image"===e.content.type||"resource"===e.content.type&&"blob"in e.content.resource?[i(e,t)]:[]),t=n.messages.filter(e=>"text"===e.content.type||"resource"===e.content.type&&"text"in e.content.resource);if(t.length>0){let n=JSON.stringify(t,null,2);e.push(new File([n],"".concat(a.name,"_messages.json"),{type:"application/json"}))}await o(e)}null==e||e()}catch(e){n("Failed to get prompt. You can try again.",{error:e})}},[t,n,o,e])}(e);return(0,c.useCallback)(async s=>{let{serverUuid:o,prompt:a,args:r}=s;if(!l)return u(o,a,r);{let s;try{let e=(0,h.KU)(o);s=await e.getPrompt({name:a.name,arguments:r},{timeout:15e3})}catch(e){}try{let i=await t({prompt:a,arguments:r,server_uuid:o,result:s});n(i),null==e||e()}catch(e){i("Failed to attach prompt. You can try again.",{error:e,errorContext:{tags:{action:"attach_prompt"},extra:{serverUuid:o}}})}}},[t,n,i,e,l,u])}function N(){let{setAttachments:e,setFiles:t}=(0,g.Tc)(e=>({setAttachments:e.setAttachments,setFiles:e.setFiles}));return(0,c.useCallback)(n=>{let{files:s,attachments:o}=n;s&&s.length>0&&t(e=>{let t=new Set(e.map(e=>e.file_uuid));return[...e,...s.filter(e=>!t.has(e.file_uuid))]}),o&&o.length>0&&e(e=>Array.from(new Set([...e,...o].map(e=>JSON.stringify(e)))).map(e=>JSON.parse(e)))},[e,t])}p.Ik({name:p.Yj(),url:p.Yj(),custom_oauth_client_id:p.Yj().nullable().optional(),custom_oauth_client_secret:p.Yj().nullable().optional(),attestations:p.YO(T)}),p.Ik({name:p.Yj().optional().nullable(),url:p.Yj().optional().nullable()})},0x1e436b9b0:(e,t,n)=>{n.d(t,{FV:()=>o,JU:()=>d,Wm:()=>c,Wv:()=>s,_C:()=>r,eH:()=>u,k5:()=>i,ye:()=>l,zE:()=>a});let s=(0,n(0x394ef833).v)(e=>({status:"idle",transcript:"",interimTranscript:"",audioLevel:0,error:null,micStream:null,isHovered:!1,isPushToTalk:!1,holdToRecordEnabled:!0,setStatus:t=>e({status:t}),appendTranscript:t=>e(e=>{if(!e.transcript)return{transcript:t,interimTranscript:""};let n=!e.transcript.endsWith(" ")&&!t.startsWith(" ");return{transcript:e.transcript+(n?" ":"")+t,interimTranscript:""}}),setTranscript:t=>e({transcript:t,interimTranscript:""}),setInterimTranscript:t=>e({interimTranscript:t}),clearInterim:()=>e({interimTranscript:""}),setAudioLevel:t=>e({audioLevel:t}),setError:t=>e({error:t,status:t?"error":"idle"}),setMicStream:t=>e({micStream:t}),setIsHovered:t=>e({isHovered:t}),setIsPushToTalk:t=>e({isPushToTalk:t}),setHoldToRecordEnabled:t=>e({holdToRecordEnabled:t}),reset:()=>e({status:"idle",transcript:"",interimTranscript:"",audioLevel:0,error:null,micStream:null,isPushToTalk:!1})}));function o(){return s(e=>e.status)}function a(){return s(e=>{let{transcript:t,interimTranscript:n}=e;if(!n)return t;if(!t)return n;let s=!t.endsWith(" ")&&!n.startsWith(" ");return t+(s?" ":"")+n})}function r(){return s(e=>e.micStream)}function i(){return s(e=>e.isHovered)}function l(){return s(e=>"recording"===e.status||"connecting"===e.status)}function u(){return s(e=>e.isPushToTalk)}function d(){return s(e=>e.holdToRecordEnabled)}function c(){return s(e=>"recording"===e.status)}},0x1e48e639d:(e,t,n)=>{n.d(t,{J:()=>o});var s=n(0x1016c6ed2);function o(e){let t="Unable to add Google Doc.";return e instanceof s.LG&&"access_denied"===e.errorCode?t+=" Please check that link is a valid Google Doc that you have access to.":t+=" "+e.message,t}},0x1e841cc7d:(e,t,n)=>{n.d(t,{EF:()=>m,NY:()=>c,Ql:()=>g,VA:()=>f,qJ:()=>p});var s=n(0x12c9046cd),o=n(0x20b939f38);n(0x20e00cddd);var a=n(0x49fac030),r=n(0x1b813d90),i=n(0x17e725145),l=n(0xfc89b4a4),u=n(0x18175ce17),d=n(0x187ab14f6);let c=e=>{let{activeOrganization:t}=(0,o.YL)(),n=null==t?void 0:t.uuid,r=!!(t&&e.length>0),i=(0,l.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),d=(0,l.useMemo)(()=>({queryKey:e.map(e=>[a.GCU,{orgUuid:n,syncSourceUuid:e}]),enabled:r,refetchInterval:e=>!!(e.state.data&&(0,u.z3)(e.state.data))&&5e3,meta:{noToast:!0}}),[r,n,e]);return(0,s._i)(i,d)},p=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,u.z3)(e.data)),m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,o.YL)(),l=null==t?void 0:t.uuid,c=null==n?void 0:n.uuid,p=(0,i.useQueryClient)(),m=(0,u.eL)();return(0,s.L2)(()=>"/api/organizations/".concat(c,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,s,o,i,u=arguments.length,d=Array(u),m=0;m<u;m++)d[m]=arguments[m];let[f]=d;p.setQueryData([a.GCU,{orgUuid:c,syncSourceUuid:f.uuid}],f),f.type===r.v8.GDRIVE&&f.config.uri&&(null==(t=f.status)?void 0:t.extra)&&(null==(n=f.status)?void 0:n.current_size_bytes)&&p.setQueryData([a.QBp,{accountUuid:l,orgUuid:c,documentId:f.config.uri}],{uri:"drive:///".concat(f.config.uri),title:null==(o=f.status)?void 0:o.extra,size:null==(i=f.status)?void 0:i.current_size_bytes}),null==(s=e.onSuccess)||s.call(e,...d)},onError:function(){for(var t,n=arguments.length,s=Array(n),o=0;o<n;o++)s[o]=arguments[o];null==(t=e.onError)||t.call(e,...s);let[a,i]=s;m(a,i),i.sync_source_type===r.v8.GDRIVE&&(0,d.D8)(i.sync_source_config.uri)}})},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,o.YL)(),n=null==t?void 0:t.uuid,r=(0,i.useQueryClient)();return(0,s.L2)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,s=arguments.length,o=Array(s),i=0;i<s;i++)o[i]=arguments[i];let[l]=o;r.setQueryData([a.GCU,{orgUuid:n,syncSourceUuid:l.uuid}],l),null==(t=e.onSuccess)||t.call(e,...o)}})},g=()=>{let{activeOrganization:e}=(0,o.YL)(),t=null==e?void 0:e.uuid;return(0,s.L2)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},0x1f08d8b5d:(e,t,n)=>{n.d(t,{_:()=>V,o:()=>Z});var s=n(0x22102fd88),o=n(0x101fa1001),a=n(0xab432de1),r=n(0x524626b5),i=n(0x16b1d0c0f),l=n(0x26b0b403),u=n(0x226530adf),d=n(0xf32c56dd),c=n(0x12c9046cd),p=n(0x10728a05e),m=n(0x1c0d05ee6),f=n(0x1016c6ed2),g=n(0x9f369389),v=n(0xac309a83),y=n(0x23506e4da),h=n(0x4d348f95),_=n(0xfc89b4a4),x=n(0x1ab0d1ca1),b=n(0x394ef833),S=n(0x107838ca5),w=n(0x1e841cc7d),k=n(0x87b1176c),C=n(0xb6b8b1fb),M=n(0x1bd42f6d2),I=n(0xbebfc702),P=n(0x20b939f38),T=n(0x17509cc64),E=n(0x31c535e9),A=n(0x1fb2770f2),j=n(0xe885efe2),L=n(0x377fd82d),U=n(0x1e436b9b0),F=n(0x1449f94a5),R=n(0x127947fbb),O=n(0xe41b440d),Y=n(0x10228ff11),D=n(0x2466a442d),N=n(0x87544a63),z=n(0x1b09c791a),B=n(0x13279c600),K=n(0x16d4e9516),q=n(0xb2217001),W=n(0x1f22b8dda),G=n(0xe824fb1c),Q=n(0x18bfd014),H=n(0x1c12b3087);let J=(0,y.default)(()=>Promise.all([n.e(73584),n.e(95196)]).then(n.bind(n,0x1d1e1f5a4)).then(e=>e.EncodingPickerModal),{loadableGenerated:{webpack:()=>[0x1d1e1f5a4]},ssr:!1});(0,m.O)();let X=_.createContext({transitionFiles:[],isAtMaxNumUploads:!1,model:"",isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,improvePrompt:()=>void 0,isImprovingPrompt:!1,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),wiggleEnabled:!1,uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0,dynamicAction:()=>void 0,imageBlocks:[],removeImageBlock:()=>void 0,replaceImageBlock:()=>void 0,replaceFile:()=>Promise.resolve(),setEncodingModalAttachmentId:()=>void 0,isAgentMode:!1,isAgentNewRoute:!1,isLocalAgentRoute:!1,localSessionId:null}),Z=()=>_.useContext(X),V=e=>{var t,n,m,y,Z,V,$,ee,et;let{onSend:en,willRedirectOnSubmit:es,onCreate:eo,onSessionCreate:ea,onStopSampling:er,children:ei}=e,el="conversation"in e,eu=el?e.conversation:void 0,ed="projectUuid"in e?e.projectUuid:void 0,ec="session"in e?e.session:void 0,ep=(0,R.Ae)(),em=null!=(m=null==eu?void 0:eu.id)?m:void 0===ed?(null==ep?void 0:ep.type)==="new"?"cowork-new-task":"new-conversation":"".concat(ed,":conversation"),ef=(0,v.fS)("v2_prompt_storage"),{store:eg,unsubscribe:ev,clearStorage:ey,cleanup:eh}=(0,_.useMemo)(()=>(0,K.E)({enableV2:ef,conversationId:em}),[em,ef]);(0,_.useEffect)(()=>()=>{null==ev||ev(),null==eh||eh()},[ev,eh]);let{incognitoModeEnabled:e_}=(0,Q.S)(),{setFailedStreamRetryData:ex}=(0,u.x)(),eb=(0,_.useRef)(null),{track:eS}=(0,d.st)(),{addError:ew}=(0,p.Yf)(),ek=(0,x.A)(),eC=(0,h.useRouter)(),eM=(0,h.usePathname)(),eI=(0,z.qU)(),eP=!!ep,eT=(null==ep?void 0:ep.type)==="new",eE=(null==ep?void 0:ep.type)==="local_session",eA=(null==ep?void 0:ep.type)==="local_session"?ep.sessionId:null,ej=eE||eI.considerEnabledForNonUI&&eT,eL="/"===eM||"/new"===eM||"string"==typeof eM&&eM.endsWith("/new")||eT;(0,_.useEffect)(()=>{(0,eg.getState().setPromptInputRef)(eb)},[eg]);let{markMessageSent:eU}=(0,L.B)(),eF=(0,v.fS)("claudeai_inline_conversation_creation"),eR=(0,_.useCallback)(()=>{el&&er&&er()},[er,el]);(e=>{let t=(0,_.useCallback)(t=>{let n=null==e?void 0:e.current;if(!(!n||(e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")))(document.activeElement))&&!document.querySelector('[role="dialog"], [data-radix-dialog-content]')&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var s;if(" "===t.key&&(e=>{if(!e)return!1;let t=e.tagName;return"BUTTON"===t||"SUMMARY"===t||"SELECT"===t||("INPUT"===t?["button","submit","reset","checkbox","radio"].includes(e.type):["button","checkbox","radio","switch","menuitem","menuitemcheckbox","menuitemradio","option"].includes(e.getAttribute("role")||""))})(document.activeElement))return;t.preventDefault(),null==(s=n.getEditor())||s.chain().insertContent(t.key).focus().run()}},[e]);(0,_.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])})(eb);let{attachments:eO,files:eY,syncSourceUuids:eD}=(0,b.P)(eg,(0,S.k)(e=>({attachments:e.attachments,files:e.files,syncSourceUuids:e.syncSourceUuids}))),{setAttachments:eN,setFiles:ez,setSyncSourceUuids:eB}=(0,_.useMemo)(()=>{let e=eg.getState();return{setAttachments:e.setAttachments,setFiles:e.setFiles,setSyncSourceUuids:e.setSyncSourceUuids}},[eg]);(0,N.Ac)(null==eu?void 0:eu.id,eN);let eK=(0,w.NY)(eD),eq=(0,w.qJ)(eK),eW=(0,c.B7)(eK),eG=eO.length+eY.length+eD.length>=r.XA.maxTotalUploadsPerMessage,{isModelSelectorOpen:eQ,isSending:eH,isUploadingDriveSync:eJ,isUploadingGithubSync:eX,personalizedStyle:eZ,includeProfilePreferences:eV,currentCompassTask:e$}=(0,b.P)(eg,(0,S.k)(e=>({isModelSelectorOpen:e.isModelSelectorOpen,isSending:e.isSending,isUploadingDriveSync:e.isUploadingDriveSync,isUploadingGithubSync:e.isUploadingGithubSync,personalizedStyle:e.personalizedStyle,includeProfilePreferences:e.includeProfilePreferences,currentCompassTask:e.currentCompassTask}))),{setIsModelSelectorOpen:e0,setIsSending:e1,setIsUploadingDriveSync:e2,setIsUploadingGithubSync:e3,setPersonalizedStyle:e8,setIncludeProfilePreferences:e4,setCurrentCompassTask:e9,setStoreModel:e5,setStoreConversation:e6,setStorePendingConversationSettings:e7,_setProjectUuid:te}=(0,_.useMemo)(()=>{let e=eg.getState();return{setIsModelSelectorOpen:e.setIsModelSelectorOpen,setIsSending:e.setIsSending,setIsUploadingDriveSync:e.setIsUploadingDriveSync,setIsUploadingGithubSync:e.setIsUploadingGithubSync,setPersonalizedStyle:e.setPersonalizedStyle,setIncludeProfilePreferences:e.setIncludeProfilePreferences,setCurrentCompassTask:e.setCurrentCompassTask,setStoreModel:e.setModel,setStoreConversation:e.setConversation,setStorePendingConversationSettings:e.setPendingConversationSettings,_setProjectUuid:e.setProjectUuid}},[eg]),[tt,tn]=(0,_.useState)([]),ts=(0,_.useCallback)(e=>{tn(t=>[...t,...e])},[]),to=(0,_.useCallback)(e=>{tn(t=>t.filter((t,n)=>n!==e))},[]),ta=(0,_.useCallback)((e,t)=>{let n=new FileReader;n.onload=()=>{let t=n.result.split(",")[1];tn(n=>n.map((n,s)=>s===e?{type:"image",source:{type:"base64",media_type:"image/png",data:t}}:n))},n.readAsDataURL(t)},[]),[tr,ti]=_.useState(),{stickyModelPreference:tl}=(0,Y.k)(),tu=null!=($=null!=(V=null!=(Z=null!=(y=null==ec||null==(t=ec.session_context)?void 0:t.model)?y:null==eu?void 0:eu.model)?Z:tr)?V:tl)?$:void 0,td=(0,E.vP)("enabled_mcp_tools"),tc=(0,_.useRef)(td);tc.current=td;let tp=(0,E.vP)("paprika_mode"),tm=(0,_.useRef)(tp);tm.current=tp;let tf=(0,E.vP)("compass_mode"),tg=(0,_.useRef)(tf);tg.current=tf;let tv=(0,E.vP)("enabled_web_search"),ty=(0,_.useRef)(tv);ty.current=tv;let th=(0,E.vP)("enabled_megaminds"),t_=(0,_.useRef)(th);t_.current=th;let[tx,tb]=_.useState(),tS=(0,_.useMemo)(()=>({}),[]);(0,_.useLayoutEffect)(()=>{let e=eg.getState();e.model!==tu&&e5(tu),e.conversation!==eu&&e6(eu);let t=null!=tx?tx:tS,n=e.pendingConversationSettings,s=!n||0===Object.keys(n).length,o=!tx||0===Object.keys(tx).length;s&&o||n===t||e7(t)},[eg,eu,tu,tx,tS,e5,e6,e7]);let tw=(0,_.useCallback)(e=>{tb(t=>{let n={...t,...e};return e7(n),n})},[e7]),tk=(0,b.P)(eg,e=>e.projectUuid),tC=(0,C.Ah)(),tM=(0,I.kj)(),{mutate:tI}=(0,I.my)(),{mutate:tP}=(0,k.nI)(),{data:tT}=(0,I.xQ)(tk),tE=(0,_.useCallback)(e=>{te(e),tM?e&&tI&&tI({projectUuid:e}):tC&&e&&tP&&tP({project_uuid:e})},[tC,tI,tP,te,tM]),tA=(0,M.ks)(tk),[tj,tL]=_.useState(),{storedStyle:tU,defaultStyle:tF}=(0,A.p)();(0,_.useEffect)(()=>{let e=null!=tU?tU:tF;!eZ&&e&&e8(e)},[tU,tF,eZ,e8]);let tR=(0,_.useRef)(ed);(0,_.useEffect)(()=>{(tR.current!==ed||void 0===tk&&void 0!==ed)&&(tk!==ed&&tE(ed),tR.current=ed)},[ed,tk,tE]);let tO="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null,tY=null==eu?void 0:eu.id,tD=(0,T.Ho)(),tN=(0,q.QT)(tD?tY:void 0),tz=(0,W.Z)(tY);(0,_.useEffect)(()=>{tL(void 0),e1(!1)},[tY,e1]),(0,_.useEffect)(()=>{null==tO||tO(eZ)},[eZ,tO]);let tB=(0,_.useCallback)(async()=>{ex(null);let e=eg.getState().getPrompt();if(!eb.current||""===e.trim()&&0===eO.length&&0===eY.length&&0===eD.length)return;let t=eg.getState().tipTapEditorState;if(eP){let n=function(e,t,n){let s=e.trim().startsWith("/")?e.trim().slice(1).split(" ")[0]:"";return!s||(0,l.eS)(t)?null:n.formatMessage({defaultMessage:"Unknown skill or command: {commandName}.",id:"fDuIKTmE7j"},{commandName:s})}(e,t,ek);if(n)return void ew(n,{errorContext:{tags:{source:"slash_command_unresolved"}},messageForLogging:"Unknown skill or command."})}let{progressItems:n,toSend:s}=(0,N.A)(eO),o=s.filter(e=>!e.encodingPending),r=(0,N.Le)(e,n,ek),i=(0,l.Oe)(t),{multipleNewlineCount:u,singleNewlineCount:d}=(0,a.Dn)(r);es&&tL([...eY]),eg.getState().clearAllInput(),eg.getState().setPrompt("",{forceUpdateTiptap:!1}),U.Wv.getState().setTranscript(""),ey(),es?eb.current.setEditable(!1):eb.current.setContent(""),e1(!0);try{var c,p,m,g,v;let e=el?tz:eP,t=Math.floor((null!=(c=null==eu?void 0:eu.messagesSoFar)?c:0)/2),n=null!=(p=tc.current)?p:{},s=Object.values(n).filter(Boolean).length;if(eU({conversation_uuid:em,message_length:r.length,message_index:t,is_new_conversation:!el,is_retry:!1,is_incognito:e_,is_yukon_gold:e,document_attachment_count:eO.length,image_attachment_count:eY.length,thinking_mode:"extended"===tm.current?"enabled":"disabled",research_mode:"advanced"===tg.current?"advanced":"disabled",tool_count:s,enabled_web_search:null!=(m=ty.current)&&m,used_inline_conversation_create:!el&&!eP&&eF}),eS({event_key:"claudeai.message.sent",conversation_uuid:em,model:tu,has_attachments:eO.length>0,has_files:eY.length>0,has_sync_sources:eD.length>0,message_length:r.length,is_new_conversation:!el,has_personalized_style:!!eZ,include_profile_preferences:eV,is_incognito:e_,is_yukon_gold:e,text_formatting:i,multiple_newline_count:u,single_newline_count:d}),el&&en)await en({prompt:r,attachments:o,files:eY,syncSources:eW,personalized_style:eZ,...tD?{tool_states:tN.length>0?tN:void 0}:null,imageBlocks:tt.length>0?tt:void 0}),tn([]),e1(!1),tL(void 0);else if(eP&&ea){let e=(v=null!=(g=tc.current)?g:{},Object.fromEntries(Array.from(new Set((0,G._b)(!1,v).filter(e=>"mcp_server_uuid"in e).map(e=>e.mcp_server_uuid))).map(e=>(0,G.et)(e)).filter(Boolean).filter(e=>(0,G.pH)(e.uuid)).map(e=>[e.uuid,{type:"http",url:e.url,headers:{"X-MCP-Server-ID":e.uuid}}])));await ea(r,e,tu,eY,o,tt.length>0?tt:void 0),tn([])}else{let e=eg.getState().pendingConversationSettings,t=tk&&tT&&!el?{...tT,...e}:{enabled_web_search:ty.current,enabled_mcp_tools:tc.current,enabled_megaminds:t_.current,...e};if(!eo)return void e1(!1);await eo({prompt:r,attachments:o,files:eY,syncSources:eW,model:tu,project_uuid:tk,personalized_style:eZ,include_conversation_preferences:eV,is_temporary:e_,...t})}}catch(t){if(eg.getState().setPrompt(e,{forceUpdateTiptap:!0}),eN(eO),ez(eY),eB(eD),eb.current.setEditable(!0),e1(!1),tL(void 0),t instanceof f.LG&&"opus_messages_rate_limit_exceeded"===t.errorCode)(0,j.T)();else throw t}},[eg,ex,em,eO,eY,eD,es,e1,eU,eS,tu,eV,e_,eZ,el,tz,en,ea,eW,eo,tk,tT,eN,ez,eB,eP,ew,ek,ey,null==eu?void 0:eu.messagesSoFar,tD,tN,eF,tt]),tK=(0,_.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&el){e1(!0);try{en&&(await en({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:eZ,tool_states:tD&&tN.length>0?tN:void 0}),e1(!1))}catch(e){if(e instanceof f.LG&&"opus_messages_rate_limit_exceeded"===e.errorCode)(0,j.T)();else throw e;e1(!1)}}},[el,en,eZ,e1,tD,tN]),{streamImprovement:tq,isStreaming:tW}=function(){let{activeOrganization:e}=(0,P.YL)(),[t,n]=(0,_.useState)(!1),[s,o]=(0,_.useState)(null),a=(0,_.useRef)(null),{addError:r}=(0,p.Yf)(),i=(0,_.useCallback)(async(t,s,i,l)=>{a.current&&a.current.abort();let u=new AbortController;a.current=u,n(!0),o(null);let d="/api/organizations/".concat(null==e?void 0:e.uuid,"/prompt/improve/stream");try{var c,p,m;let e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include",signal:u.signal});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=null==(c=e.body)?void 0:c.getReader(),o=new TextDecoder;if(!n)throw Error("No response body");let a="",r="",l=!1;for(;!l;){let e=await n.read();if(e.done){l=!0;break}let t=e.value,u=(a+=o.decode(t,{stream:!0})).split("\n");for(let e of(a=u.pop()||"",u))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);switch(e.type){case"content_block_delta":(null==(p=e.delta)?void 0:p.text)&&(r+=e.delta.text,s(e.delta.text));break;case"message_stop":i(e.improved_prompt||r);break;case"error":throw Error((null==(m=e.error)?void 0:m.message)||"Unknown error occurred")}}catch(e){}}else e.startsWith("event: ")&&e.slice(7)}}catch(t){if(t instanceof Error&&"AbortError"===t.name)return;let e=t instanceof Error?t:Error(String(t));o(e),null==l||l(e),r("Failed to improve prompt.",{error:e})}finally{n(!1),a.current===u&&(a.current=null)}},[null==e?void 0:e.uuid,r]);return(0,_.useEffect)(()=>()=>{a.current&&a.current.abort()},[]),{streamImprovement:i,isStreaming:t,error:s}}(),tG=(0,_.useCallback)(async()=>{var e,t,n,s;let o=eg.getState().getPrompt();if(!o.trim())return;null==(e=eb.current)||e.setEditable(!1);let a="",r=!1;try{await tq({conversation_uuid:(null==eu?void 0:eu.id)||"new-conversation",prompt:o},e=>{var t,n,s;r||(r=!0,eg.getState().setPrompt(""),null==(s=eb.current)||s.setContent("")),a+=e,eg.getState().setPrompt(a,{forceUpdateTiptap:!1}),null==(t=eb.current)||t.setContent(a),null==(n=eb.current)||n.scrollToEnd()},e=>{var t;eg.getState().setPrompt(e),null==(t=eb.current)||t.setContent(e)},e=>{var t;eg.getState().setPrompt(o),null==(t=eb.current)||t.setContent(o)})}catch(e){eg.getState().setPrompt(o),null==(t=eb.current)||t.setContent(o)}finally{null==(n=eb.current)||n.setEditable(!0),null==(s=eb.current)||s.focus()}},[eg,tq,null==eu?void 0:eu.id]),tQ=(0,_.useCallback)(async e=>{let t=eg.getState().getPrompt();if(ti(e),e5(e),el){if(ej){(null===g.Fd||void 0===g.Fd?void 0:g.Fd.setModel)||eC.push(F.Hg);return}if(eo){e1(!0);try{var n;await eo({prompt:t,attachments:eO,files:eY,syncSources:eW,model:e,project_uuid:tk,create_mode:null==eu||null==(n=eu.conversationSettings)?void 0:n.create_mode,...tx})}finally{e1(!1)}}}},[eg,e5,el,ej,eC,e1,eo,eO,eY,eW,tk,null==eu||null==(n=eu.conversationSettings)?void 0:n.create_mode,tx]),tH=(0,_.useCallback)(()=>{var e;return null==(e=eb.current)?void 0:e.focus()},[eb]),[tJ,tX]=_.useState(!1),tZ=(0,D.c)(),tV=(0,B.u9)().isAvailable,t$=(0,O.i)(e=>e.selectFolderWithTrustCheck),t0=(0,_.useCallback)(e=>{let t=e[0];t&&t$(t)},[t$]),[t1,t2,t3,t8,t4,t9,t5,t6,t7,ne,nt,nn]=(0,o.Si)({syncSourceCount:eD.length,attachments:eO,setAttachments:eN,numExistingConversationAttachments:null!=(ee=null==eu?void 0:eu.attachmentsSoFar)?ee:0,files:eY,setFiles:ez,numExistingConversationFiles:null!=(et=null==eu?void 0:eu.files.length)?et:0,detectSameAttachment:()=>!1,selectedModel:tu,conversationUuid:null==eu?void 0:eu.id,blobFileUploadsEnabled:tZ,wiggleEnabled:tV,isLocalAgentMode:ej,onImageBlocksReceived:ej?ts:void 0,onFolderDropped:ej?t0:void 0,enableEncodingPicker:!0}),ns=(0,_.useCallback)(async(e,t)=>{let n;ez(t=>{let s=[...t];return n=s[e],s.splice(e,1),s});try{await t9([t])}catch(t){if(n){let t=n;ez(n=>{let s=[...n];return s.splice(e,0,t),s})}}},[t9,ez]),no=(0,i.f)(e=>e.isLoadingMentionData),na=eO.length+eY.length,nr=eD.length,ni=t1||eJ||eX,nl=na>0||nr>0||ni||no||tt.length>0,nu=(0,_.useCallback)(e=>{switch(e.action){case"focusInput":tH();break;case"improvePrompt":tG();break;case"sendMessage":tB();break;case"setAttachments":eN(e.value);break;case"setCurrentCompassTask":e9(e.value);break;case"setFiles":ez(e.value);break;case"setHasBlockingWarning":tX(e.value);break;case"setIncludeProfilePreferences":e4(e.value);break;case"setIsModelSelectorOpen":e0(e.value);break;case"setIsUploadingDriveSync":e2(e.value);break;case"setIsUploadingFile":t2(e.value);break;case"setIsUploadingGithubSync":e3(e.value);break;case"setModel":tQ(e.value);break;case"setPendingConversationSettings":tw(e.value);break;case"setPersonalizedStyle":e8(e.value);break;case"setProjectUuid":tE(e.value);break;case"setPrompt":{var t;let n=e.value;eg.getState().setPrompt(null!=(t=null==n?void 0:n.text)?t:"",null==n?void 0:n.options)}break;case"setSyncSourceUuids":eB(e.value);break;case"setTipTapEditorState":eg.getState().setTipTapEditorJSON(e.value);break;case"stopSampling":eR()}},[tH,tG,tB,eN,e9,ez,tX,e4,e0,e2,t2,e3,tQ,tw,e8,tE,eB,eR,eg]),nd=(0,_.useMemo)(()=>{var t;return{files:e.willRedirectOnSubmit&&eH?null!=tj?tj:[]:eY,isAtMaxNumUploads:eG,isUploadingDriveSync:eJ,isUploadingGithubSync:eX,model:tu,isChatSyncing:eq,personalizedStyle:eZ,isProjectSyncing:tA,isNewConversation:eL&&(void 0===eu||0===eu.messagesSoFar),isProjectLocked:void 0!==ed||void 0!==eu,isSending:eH,setModel:tQ,setProjectUuid:tE,sendMessage:tB,sendTransparentMessage:tK,improvePrompt:tG,isImprovingPrompt:tW,stopSampling:eR,conversation:eu,focusInput:tH,promptInputRef:eb,willRedirectOnSubmit:null!=(t=e.willRedirectOnSubmit)&&t,hasBlockingWarning:tJ,setHasBlockingWarning:tX,setPersonalizedStyle:e8,setIsUploadingDriveSync:e2,setIsUploadingGithubSync:e3,includeProfilePreferences:eV,setIncludeProfilePreferences:e4,pendingConversationSettings:tx,setPendingConversationSettings:tw,isUploadingFile:t1,setIsUploadingFile:t2,validateMaxUploadLimit:t3,onDrop:t8,onPasteFiles:t4,handleUpload:t9,uploadInputProps:t6,hasAttachments:nl,isModelSelectorOpen:eQ,setIsModelSelectorOpen:e0,currentCompassTask:e$,setCurrentCompassTask:e9,dynamicAction:nu,wiggleEnabled:tV,imageBlocks:tt,removeImageBlock:to,replaceImageBlock:ta,replaceFile:ns,setEncodingModalAttachmentId:nn,isAgentMode:eP,isAgentNewRoute:eT,isLocalAgentRoute:eE,localSessionId:eA}},[eu,eY,tH,ed,tJ,eV,eG,eq,eL,tA,eH,eJ,eX,tu,eZ,tE,e.willRedirectOnSubmit,tB,tK,tG,tW,tQ,tx,tw,eR,tj,t1,t2,t3,t8,t4,t9,t6,nl,eQ,e0,e$,e9,e4,e2,e3,e8,nu,tV,tt,to,ta,ns,nn,eP,eT,eE,eA]);return(0,s.jsx)(H.jM,{value:eg,children:(0,s.jsxs)(X.Provider,{value:nd,children:[ei,(0,s.jsx)(J,{isOpen:null!==t7,attachment:t7,onConfirm:ne,onClose:nt})]})})}},0x1f22b8dda:(e,t,n)=>{n.d(t,{Z:()=>o});var s=n(0x628a9a0b);function o(e){var t,n;return null!=(n=null==(t=(0,s.$z)(null!=e?e:null).data)?void 0:t.session_id)&&!!n}},0x1f6a370bc:(e,t,n)=>{n.d(t,{C:()=>a,_:()=>o});var s=n(0x1b813d90);let o=["Drive search","Drive fetch"],a=[{uuid:"8c1b41b4-c060-4704-8c17-95c39fa3511c",name:"Gmail",type:"firstParty",syncSourceType:s.v8.GMAIL,oneLiner:"Draft replies, summarize threads, & search your inbox",description:"Connect Gmail to Claude to quickly find important emails and understand long conversations. Claude can search through your messages, read entire email threads to give you context, and help you stay on top of your inbox. Perfect for finding that message you remember sending, catching up on email chains you missed, or preparing for meetings.",toolNames:[],promptNames:[],author:{name:"Anthropic",url:"https://anthropic.com"},documentation:"https://support.anthropic.com/en/articles/11088742-using-the-gmail-and-google-calendar-integrations",support:"https://support.anthropic.com",privacyPolicy:"https://www.anthropic.com/privacy"},{uuid:"da761fc3-2821-443c-9734-0b53599fda39",name:"Google Calendar",type:"firstParty",syncSourceType:s.v8.GCAL,oneLiner:"Understand your schedule and optimize your time",description:"Connect Google Calendar to Claude so it can see your schedule, find specific events, and help you prepare for meetings. Claude can search your calendar for events, check your availability, and find free time slots for scheduling. Useful for understanding what's coming up, preparing for meetings by seeing attendee lists and details, or coordinating schedules when planning new events.",toolNames:[],promptNames:[],author:{name:"Anthropic",url:"https://anthropic.com"},documentation:"https://support.anthropic.com/en/articles/11088742-using-the-gmail-and-google-calendar-integrations",support:"https://support.anthropic.com",privacyPolicy:"https://www.anthropic.com/privacy"},{uuid:"37fb5d42-ef62-45d4-a12e-66551527a003",name:"Google Drive",type:"firstParty",syncSourceType:s.v8.GDRIVE,oneLiner:"Find and analyze files instantly",description:"Connect Google Drive to Claude so it can search through your documents, read file contents, and help you work with your files. Claude can find specific documents even when you don't remember the exact name, read and analyze the content of your docs, and convert files to different formats. Useful for finding old project notes, analyzing document content, or pulling information from files scattered across your Drive.",toolNames:[],promptNames:[],author:{name:"Anthropic",url:"https://anthropic.com"},documentation:"https://support.anthropic.com/en/articles/10166901-using-the-google-drive-integration",support:"https://support.anthropic.com",privacyPolicy:"https://www.anthropic.com/privacy"}]},0x1fb2770f2:(e,t,n)=>{n.d(t,{p:()=>r});var s=n(0xb804d868),o=n(0xac309a83),a=n(0xc9dabb82);let r=()=>{let e=(0,o.fS)("concise_mode_enabled"),{data:t,isLoading:n}=(0,a.O5)(),r=(null==t?void 0:t.defaultStyles)||[],i=[...r,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[l,u,d]=(0,s.Vc)("claude_personalized_style",null);if(n||!(null==i?void 0:i.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:u,clearStoredStyle:d,conciseModeEnabled:e};let c=r.length?r.find(e=>!0===e.isDefault)||r[0]:null;if(e&&(c=r.find(e=>"Concise"===e.key)||c),!l)return{personalizedStyleOptions:i,defaultStyle:c,storedStyle:l,setStoredStyle:u,clearStoredStyle:d,conciseModeEnabled:e};let p=i.find(e=>((e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t)(e,l.styleKey)),m=Date.now()-new Date(l.timestamp).getTime()>432e5;return{personalizedStyleOptions:i,storedStyle:p&&!m?p:null,defaultStyle:c,setStoredStyle:u,clearStoredStyle:d,conciseModeEnabled:e}}},0x21fb79560:(e,t,n)=>{n.d(t,{M:()=>r});var s=n(0x22102fd88),o=n(0x1a1f6dda6),a=n(0x38e6572);function r(e){let{className:t,onClick:n,as:r="span"}=e;return(0,s.jsx)(r,{className:(0,o.A)("border-0.5 border-border-400 text-accent-secondary-000 px-1.5 py-px rounded-3xl font-small",n&&"cursor-pointer hover:border-border-300 transition-colors",t),onClick:n,children:(0,s.jsx)(a.A,{defaultMessage:"Upgrade",id:"0h/lPMeYkq"})})}},0x22f589dfd:(e,t,n)=>{n.d(t,{JL:()=>r,L$:()=>o,NS:()=>a,Xr:()=>i});var s=n(0xfc89b4a4);let o=(0,s.createContext)(null),a=(0,s.createContext)(null);function r(){let e=(0,s.useContext)(o);if(!e)throw Error("useSessionActions must be used within SessionDataProvider");return e}function i(){let e=(0,s.useContext)(a);if(!e)throw Error("useSessionId must be used within SessionDataProvider");return e}},0x22f6fe185:(e,t,n)=>{n.d(t,{Ur:()=>l,pJ:()=>u,sk:()=>r,sr:()=>c});var s=n(0x394ef833),o=n(0x76f43a70),a=n(0x15d264a53);let r=(0,s.v)(e=>({sessionContext:null,setSessionContext:t=>e({sessionContext:t}),_callbacksRef:{current:null}})),i=()=>Promise.resolve();function l(e){r.getState()._callbacksRef.current=e}function u(e){var t,n,s,o,a,r;return{isLoading:!e,connectionState:e?"connecting":"disconnected",hasError:!!(null==e?void 0:e.error),errorMessage:null!=(t=null==e?void 0:e.error)?t:null,sessionTitle:null==e?void 0:e.title,processIsRunning:null!=(n=null==e?void 0:e.isRunning)&&n,homePath:null==e?void 0:e.homePath,folderExists:null==(s=null==e?void 0:e.folderExists)||s,sessionModel:null==e?void 0:e.model,userSelectedFolders:null!=(o=null==e?void 0:e.userSelectedFolders)?o:[],mountedProjects:null!=(a=null==e?void 0:e.mountedProjects)?a:[],scheduledTaskId:null==e?void 0:e.scheduledTaskId,spaceId:null==e?void 0:e.spaceId,promptSuggestion:null!=(r=null==e?void 0:e.promptSuggestion)?r:null,cwd:null==e?void 0:e.cwd}}let d={type:"local_agent_mode",initialMessages:[],streamedMessages:void 0,lastUserMessageUuid:void 0,pendingMessages:[],messages:[],lastMessageTime:null,nextReconnectTime:null,toolPermissionRequests:[],mcqAnswers:void 0,initializationStatus:null,agentActivity:null,fsDetectedFiles:new Map,showRetryButton:!1,streamingResponseChars:0,...{submitMessage:(e,t,n)=>{var s,o;return null!=(o=null==(s=r.getState()._callbacksRef.current)?void 0:s.submitMessage(e,t,n))?o:i()},stopSession:()=>{var e,t;return null!=(t=null==(e=r.getState()._callbacksRef.current)?void 0:e.stopSession())?t:void 0},archiveSession:()=>{var e,t;return null!=(t=null==(e=r.getState()._callbacksRef.current)?void 0:e.archiveSession())?t:i()},ensureConnected:()=>{var e,t;return null!=(t=null==(e=r.getState()._callbacksRef.current)?void 0:e.ensureConnected())?t:void 0},retry:()=>{var e,t;return null!=(t=null==(e=r.getState()._callbacksRef.current)?void 0:e.retry())?t:void 0},softRetry:()=>{var e,t;return null!=(t=null==(e=r.getState()._callbacksRef.current)?void 0:e.softRetry())?t:void 0},updateSession:e=>{var t,n;return null!=(n=null==(t=r.getState()._callbacksRef.current)?void 0:t.updateSession(e))?n:void 0},sendToolDecision:(e,t,n,s)=>{var o,a;return null!=(a=null==(o=r.getState()._callbacksRef.current)?void 0:o.sendToolDecision(e,t,n,s))?a:i()}}};function c(e){var t,n;let s=r.getState();if((null==(t=s.sessionContext)?void 0:t.sessionId)===e)return;s._callbacksRef.current=null;let i=u(a.PU.getState().sessions.find(t=>t.sessionId===e));r.setState({sessionContext:{...d,sessionId:e,isLoading:i.isLoading,isLoadingInitialMessages:i.isLoading,isSessionRunning:i.processIsRunning,connectionState:i.connectionState,sessionLoadingError:i.hasError,sessionErrorMessage:i.errorMessage,scheduledTaskId:i.scheduledTaskId,spaceId:i.spaceId,promptSuggestion:i.promptSuggestion,sessionData:{id:e,updated_at:new Date().toISOString(),environment_id:o.u0,type:"local_agent_mode_session",title:null!=(n=i.sessionTitle)?n:"New task",session_status:i.processIsRunning?"running":"idle",cwd:i.cwd,cliSessionId:void 0,homePath:i.homePath,folderExists:i.folderExists,userSelectedFolders:i.userSelectedFolders,mountedProjects:i.mountedProjects,session_context:{sources:[],...i.sessionModel&&{model:i.sessionModel}}}}})}},0x25062734b:(e,t,n)=>{n.d(t,{$V:()=>w,uC:()=>x,tg:()=>b,vx:()=>y.v,L$:()=>A,yr:()=>C,sb:()=>S,v_:()=>T,Ax:()=>E,M8:()=>I,ko:()=>k,AY:()=>M,es:()=>P});var s=n(0x17aa9d8d7),o=n(0xf32c56dd),a=n(0x12c9046cd),r=n(0x20b939f38);n(0x21e26ba67);var i=n(0xac309a83),l=n(0x1bd175d8c),u=n(0x78b33fbd),d=n(0xfc89b4a4),c=n(0x14c0dfde7),p=n(0x1d302b010),m=n(0x22be9474c),f=n(0x1417f52d9),g=n(0x1f08d8b5d),v=n(0x1c12b3087),y=n(0x8fd88b73),h=n(0xe824fb1c),_=n(0x31c535e9);let x=["allow","ask","blocked"];function b(e){return e.includes(":")||e.startsWith("mcp__")}let S=()=>(0,i.fS)("bagel_enabled"),w="mcp_directory_chin",k=function(){var e,t;let{shouldTrack:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,d.useRef)(!1),o=S(),{dismiss:a}=(0,f.W)(),{account:i}=(0,r.YL)(),l=(()=>{let e=(0,r.zm)(),t=(0,y.v)();return e&&!t})(),u=new Date,c="".concat(u.getDate(),"-").concat(u.getMonth(),"-").concat(u.getFullYear()),p="".concat(w,"_").concat(c),m=(null!=(t=null==i||null==(e=i.settings.dismissed_claudeai_banners)?void 0:e.map(e=>e.banner_id))?t:[]).filter(e=>e.includes(w)),g=(0,d.useMemo)(()=>!(!o||l||m.includes(w))&&(!(m.length>3)||!m.includes(p)),[l,o,m,p]);return(0,d.useEffect)(()=>{!s.current&&g&&!m.includes(p)&&n&&(a(p),s.current=!0)},[p,m,n,a,g]),g};function C(){var e;let t=(0,i.fS)("disable_destructive_mcp_tools_by_default"),{getMcpToolApprovalConfigSetting:n}=function(){let{value:e}=(0,u.useDynamicConfig)("mcp_tool_approval_config"),t=(0,d.useCallback)((t,n)=>{var s,o;if(!e||!t)return;let a=[t.url,t.uuid,t.name].map(t=>{var s,o;if(t)return(null==(s=e[t])?void 0:s[null!=n?n:"*"])||(null==(o=e[t])?void 0:o["*"])||void 0}).find(e=>void 0!==e);return void 0!==a?a:n&&(null==(s=e["*"])?void 0:s[n])!==void 0?e["*"][n]:(null==(o=e["*"])?void 0:o["*"])!==void 0?e["*"]["*"]:void 0},[e]);return{toolApprovalConfig:e,getMcpToolApprovalConfigSetting:t}}(),{shouldExpandToolInput:s}=function(){let{value:e}=(0,u.useDynamicConfig)("mcp_tool_input_expand_config");return{shouldExpandToolInput:(0,d.useCallback)((t,n)=>{var s,o;if(!e||!t)return!1;let a=[t.url,t.uuid,t.name].map(t=>{var s,o,a,r;if(t)return null!=(r=null!=(a=null==(s=e[t])?void 0:s[null!=n?n:"*"])?a:null==(o=e[t])?void 0:o["*"])?r:void 0}).find(e=>void 0!==e);return void 0!==a?a:n&&(null==(s=e["*"])?void 0:s[n])!==void 0?e["*"][n]:(null==(o=e["*"])?void 0:o["*"])!==void 0&&e["*"]["*"]},[e])}}(),{account:o}=(0,r.YL)(),a=null==o||null==(e=o.settings)?void 0:e.enabled_mcp_tools,{data:l}=(0,m.rX)(),c=null==l?void 0:l.disabled_features.includes("tool_approval_default_always_allow");return(0,d.useCallback)((e,o)=>{var r,i;let l=n(e,null==o?void 0:o.name),u=s(e,null==o?void 0:o.name),d=(null==o?void 0:o.alwaysApprovedKey)?null==a?void 0:a[null==o?void 0:o.alwaysApprovedKey]:void 0;return t&&(null==o||null==(r=o.annotations)?void 0:r.destructiveHint)===!0?{approvalRequired:!0,showAlwaysAllowed:!1,expandInputByDefault:u}:c||"always"===l?{approvalRequired:!0,showAlwaysAllowed:!1,managedByOrg:!0,expandInputByDefault:u}:d?{approvalRequired:!1}:"server"===l?{approvalRequired:!1,managedByServer:!0}:"never"===l&&!1!==d||"readOnly"===l&&(null==o||null==(i=o.annotations)?void 0:i.readOnlyHint)===!0&&!1!==d?{approvalRequired:!1}:{approvalRequired:!0,showAlwaysAllowed:!0,managedByOrg:!1,managedByServer:!1,expandInputByDefault:u}},[t,n,s,a,c])}let M=()=>{let e=(0,h.Uz)({type:"local"});return!!(0,l.V)()&&e.length>0},I=()=>{var e,t,n;let s=(0,g.o)(),o=(null==(e=s.pendingConversationSettings)?void 0:e.compass_mode)==="advanced"||(null==(n=s.conversation)||null==(t=n.conversationSettings)?void 0:t.compass_mode)==="advanced",a=(0,h.Uz)({type:"remote"}).length>0;return o&&a},P=e=>{let t=(0,v.jw)(),{account:n}=(0,r.YL)(),{updateSettings:a}=(0,_.IS)(),{track:i}=(0,o.st)(),{mutate:l}=(0,s.yJ)();return{toggleMcpToolEnabled:async(s,o,r,l)=>{if(!n)return;let u=Array.isArray(s)?s.reduce((e,t)=>({...e,[t]:o}),{}):{[s]:o};i({event_key:"claudeai.mcp.tool.toggled",conversation_uuid:(null==t?void 0:t.id)||null,setting:s,value:o,url:r,source:null==e?void 0:e.source}),await a({mcpToolsUpdate:u,signal:null==l?void 0:l.signal})},toggleMcpToolAlwaysApproved:(e,t)=>{n&&l({enabled_mcp_tools:{...n.settings.enabled_mcp_tools,[e]:t}})}}},T=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,{data:s}=(0,p.XT)(n,e||"",{enabled:!!e&&!!n});return!!s},E=()=>{let e=(0,c.p9)(),{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid;return(0,a.L2)("/api/organizations/".concat(n,"/mcp/resources"),"POST",{enabled:e&&!!n})};function A(){var e;let t=C(),{account:n}=(0,r.YL)(),s=null==n||null==(e=n.settings)?void 0:e.enabled_mcp_tools,{value:o}=(0,u.useDynamicConfig)("yukon_silver_tool_perms");return(0,d.useCallback)(e=>{if((null==o?void 0:o[e])==="always_allow")return{permission:"allow",approvalState:{approvalRequired:!1}};let n=(0,h.pK)(e);if(!n)return{permission:"ask",approvalState:{approvalRequired:!0,showAlwaysAllowed:!0}};let{tool:a,server:r}=n;if((null==s?void 0:s[a.enabledKey])===!1)return{permission:"blocked",approvalState:{approvalRequired:!1}};let i=t("remote"===r.type?h.eZ.getState().remoteServers[r.uuid]:{name:r.name,uuid:r.uuid,url:void 0},a);return i.approvalRequired?{permission:"ask",approvalState:i}:{permission:"allow",approvalState:i}},[t,s,o])}}}]);