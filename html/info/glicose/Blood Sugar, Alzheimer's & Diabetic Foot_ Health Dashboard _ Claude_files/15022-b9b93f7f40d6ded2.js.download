try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="3b054076-48a8-4e56-b0d9-3944cec7df9a",e._sentryDebugIdIdentifier="sentry-dbid-3b054076-48a8-4e56-b0d9-3944cec7df9a")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15022],{0x26b0b403:(e,t,n)=>{function a(e){return"text"===e.type&&e.text?{...e,text:e.text.replace("​","")}:e.content?{...e,content:e.content.map(a)}:e}n.d(t,{DV:()=>a,Oe:()=>o,eS:()=>r,h0:()=>i});let o=e=>{let t=new Set,n=e=>{if("codeBlock"===e.type&&t.add("pre"),"bulletList"===e.type&&t.add("ul"),"orderedList"===e.type&&t.add("ol"),"text"===e.type&&e.marks)for(let n of e.marks)t.add(n.type);if(e.content)for(let t of e.content)n(t)};return n(e),Array.from(t).map(e=>"".concat(":").concat(e)).sort().join("")};function r(e){var t,n;return"commandChip"===e.type||"skillChip"===e.type||"connectorToolChip"===e.type||null!=(n=null==(t=e.content)?void 0:t.some(r))&&n}let i=e=>{let t="",n=0,a=function(e){var o,r,i,s,l,c,u,d,p;let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("doc"===e.type&&e.content)for(let t of e.content)a(t);else if("paragraph"===e.type){if(e.content)for(let t of e.content)a(t);t+="\n"}else if("text"===e.type){let n=e.text;if(e.marks)for(let t of e.marks)"bold"===t.type?n="**".concat(n,"**"):"italic"===t.type?n="*".concat(n,"*"):"underline"===t.type?n="__".concat(n,"__"):"strike"===t.type?n="~~".concat(n,"~~"):"code"===t.type&&(n="`".concat(n,"`"));t+=n}else if("codeBlock"===e.type){let n=e.attrs&&"string"==typeof e.attrs.language?e.attrs.language:"";if(t+="\n```".concat(n,"\n"),e.content)for(let t of e.content)a(t);t+="\n```\n\n"}else if("bulletList"===e.type&&e.content)for(let t of e.content)a(t);else if("orderedList"===e.type&&e.content)for(let t=0;t<e.content.length;t++)a(e.content[t],t+1,!0);else if("listItem"===e.type&&e.content){let o="   ".repeat(n);for(let r of(y?t+="".concat(o).concat(f,". "):t+="".concat(o,"* "),e.content))n+=1,a(r),n-=1}else if("mention"===e.type){let n=(null==(o=e.attrs)?void 0:o.renderedText)||(null==(r=e.attrs)?void 0:r.label)||"";t+="@".concat(n)}else if("skillChip"===e.type){let n=(null==(i=e.attrs)?void 0:i.skillId)||(null==(s=e.attrs)?void 0:s.skillDisplayName)||"";t+="/".concat(n)}else if("commandChip"===e.type){let n=(null==(l=e.attrs)?void 0:l.commandId)||(null==(c=e.attrs)?void 0:c.commandDisplayName)||"";t+="/".concat(n)}else if("connectorToolChip"===e.type){let n=(null==(u=e.attrs)?void 0:u.toolDisplayName)||(null==(d=e.attrs)?void 0:d.toolName)||"",a=(null==(p=e.attrs)?void 0:p.connectorName)||"";t+=a?"".concat(a,": ").concat(n):n}};return a(e),t.replace("​","").trim()}},0xbebfc702:(e,t,n)=>{n.d(t,{BN:()=>T,CB:()=>S,GQ:()=>E,Gz:()=>I,Kf:()=>_,LQ:()=>w,PL:()=>h,Zd:()=>A,bL:()=>x,bs:()=>P,dx:()=>g,eW:()=>k,fo:()=>C,gM:()=>m,gr:()=>v,kj:()=>z,mu:()=>L,my:()=>D,nl:()=>Q,sC:()=>y,sS:()=>U,tz:()=>K,u7:()=>b,xQ:()=>M});var a=n(0x628a9a0b),o=n(0x12c9046cd),r=n(0x20b939f38),i=n(0x10728a05e),s=n(0x1016c6ed2),l=n(0x49fac030),c=n(0xac309a83),u=n(0x17e725145),d=n(0xfc89b4a4),p=n(0x1ab0d1ca1),f=n(0xd5e0c33c);let y=30,g=1e4;var m=function(e){return e.Student="student",e.Meeting="meeting",e.Haystack="haystack",e}({}),v=function(e){return e.Study="study",e.Career="career",e.Research="research",e.Zoom="zoom",e.Teams="teams",e.GoogleMeet="google_meet",e}({});let h=()=>{let{activeOrganization:e}=(0,r.YL)(),t=(0,r.Hb)();return(0,o.Sk)("/api/organizations/".concat(t,"/projects/count"),{queryKey:[l.Wy2,{orgUuid:t}],staleTime:3e5,enabled:!!e,meta:{noToast:e=>e instanceof s.LG&&"permission_error"===e.type}})},S=e=>{let{enabled:t=!0,limit:n,offset:a,starred:i,creatorFilter:s,projectFilter:c,orderBy:u,type:y}=e,{activeOrganization:g}=(0,r.YL)(),m=(0,f.K)(),v=(0,r.Hb)(),h=(0,p.A)(),S=new URLSearchParams;S.append("include_harmony_projects","true"),void 0!==n&&S.append("limit",n.toString()),void 0!==a&&S.append("offset",a.toString()),void 0!==i&&S.append("starred",i.toString()),void 0!==s&&S.append("creator_filter",s.toString()),void 0!==c&&S.append("filter",c.toString()),void 0!==u&&S.append("order_by",u.toString()),void 0!==y&&S.append("type",y.toString());let b=(0,d.useCallback)(e=>{let t=e.length===n;return Object.assign(e.filter(e=>!e.archived_at).map(e=>"haystack"===e.type?{...e,unformattedName:e.name,name:h.formatMessage({defaultMessage:"Ask {name}",id:"bH47Z4hSE8"},{name:e.name})}:e),{hasMore:t})},[h,n]);return(0,o.Sk)("/api/organizations/".concat(v,"/projects?").concat(S.toString()),{queryKey:[l.BPc,{orgUuid:v},{limit:n,offset:a,starred:i,creatorFilter:s,projectFilter:c,orderBy:u,type:y}],enabled:!!(t&&g&&m),select:b})},b=e=>{let{enabled:t=!0,limit:n=y,offset:a=0,starred:i,creatorFilter:s,projectFilter:c,orderBy:u,searchQuery:d,isArchived:p}=e,{activeOrganization:g}=(0,r.YL)(),m=(0,f.K)(),v=(0,r.Hb)(),h=new URLSearchParams;return h.append("limit",n.toString()),h.append("offset",a.toString()),void 0!==i&&h.append("starred",i.toString()),void 0!==s&&h.append("creator_filter",s.toString()),void 0!==c&&h.append("filter",c.toString()),void 0!==u&&h.append("order_by",u.toString()),void 0!==d&&h.append("searchQuery",d.toString()),void 0!==p&&h.append("is_archived",p.toString()),(0,o.Sk)("/api/organizations/".concat(v,"/projects_v2?").concat(h.toString()),{queryKey:[l.WfP,{orgUuid:v},{limit:n,offset:a,starred:i,creatorFilter:s,projectFilter:c,orderBy:u,searchQuery:d,isArchived:p}],enabled:!!(t&&g&&m)})},_=()=>{let{activeOrganization:e}=(0,r.YL)(),t=(0,o.mn)();return(0,d.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},P=()=>{let e=_(),t=(0,a.uE)();return(0,d.useCallback)(async()=>{let[n,o]=await Promise.all([e(),t({limit:a.dy})]);return((e,t)=>{let n=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),a=null==e?void 0:e.filter(e=>!n.find(t=>t.uuid===e.uuid));return[...n,...a]})(n,o)},[t,e])},C=e=>{let{activeOrganization:t}=(0,r.YL)(),n=(0,r.Hb)(),a=(0,p.A)();return(0,o.Sk)("/api/organizations/".concat(n,"/projects/").concat(e),{queryKey:[l.hcP,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof s.LG&&(404===e.statusCode||403===e.statusCode)},select:e=>"haystack"===e.type?{...e,unformattedName:e.name,name:a.formatMessage({defaultMessage:"Ask {name}",id:"bH47Z4hSE8"},{name:e.name})}:e})},j=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=(0,u.useQueryClient)();return{addProject:e=>{n.setQueriesData({queryKey:[l.WfP,{orgUuid:t}]},t=>t?{...t,data:[e,...t.data],pagination:{...t.pagination,total:t.pagination.total+1}}:t),n.setQueriesData({queryKey:[l.BPc,{orgUuid:t}]},t=>t?[e,...t]:t),n.setQueriesData({queryKey:[l.Wy2,{orgUuid:t}]},e=>e?{count:e.count+1}:e)},removeProject:e=>{n.setQueriesData({queryKey:[l.WfP,{orgUuid:t}]},t=>t?{...t,data:t.data.filter(t=>t.uuid!==e),pagination:{...t.pagination,total:Math.max(0,t.pagination.total-1)}}:t),n.setQueriesData({queryKey:[l.BPc,{orgUuid:t}]},t=>t?t.filter(t=>t.uuid!==e):t),n.setQueriesData({queryKey:[l.Wy2,{orgUuid:t}]},e=>e?{count:Math.max(0,e.count-1)}:e)}}},x=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=I(),{addProject:a}=j();return(0,o.L2)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:e=>{a(e),n()}})},U=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,a=I();return(0,o.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{a(e)},queryKey:[l.hcP,{orgUuid:n,projectUuid:e}]})},k=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,a=I(),{removeProject:i}=j(),s=(0,u.useQueryClient)();return(0,o.L2)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"DELETE",{onSuccess:()=>{i(e),[[l.hcP,{orgUuid:n,projectUuid:e}],[l.yFg,{orgUuid:n,projectUuid:e}],[l.vEh,{projectUuid:e}]].forEach(e=>void s.cancelQueries({queryKey:e})),a()}})},w=function(e){let{limit:t=30,offset:n=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,r.YL)(),i=(0,r.Hb)(),c=new URLSearchParams;return c.append("limit",t.toString()),c.append("offset",n.toString()),(0,o.Sk)("/api/organizations/".concat(i,"/projects/").concat(e,"/conversations_v2?").concat(c.toString()),{queryKey:[l.yFg,{orgUuid:i,projectUuid:e,limit:t,offset:n}],enabled:!!a,staleTime:0,meta:{noToast:e=>e instanceof s.LG&&(404===e.statusCode||403===e.statusCode)}})},T=()=>{var e,t;let n=S({enabled:!0,creatorFilter:"is_creator",limit:g}),a=null==(t=n.data)||null==(e=t.find(e=>e.is_starter_project))?void 0:e.uuid;return{...n,data:a}},I=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=(0,u.useQueryClient)();return(e,a)=>{let{remove:o=!1}=a||{};if([[l.BPc,{orgUuid:t}],[l.WfP,{orgUuid:t}],[l.Wy2,{orgUuid:t}]].forEach(e=>void n.invalidateQueries({queryKey:e})),e){let a=o?"removeQueries":"invalidateQueries";[[l.hcP,{orgUuid:t,projectUuid:e}],[l.yFg,{orgUuid:t,projectUuid:e}],[l.vEh,{projectUuid:e}]].forEach(e=>void n[a]({queryKey:e}))}}},E=(e,t)=>{let n=I();return(0,o.L2)("/api/organizations/".concat(e,"/projects/").concat(t,"/report"),"POST",{enabled:!!t&&!!e,onSuccess:()=>{n(t)}})},M=e=>{let{activeOrganization:t}=(0,r.YL)(),n=(0,r.Hb)(),a=(0,c.fS)("claude_ai_sticky_project_settings");return(0,o.Sk)("/api/organizations/".concat(n,"/projects/").concat(e,"/settings"),{queryKey:[l.vXN,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e&&a)})},L=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,a=(0,c.fS)("claude_ai_sticky_project_settings");return(0,o.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/settings"),"PUT",(e,t)=>t?{...t,...e}:void 0,{queryKey:[l.vXN,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e&&a)})},D=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=(0,u.useQueryClient)();return(0,o.L2)(e=>"/api/organizations/".concat(t,"/projects/").concat(e.projectUuid,"/sync"),"POST",{meta:{noToast:!0},onSuccess:(e,a)=>{"done"===e.kb_resync_status&&a.projectUuid&&n.invalidateQueries({queryKey:[l.qzW,{orgUuid:t,projectUuid:a.projectUuid}]}),a.projectUuid&&e.gdrive_resource_backfill_triggered&&n.invalidateQueries({queryKey:[l.LVb,{orgUuid:t,projectUuid:a.projectUuid}]})}})},z=()=>(0,c.fS)("claudeai_sync_project"),A=()=>{let{mutateAsync:e}=(0,a.x6)();return{moveToProject:(0,d.useCallback)(async function(t,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{batchSize:o=20,batchDelayMs:r=500}=a;if(!t.length||!n)return Promise.resolve({totalMoved:0,totalFailed:0,conversationUuids:[],projectUuid:""});let i=t.length>1,s=0,l=0;if(i){let a=Math.ceil(t.length/o);for(let i=0;i<a;i++){let c=i*o,u=t.slice(c,c+o),d=await e({conversation_uuids:u,project_uuid:n});s+=d.moved.length,l+=d.failed.length,i<a-1&&await new Promise(e=>setTimeout(e,r))}}else{let a=await e({conversation_uuids:t,project_uuid:n});s=a.moved.length,l=a.failed.length}return{totalMoved:s,totalFailed:l,conversationUuids:t,projectUuid:n}},[e])}},Q=()=>{let{mutateAsync:e}=(0,a.x6)(),{addSuccess:t,addError:n}=(0,i.Yf)(),o=(0,p.A)(),s=(0,u.useQueryClient)(),{activeOrganization:c}=(0,r.YL)(),f=null==c?void 0:c.uuid,[y,g]=(0,d.useState)(new Set),m=(0,d.useCallback)(async function(r){let{showSuccess:i=!0,showError:c=!0,onSuccess:u}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r.length)return Promise.resolve({moved:[],failed:[]});if(r.some(e=>y.has(e)))return Promise.resolve({moved:[],failed:r});g(e=>{let t=new Set(e);return r.forEach(e=>t.add(e)),t}),r.forEach(e=>{let t=[l.fCN,{orgUuid:f},{uuid:e},{returnDanglingHumanMessage:!1}];s.getQueryData(t)&&s.setQueryData(t,e=>e?{...e,project_uuid:void 0}:e)});try{let n=await e({conversation_uuids:r,project_uuid:null});return n.moved.length>0&&i&&t(o.formatMessage({defaultMessage:"Chat removed from project",id:"UkGfrdMZdS"})),null==u||u(n),await (0,a.C4)(s,f,r),n}catch(e){throw await (0,a.C4)(s,f,r),c&&n(o.formatMessage({defaultMessage:"Failed to remove chat from project",id:"4suoYkIuEm"}),{error:e,messageForLogging:"Failed to remove chat from project"}),e}finally{g(e=>{let t=new Set(e);return r.forEach(e=>t.delete(e)),t})}},[e,t,n,o,y,s,f]),v=(0,d.useCallback)(e=>y.has(e),[y]);return{removeFromProject:m,isRemoving:y.size>0,isRemovingConversation:v}},K=e=>{let{activeOrganization:t}=(0,r.YL)(),n=(0,r.Hb)();return(0,o.Sk)("/api/organizations/".concat(n,"/projects/").concat(e,"/permissions"),{queryKey:[l._P1,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e)})}},0xd5e0c33c:(e,t,n)=>{n.d(t,{K:()=>i,p:()=>s});var a=n(0x20b939f38),o=n(0xac309a83),r=n(0x78b33fbd);let i=()=>{let e=(0,a.O9)(),t=(0,a.zc)(),n=(0,a.mV)(),i=(0,r.useDynamicConfig)("claude_ai_projects_limits").get("max_free_projects",0)>0,s=(0,o.GZ)("trials_freemium","free_project",!1,o.Km);return i||e||t||n||s},s=()=>{let e=(0,a.O9)(),t=(0,a.zc)(),n=(0,a.mV)(),i=(0,r.useDynamicConfig)("claude_ai_projects_limits"),s=(0,o.GZ)("trials_freemium","free_project",!1,o.Km);if(e||t||n)return;let l=i.get("max_free_projects",0);return l>0?l:+!!s}},0x16d4e9516:(e,t,n)=>{n.d(t,{E:()=>c});var a=n(0x1c0d05ee6),o=n(0x16784b660),r=n(0x16db0212f),i=n(0x26b0b403),s=n(0x18e5c6e75);let l={type:"doc",content:[{type:"paragraph",content:[]}]},c=e=>{let{conversationId:t="default",enableV2:n=!1}=e,c=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{...((e,t)=>({tipTapEditorState:l,getPrompt:()=>(0,i.h0)(t().tipTapEditorState),setPrompt:function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{forceUpdateTiptap:o=!1,unsafe:r=!1}=a,i=(0,s.P)(n),l=i.split("\n").map(e=>({type:"paragraph",content:e?[{type:"text",text:e}]:[]})),c={type:"doc",content:l.length>0?l:[{type:"paragraph",content:[]}]};if(i.length>0&&r&&(c.__ant_unsafe=!0),e({tipTapEditorState:c}),o){var u;let e=null==(u=t().promptInputRef)?void 0:u.current;e&&(e.setContent(i),e.focus(),e.scrollToEnd())}return i},setTipTapEditorJSON:n=>{let a=!0===t().tipTapEditorState.__ant_unsafe,o=(0,i.h0)(n);return o.length>0&&a&&(n.__ant_unsafe=!0),e({tipTapEditorState:n}),o},clearPrompt:()=>{e({tipTapEditorState:l})},clearAllInput:()=>{e({tipTapEditorState:l,attachments:[],files:[],syncSourceUuids:[]})}}))(...t),...((e,t)=>({attachments:[],files:[],syncSourceUuids:[],transitionFiles:[],setAttachments:n=>{e({attachments:"function"==typeof n?n(t().attachments):n})},setFiles:n=>{e({files:"function"==typeof n?n(t().files):n})},setSyncSourceUuids:n=>{e({syncSourceUuids:"function"==typeof n?n(t().syncSourceUuids):n})},setTransitionFiles:t=>{e({transitionFiles:t})}}))(...t),...(e=>({model:"",projectUuid:void 0,pendingConversationSettings:{},conversation:void 0,setModel:t=>e({model:t}),setProjectUuid:t=>e({projectUuid:t}),setPendingConversationSettings:t=>e(e=>({pendingConversationSettings:{...e.pendingConversationSettings,...t}})),setConversation:t=>e({conversation:t})}))(...t),...(e=>({previewPrompt:void 0,isModelSelectorOpen:!1,hasBlockingWarning:!1,personalizedStyle:void 0,includeProfilePreferences:!0,currentCompassTask:void 0,setPreviewPrompt:t=>e({previewPrompt:t}),setIsModelSelectorOpen:t=>e({isModelSelectorOpen:t}),setHasBlockingWarning:t=>e({hasBlockingWarning:t}),setPersonalizedStyle:t=>e({personalizedStyle:t}),setIncludeProfilePreferences:t=>e({includeProfilePreferences:t}),setCurrentCompassTask:t=>e({currentCompassTask:t})}))(...t),...(e=>({isUploadingFile:!1,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingFile:t=>e({isUploadingFile:t}),setIsUploadingDriveSync:t=>e({isUploadingDriveSync:t}),setIsUploadingGithubSync:t=>e({isUploadingGithubSync:t})}))(...t),...(e=>({isSending:!1,isImprovingPrompt:!1,setIsSending:t=>e({isSending:t}),setIsImprovingPrompt:t=>e({isImprovingPrompt:t})}))(...t),...(()=>({isAtMaxNumUploads:!1,hasAttachments:!1,isChatSyncing:!1,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,willRedirectOnSubmit:!1}))(...t),...(()=>({sendMessage:void 0,sendTransparentMessage:void 0,stopSampling:void 0,focusInput:void 0,improvePrompt:void 0,validateMaxUploadLimit:void 0,onDrop:void 0,onPasteFiles:void 0,handleUpload:void 0,uploadInputProps:void 0}))(...t),...(e=>({promptInputRef:void 0,setPromptInputRef:t=>e({promptInputRef:t})}))(...t),_hasHydrated:!0}};if(n&&"new-conversation"!==t){let e=(0,a.Ab)(),n=(0,r.y)()((0,o.eh)((0,o.Zr)(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{...c(...t),_hasHydrated:!1}},{name:t,storage:e,partialize:e=>({tipTapEditorState:e.tipTapEditorState,attachments:e.attachments.filter(e=>!e.encodingPending).map(e=>{let{encodingPending:t,...n}=e;return n}),files:e.files,syncSourceUuids:e.syncSourceUuids}),onRehydrateStorage:()=>()=>{n.setState({_hasHydrated:!0})}})));return{store:n,clearStorage:()=>{null==e||e.removeItem(t)},cleanup:()=>{null==e||e.cleanup()}}}return{store:(0,r.y)()((0,o.eh)(c)),clearStorage:()=>void 0}}},0x1c0d05ee6:(e,t,n)=>{let a;n.d(t,{Ab:()=>f,O:()=>y});var o=n(0x1e8acf8e9),r=n(0x733b8fe2),i=n.n(r),s=n(0x16784b660);function l(e){return"".concat("store:").concat(e,":")}function c(e,t){return"".concat(l(e)).concat(t)}async function u(e,t){try{let a=l(e),r=(await (0,o.HP)()).filter(e=>"string"==typeof e&&e.startsWith(a));if(r.length<=t)return;let i=[];for(let e of r){let t=await (0,o.Jt)(e);if(t)try{var n;let a=JSON.parse(t);i.push({key:e,updatedAt:null!=(n=a.updatedAt)?n:0})}catch(t){i.push({key:e,updatedAt:0})}}for(let{key:e}of(i.sort((e,t)=>t.updatedAt-e.updatedAt),i.slice(t)))await (0,o.yH)(e)}catch(e){}}let d="chat-draft";function p(e){var t,n;return!!e&&!!((null==(n=e.tipTapEditorState)||null==(t=n.content)?void 0:t.some(e=>e.content&&e.content.length>0))||e.attachments&&e.attachments.length>0||e.files&&e.files.length>0||e.syncSourceUuids&&e.syncSourceUuids.length>0)}function f(){let e=function(e){let{prefix:t,maxEntries:n,shouldPersist:a,waitFor:r,writeDebounceMs:s}=e,l=async(e,i)=>{r&&await r;let s=JSON.parse(i);if(a&&!a(s.state))return void await (0,o.yH)(c(t,e));s.updatedAt=Date.now(),await (0,o.hZ)(c(t,e),JSON.stringify(s)),void 0!==n&&u(t,n)},d=new Map;return{getItem:async e=>{try{r&&await r;let n=await (0,o.Jt)(c(t,e));return null!=n?n:null}catch(e){return null}},setItem:async(e,t)=>{try{if(s){let n;((n=d.get(e))||(n=i()(t=>void l(e,t),s,{maxWait:(null!=s?s:0)*4}),d.set(e,n)),n)(t)}else await l(e,t)}catch(e){}},removeItem:async e=>{try{var n;null==(n=d.get(e))||n.cancel(),await (0,o.yH)(c(t,e))}catch(e){}},cleanup:()=>{for(let e of d.values())e.cancel();d.clear()}}}({prefix:d,maxEntries:50,shouldPersist:p,waitFor:null!=a?a:Promise.resolve(),writeDebounceMs:500}),t=(0,s.KU)(()=>e);return t?Object.assign(t,{cleanup:e.cleanup}):void 0}function y(){a||(a=(async()=>{try{let a=Object.keys(localStorage).filter(e=>e.startsWith("LSS-"));if(0===a.length)return;let r=new Map;for(let e of a){let t=e.slice(4),n=t.lastIndexOf(":");if(-1===n)continue;let a=t.slice(0,n),o=t.slice(n+1);r.has(a)||r.set(a,new Map),r.get(a).set(o,e)}for(let[a,i]of r){let r={},s=0;for(let[e,t]of i)try{let n=localStorage.getItem(t);if(!n)continue;let a=JSON.parse(n);switch(a.timestamp>s&&(s=a.timestamp),e){case"textInput":a.value&&"object"==typeof a.value&&"type"in a.value&&(r.tipTapEditorState=a.value);break;case"attachment":Array.isArray(a.value)&&(r.attachments=a.value);break;case"files":Array.isArray(a.value)&&(r.files=a.value);break;case"syncSourceUuids":Array.isArray(a.value)&&(r.syncSourceUuids=a.value)}}catch(e){}if(Object.keys(r).length>0){var e,t,n;let l=JSON.stringify({state:{tipTapEditorState:r.tipTapEditorState,attachments:null!=(e=r.attachments)?e:[],files:null!=(t=r.files)?t:[],syncSourceUuids:null!=(n=r.syncSourceUuids)?n:[]},version:0,updatedAt:s||Date.now()});for(let e of(await (0,o.hZ)(c(d,a),l),i.values()))try{localStorage.removeItem(e)}catch(e){}}}}catch(e){}})())}},0x1c12b3087:(e,t,n)=>{n.d(t,{BN:()=>u,EL:()=>_,Fj:()=>v,Jy:()=>d,N3:()=>y,QN:()=>b,QT:()=>f,RK:()=>j,TQ:()=>C,Tc:()=>h,aJ:()=>x,aQ:()=>g,fT:()=>P,jM:()=>p,jw:()=>m,lE:()=>S}),n(0x9845e38c);var a=n(0xfc89b4a4),o=n(0x394ef833),r=n(0x107838ca5),i=n(0x16d4e9516);let s=a.createContext(null),l=null;function c(e,t){let n=a.useContext(s)||(l||({store:l}=(0,i.E)({})),l);return(0,o.P)(n,(0,r.k)(e))}function u(){let e=a.useContext(s);if(!e)throw Error("ChatInputStore not found. Make sure ChatInputProvider wraps your component.");return e}function d(e){let t=u();return(0,o.P)(t,(0,r.k)(e))}let p=s.Provider,f=()=>d(e=>(e=>{let t=e.tipTapEditorState;return{prompt:e.getPrompt(),tipTapEditorState:t,isPromptUnsafe:"__ant_unsafe"in t&&!!t.__ant_unsafe}})(e)),y=()=>d(e=>!e.getPrompt().trim()),g=()=>d(e=>!!e.getPrompt().trim()||e.isSending),m=()=>{let e=a.useContext(s),t=c(e=>e.conversation,"useChatInputConversationOnly");return e?t:void 0},v=()=>c(e=>({pendingConversationSettings:e.pendingConversationSettings,setPendingConversationSettings:e.setPendingConversationSettings}),"useChatInputPendingConversationSettings");function h(e,t){return c(e,t)}let S=()=>c(e=>({syncSourceUuids:e.syncSourceUuids,setSyncSourceUuids:e.setSyncSourceUuids,projectUuid:e.projectUuid,conversation:e.conversation}),"useChatInputSync"),b=()=>c(e=>e.projectUuid,"useChatInputProjectUuid"),_=()=>c(e=>e.setProjectUuid,"useChatInputSetProjectUuid"),P=()=>c(e=>({isUploadingDrive:e.isUploadingDriveSync,setIsUploadingDriveSync:e.setIsUploadingDriveSync}),"useChatInputUploadDrive"),C=()=>c(e=>({model:e.model,setModel:e.setModel}),"useChatInputModel"),j=()=>c(e=>({personalizedStyle:e.personalizedStyle,setPersonalizedStyle:e.setPersonalizedStyle}),"useChatInputPersonalizedStyle"),x=()=>c(e=>({getPrompt:e.getPrompt,setPrompt:e.setPrompt,focusInput:e.focusInput}),"useChatInputPrefill")}}]);